<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU QUIZ - í†µê³„ ê¸°ëŠ¥ V2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .stat-box { @apply bg-white p-4 rounded-lg shadow-md border border-gray-200; }
        .stat-value { @apply text-2xl font-bold text-blue-600; }
        .stat-label { @apply text-sm text-gray-600 mt-1; }
        .mode-btn { @apply px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors; }
        .mode-btn.active { @apply bg-green-500; }
        .answer-btn { @apply px-6 py-3 m-2 border-2 border-gray-300 rounded-lg hover:border-blue-500 transition-colors; }
        .answer-btn.selected { @apply border-blue-500 bg-blue-50; }
        .answer-btn.correct { @apply border-green-500 bg-green-50; }
        .answer-btn.incorrect { @apply border-red-500 bg-red-50; }
        .loading { @apply opacity-50 pointer-events-none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ACIU QUIZ</h1>
            <p class="text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ ì‹œí—˜ ì¤€ë¹„ë¥¼ ìœ„í•œ í†µí•© í•™ìŠµ ì‹œìŠ¤í…œ</p>
        </div>

        <!-- ì‚¬ìš©ì ì„¤ì • -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ‘¤ ì‚¬ìš©ì ì„¤ì •</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                    <input type="text" id="userName" value="ì¡°ëŒ€í‘œ" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì—°ë½ì²˜</label>
                    <input type="text" id="userPhone" value="010-1234-5678" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex items-end">
                    <button onclick="registerUser()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                        ì‚¬ìš©ì ë“±ë¡
                    </button>
                </div>
            </div>
            <div id="userStatus" class="mt-3 text-sm text-gray-600">ë¯¸ë“±ë¡ ìƒíƒœ</div>
        </div>

        <!-- ëŒ€ë¬¸ í†µê³„ (ì¡°ëŒ€í‘œë‹˜ ìš”êµ¬ì‚¬í•­) -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ëŒ€ë¬¸ í†µê³„</h2>
            
            <!-- 1. ë³´ìœ ë¬¸ì œìˆ˜ í˜„í™© -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">1. ë³´ìœ ë¬¸ì œìˆ˜ í˜„í™©</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="stat-box text-center">
                        <div class="stat-value" id="insQuestions">0</div>
                        <div class="stat-label">ì¸ìŠ¤êµì¬</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="examQuestions">0</div>
                        <div class="stat-label">ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="totalQuestions">0</div>
                        <div class="stat-label">ì „ì²´ ë¬¸ì œìˆ˜</div>
                    </div>
                </div>
            </div>

            <!-- 2. í•™ìŠµì§„ë„ í˜„í™© -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">2. í•™ìŠµì§„ë„ í˜„í™©</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="stat-box text-center">
                        <div class="stat-value" id="completedQuestions">0</div>
                        <div class="stat-label">ì™„ë£Œí•œ ë¬¸ì œ</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="overallProgress">0%</div>
                        <div class="stat-label">ì „ì²´ ì§„ë„ìœ¨</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="overallAccuracy">0%</div>
                        <div class="stat-label">ì •ë‹µë¥ </div>
                    </div>
                </div>
            </div>

            <!-- 3. ê¸ˆì¼ í•™ìŠµí˜„í™© -->
            <div>
                <h3 class="text-lg font-medium mb-3">3. ê¸ˆì¼ í•™ìŠµí˜„í™©</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="stat-box text-center">
                        <div class="stat-value" id="todayTotal">0</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ì´ ë¬¸ì œìˆ˜</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="todayCorrect">0</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ì •ë‹µìˆ˜</div>
                    </div>
                    <div class="stat-box text-center">
                        <div class="stat-value" id="todayAccuracy">0%</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ì •ë‹µë¥ </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•™ìŠµ ëª¨ë“œ ì„ íƒ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“š í•™ìŠµ ëª¨ë“œ</h2>
            <div class="flex flex-wrap gap-2">
                <button class="mode-btn active" onclick="setMode('basic')">ê¸°ë³¸í•™ìŠµ</button>
                <button class="mode-btn" onclick="setMode('ì¬ì‚°ë³´í—˜')">ì¬ì‚°ë³´í—˜</button>
                <button class="mode-btn" onclick="setMode('íŠ¹ì¢…ë³´í—˜')">íŠ¹ì¢…ë³´í—˜</button>
                <button class="mode-btn" onclick="setMode('ë°°ìƒì±…ì„ë³´í—˜')">ë°°ìƒì±…ì„ë³´í—˜</button>
                <button class="mode-btn" onclick="setMode('í•´ìƒë³´í—˜')">í•´ìƒë³´í—˜</button>
            </div>
            <div class="mt-3 text-sm text-gray-600">í˜„ì¬ ëª¨ë“œ: <span id="currentMode">ê¸°ë³¸í•™ìŠµ</span></div>
        </div>

        <!-- ëª¨ë“œë³„ í†µê³„ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“ˆ ëª¨ë“œë³„ í†µê³„</h2>
            
            <!-- ê¸°ë³¸í•™ìŠµ í†µê³„ -->
            <div id="basicStats">
                <h3 class="text-lg font-medium mb-3">ê¸°ë³¸í•™ìŠµ í†µê³„</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-2">ëˆ„ì í˜„í™©</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicCumulativeTotal">0</div>
                                <div class="stat-label">ì´ ë¬¸ì œìˆ˜</div>
                            </div>
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicCumulativeCorrect">0</div>
                                <div class="stat-label">ì •ë‹µìˆ˜</div>
                            </div>
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicCumulativeAccuracy">0%</div>
                                <div class="stat-label">ì •ë‹µë¥ </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">ê¸ˆì¼í˜„í™©</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicDailyTotal">0</div>
                                <div class="stat-label">ê¸ˆì¼ ë¬¸ì œìˆ˜</div>
                            </div>
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicDailyCorrect">0</div>
                                <div class="stat-label">ê¸ˆì¼ ì •ë‹µìˆ˜</div>
                            </div>
                            <div class="stat-box text-center">
                                <div class="stat-value" id="basicDailyAccuracy">0%</div>
                                <div class="stat-label">ê¸ˆì¼ ì •ë‹µë¥ </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ëŒ€ë¶„ë¥˜í•™ìŠµ í†µê³„ -->
            <div id="categoryStats" style="display: none;">
                <h3 class="text-lg font-medium mb-3">ëŒ€ë¶„ë¥˜í•™ìŠµ í†µê³„</h3>
                
                <!-- ì „ì²´ ëˆ„ì  í†µê³„ -->
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-medium mb-2">ëŒ€ë¶„ë¥˜í•™ìŠµ ì „ì²´ ëˆ„ì  í†µê³„</h4>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="stat-box text-center">
                            <div class="stat-value" id="largeCategoryTotalAttempted">0</div>
                            <div class="stat-label">ì´ í‘¼ ë¬¸ì œìˆ˜</div>
                        </div>
                        <div class="stat-box text-center">
                            <div class="stat-value" id="largeCategoryTotalCorrect">0</div>
                            <div class="stat-label">ì´ ë§ì€ ë¬¸ì œìˆ˜</div>
                        </div>
                        <div class="stat-box text-center">
                            <div class="stat-value" id="largeCategoryTotalAccuracy">0%</div>
                            <div class="stat-label">ì „ì²´ ì •ë‹µë¥ </div>
                        </div>
                    </div>
                </div>

                <!-- íŠ¹ì • ì¹´í…Œê³ ë¦¬ í†µê³„ -->
                <div>
                    <h4 id="categoryTitle" class="font-medium mb-2">ì¬ì‚°ë³´í—˜ í†µê³„</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-medium mb-2">ëˆ„ì í˜„í™©</h5>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryCumulativeTotal">0</div>
                                    <div class="stat-label">ì´ ë¬¸ì œìˆ˜</div>
                                </div>
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryCumulativeCorrect">0</div>
                                    <div class="stat-label">ì •ë‹µìˆ˜</div>
                                </div>
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryCumulativeAccuracy">0%</div>
                                    <div class="stat-label">ì •ë‹µë¥ </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-medium mb-2">ê¸ˆì¼í˜„í™©</h5>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryDailyTotal">0</div>
                                    <div class="stat-label">ê¸ˆì¼ ë¬¸ì œìˆ˜</div>
                                </div>
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryDailyCorrect">0</div>
                                    <div class="stat-label">ê¸ˆì¼ ì •ë‹µìˆ˜</div>
                                </div>
                                <div class="stat-box text-center">
                                    <div class="stat-value" id="categoryDailyAccuracy">0%</div>
                                    <div class="stat-label">ê¸ˆì¼ ì •ë‹µë¥ </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¬¸ì œ í’€ì´ ì˜ì—­ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">â“ ë¬¸ì œ í’€ì´</h2>
            <div class="bg-gray-50 p-6 rounded-lg">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-gray-600">
                        ë¬¸ì œ <span id="currentQuestionNumber">1</span> / <span id="totalQuestionCount">0</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        ë¬¸ì œì½”ë“œ: <span id="questionCode">-</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="text-sm text-gray-600 mb-2">
                        ë¶„ë¥˜: <span id="questionCategory">-</span> | ìœ í˜•: <span id="questionType">-</span>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200">
                        <p id="questionText" class="text-lg leading-relaxed">ë¬¸ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                    </div>
                </div>

                <div id="answerButtons" class="mb-4">
                    <!-- ë‹µì•ˆ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div id="answerResult" class="mb-4"></div>

                <div class="flex justify-between">
                    <button onclick="prevQuestion()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                        â—€ ì´ì „ ë¬¸ì œ
                    </button>
                    <button id="checkAnswerBtn" onclick="checkAnswer()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        ì •ë‹µ í™•ì¸
                    </button>
                    <button onclick="nextQuestion()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                        ë‹¤ìŒ ë¬¸ì œ â–¶
                    </button>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° ê´€ë¦¬ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h2>
            <div class="flex flex-wrap gap-2">
                <button onclick="exportData()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                </button>
                <button onclick="importData()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                </button>
                <button onclick="clearAllData()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
                    ì „ì²´ ì´ˆê¸°í™”
                </button>
                <button onclick="loadStatisticsData()" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
                    í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
        </div>
    </div>

    <script>
        // ===== í•µì‹¬ ë°ì´í„° êµ¬ì¡° (ë…¸íŒ€ì¥ ë°©ì‹ ì±„ìš©) =====
        
        // ê°„ì†Œí™”ëœ í†µê³„ ìŠ¤í‚¤ë§ˆ
        const initStatistics = () => ({
            meta: {
                version: "2.0",
                userName: null,
                registeredAt: null,
                dataStartDate: null,
                lastUpdated: new Date().toISOString()
            },
            questionCounts: {
                "ì¸ìŠ¤êµì¬": 700,
                "ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜": 679,
                "total": 1379
            },
            global: {
                cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                daily: { attempted: 0, correct: 0, accuracy: 0 }
            },
            modes: {
                basic: {
                    cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                    daily: { attempted: 0, correct: 0, accuracy: 0 }
                },
                categories: {
                    "ì¬ì‚°ë³´í—˜": {
                        cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                        daily: { attempted: 0, correct: 0, accuracy: 0 }
                    },
                    "íŠ¹ì¢…ë³´í—˜": {
                        cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                        daily: { attempted: 0, correct: 0, accuracy: 0 }
                    },
                    "ë°°ìƒì±…ì„ë³´í—˜": {
                        cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                        daily: { attempted: 0, correct: 0, accuracy: 0 }
                    },
                    "í•´ìƒë³´í—˜": {
                        cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                        daily: { attempted: 0, correct: 0, accuracy: 0 }
                    }
                },
                largeCategoryTotal: {
                    cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                    daily: { attempted: 0, correct: 0, accuracy: 0 }
                }
            }
        });

        // ì „ì—­ ë³€ìˆ˜ë“¤
        let statistics = initStatistics();
        let currentMode = 'basic';
        let isUserRegistered = false;
        let userKey = null;
        let questions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let isAnswerChecked = false;

        // ===== ì¬í™œìš© ê°€ëŠ¥í•œ í•µì‹¬ í•¨ìˆ˜ë“¤ =====

        // ì •ë‹µë¥  ê³„ì‚° (ì¬í™œìš©)
        function calculateAccuracy(correct, total) {
            return total === 0 ? 0 : Math.round((correct / total) * 100);
        }

        // ì§„ë„ìœ¨ ê³„ì‚° (ì¬í™œìš©)
        function calculateProgress(completed, total) {
            return total === 0 ? 0 : Math.round((completed / total) * 100);
        }

        // ì‚¬ìš©ì í‚¤ ìƒì„± (ì¬í™œìš©)
        function generateUserKey(userName, userPhone) {
            return `${userName}_${userPhone}`.replace(/[^a-zA-Z0-9]/g, '_');
        }

        // ë°ì´í„° ì €ì¥ (ì¬í™œìš©)
        function saveStatistics() {
            if (!userKey) return;
            
            statistics.meta.lastUpdated = new Date().toISOString();
            localStorage.setItem(`aciu_statistics_${userKey}`, JSON.stringify(statistics));
            console.log('ë°ì´í„° ì €ì¥ ì™„ë£Œ:', userKey);
        }

        // ë°ì´í„° ë¡œë“œ (ì¬í™œìš©)
        function loadStatistics() {
            if (!userKey) return;
            
            const saved = localStorage.getItem(`aciu_statistics_${userKey}`);
            if (saved) {
                try {
                    const savedStats = JSON.parse(saved);
                    statistics = { ...initStatistics(), ...savedStats };
                    console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    statistics = initStatistics();
                }
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateStatistics(isCorrect, mode, category = null) {
            // ê¸€ë¡œë²Œ í†µê³„ ì—…ë°ì´íŠ¸
            statistics.global.cumulative.attempted++;
            if (isCorrect) statistics.global.cumulative.correct++;
            statistics.global.cumulative.accuracy = calculateAccuracy(
                statistics.global.cumulative.correct,
                statistics.global.cumulative.attempted
            );

            statistics.global.daily.attempted++;
            if (isCorrect) statistics.global.daily.correct++;
            statistics.global.daily.accuracy = calculateAccuracy(
                statistics.global.daily.correct,
                statistics.global.daily.attempted
            );

            // ëª¨ë“œë³„ í†µê³„ ì—…ë°ì´íŠ¸
            if (mode === 'basic') {
                updateModeStatistics(statistics.modes.basic, isCorrect);
            } else if (category) {
                updateModeStatistics(statistics.modes.categories[category], isCorrect);
                updateModeStatistics(statistics.modes.largeCategoryTotal, isCorrect);
            }

            // ë°ì´í„° ì €ì¥
            saveStatistics();
        }

        // ëª¨ë“œë³„ í†µê³„ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateModeStatistics(modeStats, isCorrect) {
            modeStats.cumulative.attempted++;
            if (isCorrect) modeStats.cumulative.correct++;
            modeStats.cumulative.accuracy = calculateAccuracy(
                modeStats.cumulative.correct,
                modeStats.cumulative.attempted
            );

            modeStats.daily.attempted++;
            if (isCorrect) modeStats.daily.correct++;
            modeStats.daily.accuracy = calculateAccuracy(
                modeStats.daily.correct,
                modeStats.daily.attempted
            );
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateAllDisplays() {
            updateHomeStatistics();
            updateModeStatisticsDisplay();
        }

        // ëŒ€ë¬¸ í†µê³„ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateHomeStatistics() {
            // ë³´ìœ ë¬¸ì œìˆ˜ í˜„í™©
            document.getElementById('insQuestions').textContent = statistics.questionCounts["ì¸ìŠ¤êµì¬"];
            document.getElementById('examQuestions').textContent = statistics.questionCounts["ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜"];
            document.getElementById('totalQuestions').textContent = statistics.questionCounts.total;

            // í•™ìŠµì§„ë„ í˜„í™©
            const global = statistics.global.cumulative;
            document.getElementById('completedQuestions').textContent = global.attempted;
            document.getElementById('overallProgress').textContent = 
                calculateProgress(global.attempted, statistics.questionCounts.total) + '%';
            document.getElementById('overallAccuracy').textContent = global.accuracy + '%';

            // ê¸ˆì¼ í•™ìŠµí˜„í™©
            const daily = statistics.global.daily;
            document.getElementById('todayTotal').textContent = daily.attempted;
            document.getElementById('todayCorrect').textContent = daily.correct;
            document.getElementById('todayAccuracy').textContent = daily.accuracy + '%';
        }

        // ëª¨ë“œë³„ í†µê³„ í™”ë©´ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateModeStatisticsDisplay() {
            if (currentMode === 'basic') {
                document.getElementById('basicStats').style.display = 'block';
                document.getElementById('categoryStats').style.display = 'none';
                
                const basic = statistics.modes.basic;
                document.getElementById('basicCumulativeTotal').textContent = basic.cumulative.attempted;
                document.getElementById('basicCumulativeCorrect').textContent = basic.cumulative.correct;
                document.getElementById('basicCumulativeAccuracy').textContent = basic.cumulative.accuracy + '%';
                
                document.getElementById('basicDailyTotal').textContent = basic.daily.attempted;
                document.getElementById('basicDailyCorrect').textContent = basic.daily.correct;
                document.getElementById('basicDailyAccuracy').textContent = basic.daily.accuracy + '%';
                
            } else {
                document.getElementById('basicStats').style.display = 'none';
                document.getElementById('categoryStats').style.display = 'block';
                
                const largeCategoryTotal = statistics.modes.largeCategoryTotal.cumulative;
                document.getElementById('largeCategoryTotalAttempted').textContent = largeCategoryTotal.attempted;
                document.getElementById('largeCategoryTotalCorrect').textContent = largeCategoryTotal.correct;
                document.getElementById('largeCategoryTotalAccuracy').textContent = largeCategoryTotal.accuracy + '%';
                
                document.getElementById('categoryTitle').textContent = currentMode + ' í†µê³„';
                const category = statistics.modes.categories[currentMode];
                if (category) {
                    document.getElementById('categoryCumulativeTotal').textContent = category.cumulative.attempted;
                    document.getElementById('categoryCumulativeCorrect').textContent = category.cumulative.correct;
                    document.getElementById('categoryCumulativeAccuracy').textContent = category.cumulative.accuracy + '%';
                    
                    document.getElementById('categoryDailyTotal').textContent = category.daily.attempted;
                    document.getElementById('categoryDailyCorrect').textContent = category.daily.correct;
                    document.getElementById('categoryDailyAccuracy').textContent = category.daily.accuracy + '%';
                }
            }
        }

        // ===== ì‚¬ìš©ì ê´€ë¦¬ =====

        // ì‚¬ìš©ì ë“±ë¡
        function registerUser() {
            const userName = document.getElementById('userName').value;
            const userPhone = document.getElementById('userPhone').value;
            
            if (!userName || !userPhone) {
                alert('ì‚¬ìš©ìëª…ê³¼ íœ´ëŒ€í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            userKey = generateUserKey(userName, userPhone);
            isUserRegistered = true;
            
            statistics.meta.userName = userName;
            statistics.meta.registeredAt = new Date().toISOString();
            statistics.meta.dataStartDate = new Date().toISOString().split('T')[0];
            
            localStorage.setItem('aciu_current_user', userKey);
            saveStatistics();
            
            document.getElementById('userStatus').innerHTML = 
                `âœ… ${userName}ë‹˜ ë“±ë¡ì™„ë£Œ (${statistics.meta.dataStartDate} ë¶€í„° ë°ì´í„° ê¸°ë¡)`;
            
            updateAllDisplays();
        }

        // ===== ëª¨ë“œ ê´€ë¦¬ =====

        // ëª¨ë“œ ì„¤ì •
        function setMode(mode) {
            currentMode = mode;
            document.getElementById('currentMode').textContent = mode;
            
            // ëª¨ë“œ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ë¬¸ì œ ë¡œë“œ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” CSV íŒŒì¼ì—ì„œ ë¡œë“œ)
            loadQuestionsForMode(mode);
            
            updateModeStatisticsDisplay();
        }

        // ëª¨ë“œë³„ ë¬¸ì œ ë¡œë“œ (ì¬í™œìš©)
        function loadQuestionsForMode(mode) {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” CSV íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ ë¡œë“œ
            // ì—¬ê¸°ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
            questions = generateSampleQuestions(mode);
            currentQuestionIndex = 0;
            displayCurrentQuestion();
        }

        // ìƒ˜í”Œ ë¬¸ì œ ìƒì„± (ì¬í™œìš©)
        function generateSampleQuestions(mode) {
            const sampleQuestions = [
                {
                    code: "Q001",
                    question: "ë³´í—˜ì˜ ê¸°ë³¸ ì›ë¦¬ëŠ” ìœ„í—˜ì˜ ë¶„ì‚°ì´ë‹¤.",
                    type: "ì§„ìœ„í˜•",
                    category: "ì¬ì‚°ë³´í—˜",
                    answer: "O",
                    options: null
                },
                {
                    code: "Q002",
                    question: "ì¬ì‚°ë³´í—˜ì—ì„œ ë³´í—˜ê°€ì•¡ì€ ë³´í—˜ì‚¬ê³  ë°œìƒ ì‹œì ì˜ í”¼ë³´í—˜ì´ìµì˜ ê°€ì•¡ì„ ë§í•œë‹¤.",
                    type: "ì§„ìœ„í˜•",
                    category: "ì¬ì‚°ë³´í—˜",
                    answer: "O",
                    options: null
                },
                {
                    code: "Q003",
                    question: "ìë™ì°¨ë³´í—˜ì—ì„œ ëŒ€ì¸ë°°ìƒë³´í—˜ì˜ ê°€ì…ì€ ë‹¤ìŒ ì¤‘ ì–´ëŠ ê²ƒì¸ê°€?",
                    type: "ì„ íƒí˜•",
                    category: "íŠ¹ì¢…ë³´í—˜",
                    answer: "1",
                    options: ["ì˜ë¬´ê°€ì…", "ì„ì˜ê°€ì…", "ì„ íƒê°€ì…", "ì¡°ê±´ë¶€ê°€ì…"]
                }
            ];

            if (mode === 'basic') {
                return sampleQuestions;
            } else {
                return sampleQuestions.filter(q => q.category === mode);
            }
        }

        // ===== ë¬¸ì œ í’€ì´ =====

        // í˜„ì¬ ë¬¸ì œ í‘œì‹œ (ì¬í™œìš©)
        function displayCurrentQuestion() {
            if (questions.length === 0) {
                document.getElementById('questionText').textContent = 'í•´ë‹¹ ëª¨ë“œì˜ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }

            const question = questions[currentQuestionIndex];
            
            document.getElementById('currentQuestionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestionCount').textContent = questions.length;
            document.getElementById('questionCode').textContent = question.code;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionType').textContent = question.type;
            document.getElementById('questionCategory').textContent = question.category;
            
            createAnswerButtons(question);
            
            selectedAnswer = null;
            isAnswerChecked = false;
            document.getElementById('answerResult').innerHTML = '';
            document.getElementById('checkAnswerBtn').style.display = 'block';
        }

        // ë‹µì•ˆ ë²„íŠ¼ ìƒì„± (ì¬í™œìš©)
        function createAnswerButtons(question) {
            const container = document.getElementById('answerButtons');
            container.innerHTML = '';
            
            if (question.type === 'ì§„ìœ„í˜•') {
                const oBtn = document.createElement('button');
                oBtn.className = 'answer-btn';
                oBtn.textContent = 'O';
                oBtn.onclick = () => selectAnswer('O');
                
                const xBtn = document.createElement('button');
                xBtn.className = 'answer-btn';
                xBtn.textContent = 'X';
                xBtn.onclick = () => selectAnswer('X');
                
                container.appendChild(oBtn);
                container.appendChild(xBtn);
                
            } else if (question.type === 'ì„ íƒí˜•') {
                question.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'answer-btn';
                    btn.innerHTML = `${index + 1}. ${option}`;
                    btn.onclick = () => selectAnswer((index + 1).toString());
                    container.appendChild(btn);
                });
            }
        }

        // ë‹µì•ˆ ì„ íƒ (ì¬í™œìš©)
        function selectAnswer(answer) {
            if (isAnswerChecked) return;
            
            selectedAnswer = answer;
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
        }

        // ì •ë‹µ í™•ì¸ (ì¬í™œìš©)
        function checkAnswer() {
            if (!selectedAnswer) {
                alert('ë‹µì•ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isAnswerChecked) {
                alert('ì´ë¯¸ í™•ì¸í•œ ë¬¸ì œì…ë‹ˆë‹¤.');
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.answer;
            
            isAnswerChecked = true;
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (isUserRegistered) {
                updateStatistics(isCorrect, currentMode, currentQuestion.category);
                updateAllDisplays();
            }
            
            // ë‹µì•ˆ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            updateAnswerButtonColors(currentQuestion.answer, selectedAnswer, isCorrect);
            
            // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
            showAnswerResult(isCorrect, currentQuestion.answer);
            
            document.getElementById('checkAnswerBtn').style.display = 'none';
        }

        // ë‹µì•ˆ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ (ì¬í™œìš©)
        function updateAnswerButtonColors(correctAnswer, selectedAnswer, isCorrect) {
            document.querySelectorAll('.answer-btn').forEach(btn => {
                const btnAnswer = btn.textContent.charAt(0);
                
                if (btnAnswer === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btnAnswer === selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
                
                btn.classList.add('disabled');
            });
        }

        // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ (ì¬í™œìš©)
        function showAnswerResult(isCorrect, correctAnswer) {
            const resultDiv = document.getElementById('answerResult');
            
            if (isCorrect) {
                resultDiv.innerHTML = `
                    <div class="text-green-600 font-bold text-lg">
                        âœ… ì •ë‹µì…ë‹ˆë‹¤!
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="text-red-600 font-bold text-lg">
                        âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ "${correctAnswer}" ì…ë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        // ë‹¤ìŒ ë¬¸ì œ (ì¬í™œìš©)
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            } else {
                alert('ë§ˆì§€ë§‰ ë¬¸ì œì…ë‹ˆë‹¤.');
            }
        }

        // ì´ì „ ë¬¸ì œ (ì¬í™œìš©)
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            } else {
                alert('ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.');
            }
        }

        // ===== ë°ì´í„° ê´€ë¦¬ =====

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ì¬í™œìš©)
        function exportData() {
            const dataStr = JSON.stringify(statistics, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `aciu_statistics_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¬í™œìš©)
        function importData() {
            document.getElementById('importFile').click();
        }

        // íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì²˜ë¦¬ (ì¬í™œìš©)
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    statistics = { ...initStatistics(), ...importedData };
                    isUserRegistered = !!statistics.meta.userName;
                    
                    if (isUserRegistered) {
                        userKey = generateUserKey(statistics.meta.userName, '010-1234-5678');
                        document.getElementById('userName').value = statistics.meta.userName;
                        document.getElementById('userStatus').innerHTML = 
                            `âœ… ${statistics.meta.userName}ë‹˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ`;
                    }
                    
                    updateAllDisplays();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    alert('ì˜ëª»ëœ ë°ì´í„° íŒŒì¼ì…ë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
        }

        // ì „ì²´ ì´ˆê¸°í™” (ì¬í™œìš©)
        function clearAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('aciu_')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                statistics = initStatistics();
                isUserRegistered = false;
                userKey = null;
                
                document.getElementById('userName').value = '';
                document.getElementById('userPhone').value = '';
                document.getElementById('userStatus').innerHTML = 'ë¯¸ë“±ë¡ ìƒíƒœ';
                
                updateAllDisplays();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì¬í™œìš©)
        function loadStatisticsData() {
            if (userKey) {
                loadStatistics();
                updateAllDisplays();
                alert('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } else {
                alert('ë¨¼ì € ì‚¬ìš©ìë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.');
            }
        }

        // ===== ì•± ì´ˆê¸°í™” =====

        // ì•± ì´ˆê¸°í™”
        function initApp() {
            console.log('=== ACIU QUIZ V2.0 ì´ˆê¸°í™” ===');
            
            // ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ í™•ì¸
            const savedUserKey = localStorage.getItem('aciu_current_user');
            if (savedUserKey) {
                userKey = savedUserKey;
                isUserRegistered = true;
                loadStatistics();
                
                const userName = statistics.meta.userName || 'ì¡°ëŒ€í‘œ';
                document.getElementById('userName').value = userName;
                document.getElementById('userStatus').innerHTML = 
                    `âœ… ${userName}ë‹˜ ë“±ë¡ì™„ë£Œ (${statistics.meta.dataStartDate || '2025-07-29'} ë¶€í„° ë°ì´í„° ê¸°ë¡)`;
            }
            
            updateAllDisplays();
            setMode('basic');
            
            console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', initApp);

        // ìë™ ì €ì¥ (30ì´ˆë§ˆë‹¤)
        setInterval(() => {
            if (isUserRegistered) {
                saveStatistics();
            }
        }, 30000);

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì €ì¥
        window.addEventListener('beforeunload', () => {
            if (isUserRegistered) {
                saveStatistics();
            }
        });
    </script>
</body>
</html>