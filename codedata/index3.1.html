<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU í•™ìŠµì•± - V2.3</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Noto Sans KR ë¡œë“œ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary {
            @apply bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out;
        }
        .btn-secondary {
            @apply bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition duration-300 ease-in-out;
        }
        .btn-category {
            @apply bg-blue-500 text-white font-semibold py-2 px-4 rounded-md shadow-sm hover:bg-blue-600 transition duration-200 ease-in-out;
        }
        .btn-category.active {
            @apply bg-blue-700 ring-2 ring-blue-300;
        }
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg;
        }
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500;
        }
        /* íŠ¹ì • ëª¨ë“œ í™”ë©´ ìˆ¨ê¹€/í‘œì‹œ */
        .mode-screen {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ëª¨ë“œ í™”ë©´ ìˆ¨ê¹€ */
        }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="container mx-auto max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden my-8">
        <!-- ìƒë‹¨ í—¤ë”: ì•± ì œëª©, ë‚ ì§œ/ì‹œê°„, ëª…ì–¸, ì§„ë„ìœ¨ ë“± (UI V2.3) -->
        <header class="bg-blue-700 text-white p-6 text-center rounded-t-2xl relative">
            <h1 class="text-4xl font-bold mb-2">AICU QUIZ</h1>
            <p id="current-mode" class="text-xl font-semibold mb-4">ëª¨ë“œ ì„ íƒ</p>

            <div class="text-sm md:text-base mb-4">
                <p>ì‚¬ìš©ì: <span id="user-id" class="font-bold">ì¡°ëŒ€í‘œë‹˜</span></p>
                <p>ì‹œí—˜ê¹Œì§€ D-<span id="exam-countdown" class="font-bold">90</span>ì¼</p>
                <p><span id="current-date-time"></span></p>
                <p id="quote-of-the-day" class="italic mt-2">"ë°°ì›€ì€ ëì´ ì—†ìœ¼ë©°, ë…¸ë ¥ì€ ê²°ì½” ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤."</p>
            </div>
            <div class="text-lg font-semibold flex justify-center gap-6">
                <p>ì „ì²´ í•™ìŠµ ì§„ë„ìœ¨: <span id="overall-progress-rate" class="text-yellow-300">0%</span></p>
                <p>ì˜¤ëŠ˜ì˜ í•™ìŠµ ì§„ë„ìœ¨: <span id="daily-progress-rate" class="text-yellow-300">0%</span></p>
            </div>

            <!-- ì„¤ì • ë²„íŠ¼ -->
            <button id="settings-btn" class="absolute top-4 right-4 text-white text-2xl hover:text-blue-200 transition duration-200 ease-in-out">
                âš™ï¸ <!-- ì„¤ì • ì•„ì´ì½˜ (ìœ ë‹ˆì½”ë“œ) -->
            </button>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <main class="p-8">
            <!-- ë¡œë”© ìƒíƒœ (UI V2.3) -->
            <div id="loading-area" class="text-center py-8">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p id="loading-status" class="text-gray-600">ins_master_db.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                    <div id="loading-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- ëª¨ë“œ ì„ íƒ í™”ë©´ (ì´ˆê¸° ì§„ì… í™”ë©´ - UI V2.3) -->
            <section id="mode-selection-screen" class="text-center hidden"> <!-- ì´ˆê¸° hidden -->
                <h2 class="text-3xl font-bold text-gray-800 mb-8">í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <button class="btn-primary py-8 text-2xl" data-mode="basic-learning">ê¸°ë³¸ í•™ìŠµ</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="large-category-learning">ëŒ€ë¶„ë¥˜ í•™ìŠµ</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="medium-category-learning">ì¤‘ë¶„ë¥˜ í•™ìŠµ</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="multiple-choice-learning">ì„ íƒí˜• í•™ìŠµ</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="true-false-learning">ì§„ìœ„í˜• í•™ìŠµ</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="mock-test">ëª¨ì˜ê³ ì‚¬</button>
                    <button class="btn-primary py-8 text-2xl" data-mode="learning-statistics">í•™ìŠµ í†µê³„</button>
                </div>
            </section>

            <!-- ê° í•™ìŠµ ëª¨ë“œë³„ í™”ë©´ (mode-screen í´ë˜ìŠ¤ ì¶”ê°€ - UI V2.3) -->
            <!-- ê¸°ë³¸ í•™ìŠµ, ì„ íƒí˜•, ì§„ìœ„í˜• ë“± ë¬¸ì œ í’€ì´ ê³µí†µ í™”ë©´ -->
            <section id="common-learning-screen" class="mode-screen">
                <!-- í•™ìŠµ í†µê³„ ìš”ì•½ -->
                <div class="card mb-8 text-center">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">í•™ìŠµ í˜„í™©</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-lg">
                        <div>ì´ ë¬¸ì œ: <span id="total-questions" class="font-bold">0</span></div>
                        <div>ë§ì€ ë¬¸ì œ: <span id="correct-count" class="font-bold text-green-600">0</span></div>
                        <div>í‹€ë¦° ë¬¸ì œ: <span id="incorrect-count" class="font-bold text-red-600">0</span></div>
                        <div>ì •ë‹µë¥ : <span id="accuracy" class="font-bold">0%</span></div>
                    </div>
                </div>

                <!-- ëŒ€ë¶„ë¥˜ ì„ íƒ ë²„íŠ¼ ê·¸ë£¹ (ëŒ€ë¶„ë¥˜ í•™ìŠµ ì‹œ í™œì„±í™”) -->
                <div id="large-category-selection-area" class="card mb-8 hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ëŒ€ë¶„ë¥˜ ì„ íƒ</h3>
                    <div id="layer1-buttons" class="flex flex-wrap justify-center gap-3">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ëŒ€ë¶„ë¥˜ ë²„íŠ¼ë“¤ -->
                        <button class="btn-category" data-category="ì¬ì‚°ë³´í—˜">ì¬ì‚°ë³´í—˜</button>
                        <button class="btn-category" data-category="íŠ¹ì¢…ë³´í—˜">íŠ¹ì¢…ë³´í—˜</button>
                        <button class="btn-category" data-category="ë°°ìƒì±…ì„ë³´í—˜">ë°°ìƒì±…ì„ë³´í—˜</button>
                        <button class="btn-category" data-category="í•´ìƒë³´í—˜">í•´ìƒë³´í—˜</button>
                    </div>
                </div>

                <!-- ì¤‘ë¶„ë¥˜ ì„ íƒ ë²„íŠ¼ ê·¸ë£¹ (ì¤‘ë¶„ë¥˜ í•™ìŠµ ì‹œ í™œì„±í™”) -->
                <div id="medium-category-selection-area" class="card mb-8 hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ì¤‘ë¶„ë¥˜ ì„ íƒ</h3>
                    <div id="layer2-buttons" class="flex flex-wrap justify-center gap-3">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ì¤‘ë¶„ë¥˜ ë²„íŠ¼ë“¤ (ì˜ˆì‹œ) -->
                        <button class="btn-category">í™”ì¬ë³´í—˜</button>
                        <button class="btn-category">ìë™ì°¨ë³´í—˜</button>
                        <button class="btn-category">ë„ë‚œë³´í—˜</button>
                    </div>
                </div>

                <!-- ë¬¸ì œ ë‚´ìš© -->
                <div class="card mb-8">
                    <!-- ë…¸íŒ€ì¥ UIì˜ ë¬¸ì œ ì •ë³´ (ìœ í˜•, QCODE, LAYER ì •ë³´)ë¥¼ V2.3 UIì— í†µí•© -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span id="question-type" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">ìœ í˜•</span>
                            <span id="question-code" class="text-sm text-gray-500">QCODE</span>
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold">ë¬¸ì œ</h2>
                            <div class="text-xs text-gray-500">
                                <span id="layer-info">LAYER1 > LAYER2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-container mb-6">
                        <p id="question-text" class="text-gray-800 leading-relaxed whitespace-pre-wrap">ì—¬ê¸°ì— ë¬¸ì œê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>

                    <div id="answer-options" class="mt-6 space-y-3">
                        <!-- ì§„ìœ„í˜• ë‹µì•ˆ -->
                        <div id="true-false-options" class="flex justify-center gap-4 hidden"> <!-- ì´ˆê¸° hidden -->
                            <button onclick="selectAnswer('O')" class="answer-btn btn-secondary w-24" data-answer="O">O (ë§ë‹¤)</button>
                            <button onclick="selectAnswer('X')" class="answer-btn btn-secondary w-24" data-answer="X">X (í‹€ë¦¬ë‹¤)</button>
                        </div>
                        <!-- ì„ íƒí˜• ë‹µì•ˆ -->
                        <div id="multiple-choice-options" class="grid grid-cols-2 gap-4 hidden"> <!-- ì´ˆê¸° hidden -->
                            <button onclick="selectAnswer('1')" class="answer-btn btn-secondary" data-answer="1">1</button>
                            <button onclick="selectAnswer('2')" class="answer-btn btn-secondary" data-answer="2">2</button>
                            <button onclick="selectAnswer('3')" class="answer-btn btn-secondary" data-answer="3">3</button>
                            <button onclick="selectAnswer('4')" class="answer-btn btn-secondary" data-answer="4">4</button>
                        </div>
                    </div>
                    <div id="result-display" class="mt-4 text-center text-2xl font-bold hidden">
                        <!-- ì •ë‹µ/ì˜¤ë‹µ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                    </div>
                </div>

                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë° ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="flex flex-wrap justify-center gap-4 mt-6">
                    <button id="prev-btn" class="btn-secondary">ì´ì „ ë¬¸ì œ</button>
                    <button id="check-answer-btn" class="btn-primary">ì •ë‹µ í™•ì¸</button>
                    <button id="next-btn" class="btn-primary">ë‹¤ìŒ ë¬¸ì œ</button>
                    <button id="explain-btn" class="btn-secondary hidden">í•´ì„¤ ë³´ê¸°</button>
                </div>
            </section>

            <!-- ëª¨ì˜ê³ ì‚¬ í™”ë©´ (ë³„ë„ UI - UI V2.3) -->
            <section id="mock-test-screen" class="mode-screen text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-8">ëª¨ì˜ê³ ì‚¬</h2>
                <div class="card mb-8">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">ì‹œí—˜ í˜„í™©</h3>
                    <p class="text-xl mb-4">ë‚¨ì€ ì‹œê°„: <span id="mock-test-timer" class="font-bold text-red-500">00:00</span></p>
                    <p class="text-lg">ì§„í–‰ë¥ : <span id="mock-test-progress" class="font-bold">0</span> / <span id="mock-test-total-questions" class="font-bold">0</span> ë¬¸ì œ</p>
                </div>
                <p class="text-gray-600 mb-4">ëª¨ì˜ê³ ì‚¬ ë¬¸ì œ ë‚´ìš©ì€ ìƒë‹¨ì˜ ì¼ë°˜ í•™ìŠµ í™”ë©´ê³¼ ë™ì¼í•˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤.</p>
                <button class="btn-primary py-4 px-8 text-xl mt-6">ì‹œí—˜ ì¢…ë£Œ ë° ê²°ê³¼ ë³´ê¸°</button>
            </section>

            <!-- í•™ìŠµ í†µê³„ í™”ë©´ (ë³„ë„ UI - UI V2.3) -->
            <section id="learning-statistics-screen" class="mode-screen text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-8">í•™ìŠµ í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>
                <div class="card mb-8">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">ì „ì²´ í•™ìŠµ ìš”ì•½</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-semibold">ì´ í•™ìŠµ ì‹œê°„</p>
                            <p class="text-2xl font-bold text-blue-700">0ì‹œê°„ 0ë¶„</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-semibold">ëˆ„ì  ë¬¸ì œ í’€ì´</p>
                            <p class="text-2xl font-bold text-blue-700">0ë¬¸ì œ</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-semibold">ì „ì²´ ì •ë‹µë¥ </p>
                            <p class="text-2xl font-bold text-green-600">0%</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-semibold">ê°€ì¥ ì·¨ì•½í•œ ëŒ€ë¶„ë¥˜</p>
                            <p class="text-2xl font-bold text-red-600">N/A</p>
                        </div>
                    </div>
                </div>

                <div class="card mb-8">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">ì˜ì—­ë³„ ì„±ê³¼ (ì°¨íŠ¸ Placeholder)</h3>
                    <div class="bg-gray-200 h-64 flex items-center justify-center rounded-lg text-gray-500">
                        ì—¬ê¸°ì— ì˜ì—­ë³„ ì •ë‹µë¥  ì°¨íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤. (ì˜ˆ: ë§‰ëŒ€ ê·¸ë˜í”„)
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">ì˜¤ë‹µ ë…¸íŠ¸ ìš”ì•½ (Placeholder)</h3>
                    <div class="bg-gray-200 h-32 flex items-center justify-center rounded-lg text-gray-500">
                        ì—¬ê¸°ì— ì˜¤ë‹µ ë¬¸ì œ ìœ í˜•ë³„ ë¶„ì„ ë˜ëŠ” ëª©ë¡ ìš”ì•½ì´ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                </div>
            </section>
        </main>

        <!-- í•˜ë‹¨ í‘¸í„° (ì„ íƒ ì‚¬í•­) -->
        <footer class="bg-gray-200 text-gray-600 p-4 text-center text-sm rounded-b-2xl mt-8">
            <p>&copy; 2025 AICU QUIZ App. All rights reserved.</p>
        </footer>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-bold text-blue-700 mb-6">ì„¤ì •</h3>
            <div class="grid grid-cols-1 gap-4">
                <button class="btn-primary py-4 text-xl">ì‚¬ìš©ì ë“±ë¡</button>
                <button class="btn-primary py-4 text-xl">ì‚¬ìš©ë²•</button>
                <button class="btn-primary py-4 text-xl">ì‹œí—˜ ê°œìš”</button>
            </div>
            <button class="btn-secondary mt-6" onclick="this.parentNode.parentNode.classList.add('hidden'); this.parentNode.parentNode.classList.remove('show');">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ (ë…¸íŒ€ì¥ index.htmlê³¼ V2.3 UIì— ë§ì¶° ì´ˆê¸°í™”)
        let questions = [];
        let filteredQuestions = []; // í˜„ì¬ ëª¨ë“œì— ë§ëŠ” ë¬¸ì œ ë°°ì—´
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let answered = false;
        let stats = {
            totalAnswered: 0,
            correctCount: 0
        };

        // UI ìš”ì†Œ ì°¸ì¡° (UI V2.3ì— ë§ì¶° ì¶”ê°€)
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const commonLearningScreen = document.getElementById('common-learning-screen');
        const mockTestScreen = document.getElementById('mock-test-screen');
        const learningStatisticsScreen = document.getElementById('learning-statistics-screen');

        const currentModeDisplay = document.getElementById('current-mode');
        const largeCategorySelectionArea = document.getElementById('large-category-selection-area');
        const mediumCategorySelectionArea = document.getElementById('medium-category-selection-area');
        const trueFalseOptions = document.getElementById('true-false-options'); // ID ì¼ì¹˜
        const multipleChoiceOptions = document.getElementById('multiple-choice-options'); // ID ì¼ì¹˜

        const layer1Buttons = document.getElementById('layer1-buttons'); // ëŒ€ë¶„ë¥˜ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ

        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');

        // ëª¨ë“  ëª¨ë“œ í™”ë©´ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜ (UI V2.3)
        function hideAllModeScreens() {
            modeSelectionScreen.classList.add('hidden'); // ëª¨ë“œ ì„ íƒ í™”ë©´ë„ ìˆ¨ê¹€
            commonLearningScreen.classList.add('hidden');
            largeCategorySelectionArea.classList.add('hidden');
            mediumCategorySelectionArea.classList.add('hidden');
            mockTestScreen.classList.add('hidden');
            learningStatisticsScreen.classList.add('hidden');
        }

        // ë‚ ì§œ ë° ì‹œê°„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (UI V2.3)
        function updateDateTime() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('current-date-time').textContent = now.toLocaleDateString('ko-KR', options);
        }
        setInterval(updateDateTime, 1000); // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        updateDateTime(); // ì´ˆê¸° ë¡œë“œ ì‹œ ë°”ë¡œ ì—…ë°ì´íŠ¸

        // CSV íŒŒì¼ ë¡œë”© í•¨ìˆ˜ (ìˆ˜ì •ë¨: ins_master_db.csv + ì¸ìŠ¤êµì¬+ì¤‘ê°œì‚¬ì‹œí—˜)
        async function loadCSVData() {
            // loadingStatusì™€ loadingProgressëŠ” í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì°¸ì¡°
            const loadingStatus = document.getElementById('loading-status');
            const loadingProgress = document.getElementById('loading-progress');
            
            try {
                loadingStatus.textContent = "ins_master_db.csv íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...";
                loadingProgress.style.width = "10%";
                
                const response = await fetch('ins_master_db.csv');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                loadingStatus.textContent = "ëŒ€ìš©ëŸ‰ CSV íŒŒì¼ íŒŒì‹± ì¤‘... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”)";
                loadingProgress.style.width = "50%";
                
                const csvContent = await response.text();
                
                loadingStatus.textContent = "ì „ì²´ ë¬¸ì œ ë°ì´í„° ì²˜ë¦¬ ì¤‘...";
                loadingProgress.style.width = "80%";
                
                const parsed = Papa.parse(csvContent, {
                    header: true,
                    dynamicTyping: false,
                    skipEmptyLines: true,
                    delimiter: ',',
                    quoteChar: '"',
                    fastMode: true
                });
                
                if (parsed.errors.length > 0) {
                    console.warn('CSV íŒŒì‹± ê²½ê³ :', parsed.errors.slice(0, 5));
                }
                
                // ì¸ìŠ¤êµì¬ + ì¤‘ê°œì‚¬ì‹œí—˜ ë¬¸ì œ ëª¨ë‘ í¬í•¨ (ì¡°ëŒ€í‘œë‹˜ ì§€ì‹œ)
                questions = parsed.data.filter(row => 
                    row.QCODE && 
                    (row.SOURCE === 'ì¸ìŠ¤êµì¬' || row.SOURCE === 'ì¤‘ê°œì‚¬ì‹œí—˜')
                );
                
                loadingStatus.textContent = `${questions.length}ê°œ ì „ì²´ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ! (ì¸ìŠ¤êµì¬ + ì¤‘ê°œì‚¬ì‹œí—˜)`;
                loadingProgress.style.width = "100%";
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('total-questions').textContent = questions.length; // ì´ ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸
                
                // ë¡œë”© ì™„ë£Œ í›„ ì•± ì‹œì‘ (UI V2.3ì˜ ëª¨ë“œ ì„ íƒ í™”ë©´ìœ¼ë¡œ ì „í™˜)
                setTimeout(startAppWithModeSelection, 1000); // ì´ì œ í•¨ìˆ˜ê°€ ì´ë¯¸ ì •ì˜ë¨
                
            } catch (error) {
                console.error('CSV ë¡œë”© ì˜¤ë¥˜:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ loadingStatusì™€ loadingProgressê°€ nullì´ ì•„ë‹˜ì„ ë³´ì¥
                // ì´ì „ì— ì´ë¯¸ DOMì— ì ‘ê·¼í•˜ì—¬ ì˜¤ë¥˜ê°€ ë‚¬ìœ¼ë¯€ë¡œ, ì´ ë¶€ë¶„ì€ ì•ˆì „í•˜ê²Œ ì‹¤í–‰
                if (loadingStatus) {
                    loadingStatus.innerHTML = `
                        <span class="text-red-600 font-bold">CSV ë¡œë”© ì‹¤íŒ¨: ${error.message}</span><br>
                        <span class="text-sm mt-2">í•´ê²° ë°©ë²•:</span><br>
                        <span class="text-sm">1. ins_master_db.csv íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸</span><br>
                        <span class="text-sm">2. GitHub Pagesì—ì„œ ì‹¤í–‰ (ê¶Œì¥)</span><br>
                        <span class="text-sm">3. ë¡œì»¬ ì›¹ì„œë²„ ì‚¬ìš© (python -m http.server)</span>
                    `;
                }
                if (loadingProgress) {
                    loadingProgress.style.width = "0%";
                }
            }
        }

        // í€´ì¦ˆ ì‹œì‘ (ì„ íƒëœ ëª¨ë“œì— ë”°ë¼ ë¬¸ì œ í‘œì‹œ)
        // ì´ í•¨ìˆ˜ëŠ” ëª¨ë“œ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
        function startQuizInMode(modeId, modeText) {
            hideAllModeScreens(); // ëª¨ë“  í™”ë©´ ìˆ¨ê¹€
            currentModeDisplay.textContent = modeText; // í—¤ë” ëª¨ë“œ ì—…ë°ì´íŠ¸

            // ê° ëª¨ë“œì— ë”°ë¥¸ filteredQuestions ì„¤ì • ë° UI ìš”ì†Œ í‘œì‹œ/ìˆ¨ê¹€
            if (modeId === 'basic-learning') {
                commonLearningScreen.classList.remove('hidden');
                filteredQuestions = questions; // ê¸°ë³¸ í•™ìŠµ: ëª¨ë“  ë¬¸ì œ
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'large-category-learning') {
                commonLearningScreen.classList.remove('hidden');
                largeCategorySelectionArea.classList.remove('hidden');
                filteredQuestions = questions; // ì„ì‹œ: ëª¨ë“  ë¬¸ì œ
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'medium-category-learning') {
                commonLearningScreen.classList.remove('hidden');
                largeCategorySelectionArea.classList.remove('hidden');
                mediumCategorySelectionArea.classList.remove('hidden');
                filteredQuestions = questions; // ì„ì‹œ: ëª¨ë“  ë¬¸ì œ
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'multiple-choice-learning') {
                commonLearningScreen.classList.remove('hidden');
                filteredQuestions = questions.filter(q => q.TYPE === 'ì„ íƒí˜•');
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'true-false-learning') {
                commonLearningScreen.classList.remove('hidden');
                filteredQuestions = questions.filter(q => q.TYPE === 'ì§„ìœ„í˜•');
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'mock-test') {
                mockTestScreen.classList.remove('hidden');
                commonLearningScreen.classList.remove('hidden');
                filteredQuestions = questions.slice(0, 20); // ì„ì‹œ 20ë¬¸ì œ
                currentQuestionIndex = 0;
                displayQuestion();
                updateStats();
            } else if (modeId === 'learning-statistics') {
                learningStatisticsScreen.classList.remove('hidden');
            }
        }

        // ë¬¸ì œ í‘œì‹œ
        function displayQuestion() {
            if (filteredQuestions.length === 0) {
                document.getElementById('question-text').textContent = "ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                trueFalseOptions.classList.add('hidden');
                multipleChoiceOptions.classList.add('hidden');
                return;
            }

            const question = filteredQuestions[currentQuestionIndex];
            
            // ë¬¸ì œ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('question-type').textContent = question.TYPE;
            document.getElementById('question-code').textContent = question.QCODE;
            document.getElementById('question-text').textContent = question.QUESTION;
            document.getElementById('layer-info').textContent = `${question.LAYER1 || 'N/A'} > ${question.LAYER2 || 'N/A'}`;

            // ë‹µì•ˆ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
            trueFalseOptions.classList.add('hidden');
            multipleChoiceOptions.classList.add('hidden');
            if (question.TYPE === 'ì§„ìœ„í˜•') {
                trueFalseOptions.classList.remove('hidden');
            } else if (question.TYPE === 'ì„ íƒí˜•') {
                multipleChoiceOptions.classList.remove('hidden');
            }
            
            // ìƒíƒœ ì´ˆê¸°í™”
            selectedAnswer = null;
            answered = false;
            document.getElementById('result-display').classList.add('hidden');
            document.getElementById('check-answer-btn').classList.remove('hidden');
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'border-blue-500', 'border-2', 'bg-green-300', 'bg-red-300');
                btn.disabled = false;
            });
            
            // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ìƒíƒœ
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
        }

        // ë‹µì•ˆ ì„ íƒ
        function selectAnswer(answer) {
            if (answered) return;
            
            selectedAnswer = answer;
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'border-blue-500', 'border-2');
            });
            
            document.querySelector(`[data-answer="${answer}"]`).classList.add('bg-blue-200', 'border-blue-500', 'border-2');
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswer() {
            if (!selectedAnswer || answered) return;
            
            const question = filteredQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.ANSWER;
            
            answered = true;
            stats.totalAnswered++;
            if (isCorrect) stats.correctCount++;
            
            const resultDisplay = document.getElementById('result-display');
            
            if (isCorrect) {
                resultDisplay.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                resultDisplay.className = 'mt-4 text-center text-2xl font-bold text-green-600';
            } else {
                resultDisplay.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤ ğŸ˜”';
                resultDisplay.className = 'mt-4 text-center text-2xl font-bold text-red-600';
            }
            
            resultDisplay.classList.remove('hidden');
            document.getElementById('check-answer-btn').classList.add('hidden');
            
            // ì •ë‹µ í‘œì‹œ
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.answer === question.ANSWER) {
                    btn.classList.add('bg-green-300');
                } else if (btn.dataset.answer === selectedAnswer && selectedAnswer !== question.ANSWER) {
                    btn.classList.add('bg-red-300');
                }
            });
            
            updateStats();
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                alert('ì´ ëª¨ë“œì˜ ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰');
                hideAllModeScreens();
                modeSelectionScreen.classList.remove('hidden');
            }
        }

        // ì´ì „ ë¬¸ì œ
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('total-questions').textContent = filteredQuestions.length;
            document.getElementById('correct-count').textContent = stats.correctCount;
            document.getElementById('incorrect-count').textContent = stats.totalAnswered - stats.correctCount;
            const accuracy = stats.totalAnswered > 0 ? Math.round((stats.correctCount / stats.totalAnswered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') prevQuestion();
            if (e.key === 'ArrowRight') nextQuestion();
            if (e.key === 'Enter') checkAnswer();
            if (e.key === '1' || e.key === '2' || e.key === '3' || e.key === '4') selectAnswer(e.key);
            if (e.key === 'o' || e.key === 'O') selectAnswer('O');
            if (e.key === 'x' || e.key === 'X') selectAnswer('X');
            if (e.key === 'Escape') {
                hideAllModeScreens();
                modeSelectionScreen.classList.remove('hidden');
                currentModeDisplay.textContent = 'ëª¨ë“œ ì„ íƒ';
            }
        });

        // ëª¨ë“œ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('#mode-selection-screen button').forEach(button => {
            button.addEventListener('click', () => {
                const modeText = button.textContent.trim();
                const modeId = button.dataset.mode;
                startQuizInMode(modeId, modeText);
            });
        });

        // ì„¤ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        settingsBtn.addEventListener('click', () => {
            settingsModal.classList.remove('hidden');
            settingsModal.classList.add('show');
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.classList.remove('show');
                settingsModal.classList.add('hidden');
            }
        });

        // ì•± ì‹œì‘ í•¨ìˆ˜ (UI V2.3ì˜ ëª¨ë“œ ì„ íƒ í™”ë©´ìœ¼ë¡œ ì „í™˜)
        function startAppWithModeSelection() {
            document.getElementById('loading-area').classList.add('hidden');
            document.getElementById('mode-selection-screen').classList.remove('hidden'); // ëª¨ë“œ ì„ íƒ í™”ë©´ í‘œì‹œ
            document.getElementById('current-mode').textContent = 'ëª¨ë“œ ì„ íƒ'; // í—¤ë” ëª¨ë“œ ì´ˆê¸°í™”
            updateStats(); // í†µê³„ ì´ˆê¸° ì—…ë°ì´íŠ¸
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ CSV ë°ì´í„° ë¡œë”© ì‹œì‘
        window.addEventListener('load', loadCSVData);
    </script>
</body>
</html>