<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICU í•™ìŠµ ì•± (ë¶„ë¦¬í˜•)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f3f4f6;
        }
        .selected-btn {
            background-color: #3b82f6 !important;
            color: white !important;
            border: 2px solid #1d4ed8 !important;
        }
        .correct-btn {
            background-color: #10b981 !important;
            color: white !important;
            border: 2px solid #059669 !important;
        }
        .incorrect-btn {
            background-color: #ef4444 !important;
            color: white !important;
            border: 2px solid #dc2626 !important;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="app-container" class="bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">AICU í•™ìŠµ ì•± (ë¶„ë¦¬í˜•)</h1>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loading-area" class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-600">CSV ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            <p id="loading-status" class="text-sm text-gray-500 mt-2"></p>
        </div>

        <!-- ë©”ì¸ ì•± ì˜ì—­ (ë¡œë”© ì™„ë£Œ í›„ í‘œì‹œ) -->
        <div id="main-app" class="hidden">
            <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
            <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>ë¬¸ì œ <span id="current-number">1</span> / <span id="total-number">0</span></span>
                    <span>ì •ë‹µë¥ : <span id="accuracy">0</span>%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <!-- ë¬¸ì œ ì˜ì—­ -->
            <div class="mb-6">
                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                    <div class="text-sm text-gray-500 mb-2">
                        <span id="question-type">ì§„ìœ„í˜•</span> | 
                        <span id="question-layer">ëŒ€ë¶„ë¥˜</span> |
                        <span id="question-qcode">QCODE</span>
                    </div>
                    <!-- ë¬¸ì œ ë‚´ìš©ì„ íŒŒì‹± ì—†ì´ ê·¸ëŒ€ë¡œ í‘œì‹œ -->
                    <div id="question-text" class="text-lg font-medium text-gray-800 whitespace-pre-wrap leading-relaxed">
                        ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
            </div>

            <!-- ë‹µë³€ ë²„íŠ¼ ì˜ì—­ -->
            <div id="answer-buttons" class="mb-6">
                <!-- ì§„ìœ„í˜• ë²„íŠ¼ -->
                <div id="true-false-buttons" class="hidden flex gap-4">
                    <button id="btn-true" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="O">
                        O (ë§ë‹¤)
                    </button>
                    <button id="btn-false" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="X">
                        X (í‹€ë¦¬ë‹¤)
                    </button>
                </div>
                
                <!-- ì„ íƒí˜• ë²„íŠ¼ -->
                <div id="choice-buttons" class="hidden grid grid-cols-2 gap-3">
                    <button id="btn-1" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="1">
                        1ë²ˆ
                    </button>
                    <button id="btn-2" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="2">
                        2ë²ˆ
                    </button>
                    <button id="btn-3" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="3">
                        3ë²ˆ
                    </button>
                    <button id="btn-4" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="4">
                        4ë²ˆ
                    </button>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="result-area" class="hidden mb-6 p-4 rounded-lg">
                <div id="result-message" class="text-lg font-bold mb-2"></div>
                <div id="explanation-area" class="text-sm text-gray-600 bg-gray-50 p-3 rounded border"></div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
            <div class="flex justify-between items-center">
                <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-200">
                    ì´ì „ ë¬¸ì œ
                </button>
                
                <div class="flex gap-3">
                    <button id="submit-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
                        ì •ë‹µ í™•ì¸
                    </button>
                    <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
                        ë‹¤ìŒ ë¬¸ì œ
                    </button>
                </div>
            </div>

            <!-- í†µê³„ ì •ë³´ -->
            <div class="mt-6 bg-gray-50 p-4 rounded-lg text-sm">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="font-bold text-gray-800" id="total-answered">0</div>
                        <div class="text-gray-600">í‘¼ ë¬¸ì œ</div>
                    </div>
                    <div>
                        <div class="font-bold text-green-600" id="total-correct">0</div>
                        <div class="text-gray-600">ì •ë‹µ</div>
                    </div>
                    <div>
                        <div class="font-bold text-red-600" id="total-incorrect">0</div>
                        <div class="text-gray-600">ì˜¤ë‹µ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // ì „ì—­ ë³€ìˆ˜
        // ========================================
        let questions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let isAnswered = false;
        let stats = {
            totalAnswered: 0,
            correctCount: 0,
            incorrectCount: 0
        };

        // ========================================
        // DOM ìš”ì†Œ
        // ========================================
        const loadingArea = document.getElementById('loading-area');
        const loadingStatus = document.getElementById('loading-status');
        const mainApp = document.getElementById('main-app');
        const currentNumberElem = document.getElementById('current-number');
        const totalNumberElem = document.getElementById('total-number');
        const accuracyElem = document.getElementById('accuracy');
        const progressBarElem = document.getElementById('progress-bar');
        const questionTypeElem = document.getElementById('question-type');
        const questionLayerElem = document.getElementById('question-layer');
        const questionQcodeElem = document.getElementById('question-qcode');
        const questionTextElem = document.getElementById('question-text');
        const trueFalseButtons = document.getElementById('true-false-buttons');
        const choiceButtons = document.getElementById('choice-buttons');
        const resultArea = document.getElementById('result-area');
        const resultMessage = document.getElementById('result-message');
        const explanationArea = document.getElementById('explanation-area');
        const prevBtn = document.getElementById('prev-btn');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const totalAnsweredElem = document.getElementById('total-answered');
        const totalCorrectElem = document.getElementById('total-correct');
        const totalIncorrectElem = document.getElementById('total-incorrect');

        // ========================================
        // CSV ë°ì´í„° ë¡œë”© í•¨ìˆ˜
        // ========================================
        async function loadCSVData() {
            try {
                loadingStatus.textContent = 'ins_master_db.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                
                const response = await fetch('ins_master_db.csv');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                loadingStatus.textContent = 'CSV ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘...';
                
                return new Promise((resolve, reject) => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            if (results.errors.length > 0) {
                                console.warn('CSV íŒŒì‹± ê²½ê³ :', results.errors);
                            }
                            
                            // ì¸ìŠ¤êµì¬ ë¬¸ì œë§Œ í•„í„°ë§ (index.htmlê³¼ ë™ì¼í•˜ê²Œ)
                            const validQuestions = results.data.filter(row => 
                                row.SOURCE === 'ì¸ìŠ¤êµì¬' && 
                                row.QCODE && 
                                row.QUESTION && 
                                row.ANSWER
                            );
                            
                            loadingStatus.textContent = `${validQuestions.length}ê°œ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ!`;
                            resolve(validQuestions);
                        },
                        error: function(error) {
                            reject(error);
                        }
                    });
                });
                
            } catch (error) {
                loadingStatus.textContent = `ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`;
                console.error('CSV ë¡œë”© ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ========================================
        // í•µì‹¬ í•¨ìˆ˜ë“¤
        // ========================================

        // ë¬¸ì œ í‘œì‹œ í•¨ìˆ˜ (íŒŒì‹± ì—†ì´ ê·¸ëŒ€ë¡œ í‘œì‹œ)
        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            
            // ë¬¸ì œ ì •ë³´ ì—…ë°ì´íŠ¸
            currentNumberElem.textContent = currentQuestionIndex + 1;
            totalNumberElem.textContent = questions.length;
            questionTypeElem.textContent = question.TYPE || 'ì§„ìœ„í˜•';
            questionLayerElem.textContent = question.LAYER1 || 'ì¼ë°˜';
            questionQcodeElem.textContent = question.QCODE || 'N/A';
            
            // ë¬¸ì œ ë‚´ìš©ì„ íŒŒì‹± ì—†ì´ ê·¸ëŒ€ë¡œ í‘œì‹œ (ì¡°ëŒ€í‘œë‹˜ ìš”êµ¬ì‚¬í•­)
            questionTextElem.textContent = question.QUESTION || 'ë¬¸ì œ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
            
            // ë¬¸ì œ ìœ í˜•ì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ
            if (question.TYPE === 'ì§„ìœ„í˜•') {
                trueFalseButtons.classList.remove('hidden');
                choiceButtons.classList.add('hidden');
            } else if (question.TYPE === 'ì„ íƒí˜•') {
                trueFalseButtons.classList.add('hidden'); 
                choiceButtons.classList.remove('hidden');
            } else {
                // ìœ í˜•ì´ ëª…í™•í•˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ ì§„ìœ„í˜• í‘œì‹œ
                trueFalseButtons.classList.remove('hidden');
                choiceButtons.classList.add('hidden');
            }
            
            // ìƒíƒœ ì´ˆê¸°í™”
            selectedAnswer = null;
            isAnswered = false;
            resultArea.classList.add('hidden');
            submitBtn.style.display = 'inline-block';
            
            // ëª¨ë“  ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            resetButtonStyles();
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateProgress();
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateButtonStates();
        }

        // ë‹µì•ˆ ì„ íƒ í•¨ìˆ˜
        function selectAnswer(answer) {
            if (isAnswered) return;
            
            selectedAnswer = answer;
            
            // ëª¨ë“  ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            resetButtonStyles();
            
            // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            const buttons = document.querySelectorAll('[data-answer]');
            buttons.forEach(btn => {
                if (btn.dataset.answer === answer) {
                    btn.classList.add('selected-btn');
                }
            });
        }

        // ì •ë‹µ í™•ì¸ í•¨ìˆ˜
        function checkAnswer() {
            if (!selectedAnswer || isAnswered) return;
            
            const question = questions[currentQuestionIndex];
            const correctAnswer = (question.ANSWER || '').trim();
            const isCorrect = selectedAnswer === correctAnswer;
            
            isAnswered = true;
            stats.totalAnswered++;
            
            if (isCorrect) {
                stats.correctCount++;
                resultMessage.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                resultMessage.className = 'text-lg font-bold mb-2 text-green-600';
            } else {
                stats.incorrectCount++;
                resultMessage.textContent = `ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ "${correctAnswer}"ì…ë‹ˆë‹¤. ğŸ˜”`;
                resultMessage.className = 'text-lg font-bold mb-2 text-red-600';
            }
            
            // í•´ì„¤ í‘œì‹œ
            explanationArea.textContent = question.EXPLAIN || 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.';
            
            // ê²°ê³¼ ì˜ì—­ í‘œì‹œ
            resultArea.classList.remove('hidden');
            submitBtn.style.display = 'none';
            
            // ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            updateAnswerButtonColors(correctAnswer);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStats();
        }

        // ë‹µì•ˆ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        function updateAnswerButtonColors(correctAnswer) {
            const buttons = document.querySelectorAll('[data-answer]');
            buttons.forEach(btn => {
                const btnAnswer = btn.dataset.answer;
                btn.classList.remove('selected-btn');
                
                if (btnAnswer === correctAnswer) {
                    btn.classList.add('correct-btn');
                } else if (btnAnswer === selectedAnswer) {
                    btn.classList.add('incorrect-btn');
                }
            });
        }

        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
        function resetButtonStyles() {
            const buttons = document.querySelectorAll('[data-answer]');
            buttons.forEach(btn => {
                btn.classList.remove('selected-btn', 'correct-btn', 'incorrect-btn');
            });
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBarElem.style.width = progress + '%';
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            totalAnsweredElem.textContent = stats.totalAnswered;
            totalCorrectElem.textContent = stats.correctCount;
            totalIncorrectElem.textContent = stats.incorrectCount;
            
            const accuracy = stats.totalAnswered > 0 ? 
                Math.round((stats.correctCount / stats.totalAnswered) * 100) : 0;
            accuracyElem.textContent = accuracy;
        }

        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateButtonStates() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
            
            prevBtn.style.opacity = prevBtn.disabled ? '0.5' : '1';
            nextBtn.style.opacity = nextBtn.disabled ? '0.5' : '1';
        }

        // ì´ì „ ë¬¸ì œ
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        // ========================================
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        // ========================================

        // ì§„ìœ„í˜• ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('btn-true').addEventListener('click', () => selectAnswer('O'));
        document.getElementById('btn-false').addEventListener('click', () => selectAnswer('X'));

        // ì„ íƒí˜• ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('btn-1').addEventListener('click', () => selectAnswer('1'));
        document.getElementById('btn-2').addEventListener('click', () => selectAnswer('2'));
        document.getElementById('btn-3').addEventListener('click', () => selectAnswer('3'));
        document.getElementById('btn-4').addEventListener('click', () => selectAnswer('4'));

        // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì´ë²¤íŠ¸
        prevBtn.addEventListener('click', prevQuestion);
        submitBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', nextQuestion);

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            if (isAnswered) return;
            
            const question = questions[currentQuestionIndex];
            
            if (question && question.TYPE === 'ì§„ìœ„í˜•') {
                if (e.key === 'o' || e.key === 'O') selectAnswer('O');
                if (e.key === 'x' || e.key === 'X') selectAnswer('X');
            } else if (question && question.TYPE === 'ì„ íƒí˜•') {
                if (e.key >= '1' && e.key <= '4') selectAnswer(e.key);
            }
            
            if (e.key === 'Enter' && selectedAnswer) checkAnswer();
            if (e.key === 'ArrowLeft') prevQuestion();
            if (e.key === 'ArrowRight') nextQuestion();
        });

        // ========================================
        // ì•± ì´ˆê¸°í™”
        // ========================================
        async function initApp() {
            try {
                // CSV ë°ì´í„° ë¡œë”©
                questions = await loadCSVData();
                
                if (questions.length === 0) {
                    throw new Error('ìœ íš¨í•œ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                console.log(`AICU í€´ì¦ˆì•± ë¡œë“œ ì™„ë£Œ: ${questions.length}ê°œ ë¬¸ì œ`);
                
                // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ ì•± í‘œì‹œ
                loadingArea.classList.add('hidden');
                mainApp.classList.remove('hidden');
                
                // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
                displayQuestion();
                updateStats();
                
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                loadingStatus.innerHTML = `
                    <span class="text-red-600">âŒ ì•± ë¡œë”© ì‹¤íŒ¨</span><br>
                    <span class="text-sm">${error.message}</span><br>
                    <span class="text-xs text-gray-500 mt-2">
                        ins_master_db.csv íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³ <br>
                        ì›¹ì„œë²„(Live Server ë“±)ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
                    </span>
                `;
            }
        }

        // ì•± ì‹œì‘
        window.addEventListener('load', initApp);
    </script>
</body>
</html>