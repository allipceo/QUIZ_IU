<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICU í•™ìŠµì•± - V2 ëŒ€ë¶„ë¥˜ë³„ ë¬¸ì œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .question-container { min-height: 200px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="main-start-area" class="flex flex-col items-center justify-center min-h-[60vh]">
      <button id="start-quiz-btn" class="bg-blue-600 hover:bg-blue-800 text-white text-2xl font-bold py-6 px-16 rounded-lg shadow-lg transition duration-200 mb-8">ì²˜ìŒë¶€í„° ë¬¸ì œí’€ê¸°</button>
    </div>
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">AICU í•™ìŠµì•± - ëŒ€ë¶„ë¥˜ë³„ ë¬¸ì œ (V2)</h1>
        <!-- ëŒ€ë¶„ë¥˜ ë²„íŠ¼ ê·¸ë£¹ -->
        <div id="layer1-buttons" class="flex flex-wrap gap-2 justify-center mb-6"></div>
        <!-- ëª¨ë“œ ì„ íƒ í™”ë©´ -->
        <div id="mode-selection-screen" class="flex flex-wrap gap-4 justify-center mb-8">
            <button id="mode-layer1" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded">ëŒ€ë¶„ë¥˜ë³„ ë¬¸ì œ</button>
            <button id="mode-incorrect" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded">í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ í’€ê¸°</button>
            <button id="mode-mocktest" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded">ëª¨ì˜ê³ ì‚¬</button>
            <button id="mode-layer2" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded">ì¤‘ë¶„ë¥˜ í•™ìŠµ</button>
        </div>
        <!-- ëŒ€ë¶„ë¥˜ ì„ íƒ ì˜ì—­ -->
        <div id="large-category-selection-area" class="hidden flex flex-wrap gap-2 justify-center mb-4"></div>
        <!-- ì§„ìœ„í˜•/ì„ íƒí˜• ì„ íƒ ì˜ì—­ -->
        <div id="question-type-selection-area" class="hidden flex flex-wrap gap-4 justify-center mb-6">
            <h3 class="w-full text-center text-lg font-semibold text-gray-700 mb-4">ë¬¸ì œ ìœ í˜• ì„ íƒ</h3>
            <button id="type-true-false" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition duration-200">ì§„ìœ„í˜• ë¬¸ì œ</button>
            <button id="type-choice" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-200">ì„ íƒí˜• ë¬¸ì œ</button>
        </div>
        <!-- ì¤‘ë¶„ë¥˜ ì„ íƒ ì˜ì—­ -->
        <div id="medium-category-selection-area" class="hidden flex flex-wrap gap-2 justify-center mb-6">
            <div id="layer2-buttons" class="flex flex-wrap gap-2"></div>
        </div>
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loading-area" class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p id="loading-status" class="text-gray-600">ins_789_final_dev.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                <div id="loading-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
        <!-- ì§„í–‰ ìƒí™© -->
        <div id="progress-area" class="hidden bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm text-gray-600">ì§„í–‰ë¥ </span>
                <span id="progress-text" class="text-sm font-medium">1 / 789</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0.1%"></div>
            </div>
        </div>
        <!-- ë¬¸ì œ ì˜ì—­ -->
        <div id="quiz-area" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6 relative">
            <button id="go-home-btn" class="absolute top-2 right-2 bg-blue-200 hover:bg-blue-400 text-blue-800 font-bold py-1 px-3 rounded">ëŒ€ë¬¸ìœ¼ë¡œ</button>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span id="question-type" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">ì§„ìœ„í˜•</span>
                    <span id="question-code" class="text-sm text-gray-500">ABANK-0001</span>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">ë¬¸ì œ</h2>
                    <div class="text-xs text-gray-500">
                        <span id="layer-info">06ì¬ì‚°ë³´í—˜ > í™”ì¬ë³´í—˜</span>
                    </div>
                </div>
            </div>
            <div class="question-container mb-6">
                <p id="question-text" class="text-gray-800 leading-relaxed whitespace-pre-wrap">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <!-- ì§„ìœ„í˜• ë‹µì•ˆ -->
            <div id="true-false-buttons" class="hidden grid grid-cols-2 gap-4 mb-6">
                <button onclick="selectAnswer('O')" class="answer-btn bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="O">O (ë§ë‹¤)</button>
                <button onclick="selectAnswer('X')" class="answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg transition duration-200" data-answer="X">X (í‹€ë¦¬ë‹¤)</button>
            </div>
            <!-- ì„ íƒí˜• ë‹µì•ˆ -->
<<<<<<< HEAD
            <div id="choice-buttons" class="hidden grid grid-cols-4 gap-4 mb-6">
                <button onclick="selectAnswer('1')" class="answer-btn text-center bg-gray-100 hover:bg-gray-200 text-gray-800 py-4 px-2 rounded-lg transition duration-200" data-answer="1">1ë²ˆ</button>
                <button onclick="selectAnswer('2')" class="answer-btn text-center bg-gray-100 hover:bg-gray-200 text-gray-800 py-4 px-2 rounded-lg transition duration-200" data-answer="2">2ë²ˆ</button>
                <button onclick="selectAnswer('3')" class="answer-btn text-center bg-gray-100 hover:bg-gray-200 text-gray-800 py-4 px-2 rounded-lg transition duration-200" data-answer="3">3ë²ˆ</button>
                <button onclick="selectAnswer('4')" class="answer-btn text-center bg-gray-100 hover:bg-gray-200 text-gray-800 py-4 px-2 rounded-lg transition duration-200" data-answer="4">4ë²ˆ</button>
=======
            <div id="choice-buttons" class="hidden grid grid-cols-4 gap-3 mb-6">
                <button onclick="selectAnswer('1')" class="answer-btn bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-2 rounded-lg transition duration-200 text-sm font-semibold" data-answer="1">1ë²ˆ</button>
                <button onclick="selectAnswer('2')" class="answer-btn bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-2 rounded-lg transition duration-200 text-sm font-semibold" data-answer="2">2ë²ˆ</button>
                <button onclick="selectAnswer('3')" class="answer-btn bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-2 rounded-lg transition duration-200 text-sm font-semibold" data-answer="3">3ë²ˆ</button>
                <button onclick="selectAnswer('4')" class="answer-btn bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-2 rounded-lg transition duration-200 text-sm font-semibold" data-answer="4">4ë²ˆ</button>
>>>>>>> ff257eacab3b565f444e37fc9a5ca8bd2dba6f3a
            </div>
            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div id="result-area" class="hidden mb-6 p-4 rounded-lg">
                <p id="result-text" class="font-bold text-lg mb-2"></p>
                <p id="correct-answer" class="text-sm text-gray-600"></p>
                <div id="explanation-area" class="mt-3 p-3 bg-gray-50 rounded border hidden">
                    <p class="text-sm text-gray-700" id="explanation-text"></p>
                </div>
            </div>
            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
            <div class="flex justify-between">
                <button onclick="prevQuestion()" id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-200">ì´ì „</button>
                <button onclick="checkAnswer()" id="check-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">ì •ë‹µ í™•ì¸</button>
                <button onclick="nextQuestion()" id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">ë‹¤ìŒ</button>
            </div>
        </div>
        <!-- ëª¨ì˜ê³ ì‚¬ í™”ë©´ -->
        <div id="mock-test-screen" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="mb-4 flex justify-between items-center">
                <span class="text-lg font-bold text-purple-700">ëœë¤ ëª¨ì˜ê³ ì‚¬</span>
                <span id="mock-test-progress" class="text-sm text-gray-500">1 / 20</span>
            </div>
            <div class="mb-4">
                <span id="mock-test-total-questions" class="text-xs text-gray-500">ì´ 20ë¬¸ì œ</span>
            </div>
            <div id="mock-test-question-area"></div>
            <div class="mt-6 flex justify-end">
                <button id="mock-test-finish-btn" class="bg-gray-400 text-white font-bold py-2 px-6 rounded" disabled>ì‹œí—˜ ì¢…ë£Œ ë° ê²°ê³¼ ë³´ê¸°</button>
            </div>
        </div>
        <!-- í†µê³„ -->
        <div id="stats-area" class="hidden bg-white rounded-lg shadow p-4">
            <h3 class="font-bold mb-2">í•™ìŠµ í†µê³„</h3>
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <div id="total-answered" class="text-2xl font-bold text-blue-600">0</div>
                    <div class="text-sm text-gray-600">í‘¼ ë¬¸ì œ</div>
                </div>
                <div>
                    <div id="correct-count" class="text-2xl font-bold text-green-600">0</div>
                    <div class="text-sm text-gray-600">ì •ë‹µ</div>
                </div>
                <div>
                    <div id="accuracy" class="text-2xl font-bold text-purple-600">0%</div>
                    <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                </div>
                <div>
                    <div id="remaining" class="text-2xl font-bold text-orange-600">789</div>
                    <div class="text-sm text-gray-600">ë‚¨ì€ ë¬¸ì œ</div>
                </div>
            </div>
        </div>
        <!-- íŒŒì¼ ì •ë³´ -->
        <div class="mt-4 text-center text-sm text-gray-500">
            <p>ë°ì´í„° ì†ŒìŠ¤: <span id="data-source">ins_789_final_dev.csv</span></p>
            <p>ë¡œë“œëœ ë¬¸ì œ ìˆ˜: <span id="loaded-count">0</span>ê°œ</p>
            <p class="mt-2 text-xs">ğŸŒ GitHub Pages ë˜ëŠ” ë¡œì»¬ ì›¹ì„œë²„ì—ì„œ ì™„ë²½ ë™ì‘</p>
        </div>
    </div>
    <!-- 1. í•´ì„¤ ëª¨ë‹¬ UI ì¶”ê°€ (body í•˜ë‹¨) -->
    <div id="explain-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full relative">
        <button id="close-explain-modal" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
        <h2 class="text-xl font-bold mb-4">AI í•´ì„¤</h2>
        <div id="explain-modal-content" class="text-gray-800 whitespace-pre-wrap min-h-[80px]">í•´ì„¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    </div>
    <!-- ì´ì–´ì„œ/ì²˜ìŒë¶€í„° ì„ íƒ ëª¨ë‹¬ -->
    <div id="resume-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative">
        <h2 class="text-lg font-bold mb-4">ì´ì–´ì„œ í’€ê¸°</h2>
        <p class="mb-4">ì´ì „ì— í‘¼ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ì‹œì‘í• ê¹Œìš”?</p>
        <div class="flex gap-4 justify-center">
          <button id="resume-continue" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">ì´ì–´ì„œ í’€ê¸°</button>
          <button id="resume-from-beginning" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">ë§¨ ì²˜ìŒë¶€í„°</button>
        </div>
        <button id="resume-cancel" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
      </div>
    </div>
    <script>
        let questions = [];
        let filteredQuestions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let answered = false;
        let stats = { totalAnswered: 0, correctCount: 0 };
        let layer1List = [];
        let currentLayer1 = null;
        let selectedLayer1 = null;
        let lastSolvedIndex = null;
        // CSV íŒŒì¼ ë¡œë”© í•¨ìˆ˜ (ì „ì²´ ë¬¸ì œ)
        async function loadCSVData() {
            const loadingStatus = document.getElementById('loading-status');
            const loadingProgress = document.getElementById('loading-progress');
            try {
                loadingStatus.textContent = "ins_789_final_dev.csv íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...";
                loadingProgress.style.width = "10%";
                const response = await fetch('ins_789_final_dev.csv');
                if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                loadingStatus.textContent = "CSV íŒŒì¼ íŒŒì‹± ì¤‘...";
                loadingProgress.style.width = "50%";
                const csvContent = await response.text();
                loadingStatus.textContent = "ë¬¸ì œ ë°ì´í„° ì²˜ë¦¬ ì¤‘...";
                loadingProgress.style.width = "80%";
                const parsed = Papa.parse(csvContent, {
                    header: true,
                    dynamicTyping: false,
                    skipEmptyLines: true,
                    delimiter: ',',
                    quoteChar: '"',
                    fastMode: true
                });
                if (parsed.errors.length > 0) {
                    console.warn('CSV íŒŒì‹± ê²½ê³ :', parsed.errors.slice(0, 5));
                }
                // ë…¸íŒ€ì¥ ë°©ì‹: QCODEë§Œ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ í¬í•¨
                questions = parsed.data.filter(row => row.QCODE);
                // ì´í›„ ê¸°ì¡´ index2.htmlì˜ ëŒ€ë¶„ë¥˜/ëª¨ë“œë³„ ë¡œì§ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                const layer1Set = new Set(questions.map(q => q.LAYER1 && q.LAYER1.trim()).filter(Boolean));
                layer1List = Array.from(layer1Set).sort();
                const layer1Buttons = document.getElementById('layer1-buttons');
                layer1Buttons.innerHTML = '';
                layer1List.forEach(layer1 => {
                    const btn = document.createElement('button');
                    btn.textContent = layer1;
                    btn.className = 'bg-blue-100 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded transition duration-200';
                    btn.onclick = () => selectLayer1(layer1);
                    layer1Buttons.appendChild(btn);
                });
                currentLayer1 = layer1List[0];
                filteredQuestions = questions.filter(q => q.LAYER1 && q.LAYER1.trim() === currentLayer1);
                loadingStatus.textContent = `${questions.length}ê°œ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ!`;
                loadingProgress.style.width = "100%";
                document.getElementById('loaded-count').textContent = questions.length;
                document.getElementById('total-questions-display').textContent = `ì „ì²´ ë¬¸ì œ: ${questions.length}ê°œ`;
                document.getElementById('progress-text').textContent = `1 / ${filteredQuestions.length}`;
                document.getElementById('remaining').textContent = filteredQuestions.length;
                
                // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ë¡œë”© ì™„ë£Œ í›„ ëŒ€ë¶„ë¥˜ ì„ íƒ í™”ë©´ í‘œì‹œ (ë°”ë¡œ í€´ì¦ˆ ì‹œì‘í•˜ì§€ ì•ŠìŒ)
                document.getElementById('loading-area').classList.add('hidden');
                document.getElementById('large-category-selection-area').classList.remove('hidden');
                
                // ì²« ë²ˆì§¸ ëŒ€ë¶„ë¥˜ ìë™ ì„ íƒ
                if (layer1List.length > 0) {
                    selectLayer1(layer1List[0]);
                }
            } catch (error) {
                console.error('CSV ë¡œë”© ì˜¤ë¥˜:', error);
                loadingStatus.innerHTML = `<span class="text-red-600 font-bold">CSV ë¡œë”© ì‹¤íŒ¨: ${error.message}</span>`;
                loadingProgress.style.width = "0%";
            }
        }
        function selectLayer1(layer1) {
            currentLayer1 = layer1;
            // ëŒ€ë¶„ë¥˜ ì„ íƒ í›„ ì§„ìœ„í˜•/ì„ íƒí˜• ì„ íƒ í™”ë©´ í‘œì‹œ
            document.getElementById('large-category-selection-area').classList.add('hidden');
            document.getElementById('question-type-selection-area').classList.remove('hidden');
            
            // ì„ íƒëœ ëŒ€ë¶„ë¥˜ ì •ë³´ ì €ì¥
            selectedLayer1 = layer1;
        }
        
        // ì§„ìœ„í˜• ë¬¸ì œ ì„ íƒ í•¨ìˆ˜
        function selectTrueFalseType() {
            // ì§„ìœ„í˜• ë¬¸ì œë§Œ í•„í„°ë§
            filteredQuestions = questions.filter(q => 
                q.LAYER1 && q.LAYER1.trim() === selectedLayer1 && 
                (q.TYPE === 'ì§„ìœ„í˜•' || q.TYPE === 'ì§„ìœ„í—' || q.TYPE === 'í¬ì¸íŠ¸')
            );
            
            if (filteredQuestions.length === 0) {
                alert('í•´ë‹¹ ëŒ€ë¶„ë¥˜ì— ì§„ìœ„í˜• ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentQuestionIndex = 0;
            document.getElementById('question-type-selection-area').classList.add('hidden');
            startQuiz();
        }
        
        // ì„ íƒí˜• ë¬¸ì œ ì„ íƒ í•¨ìˆ˜
        function selectChoiceType() {
            // ì„ íƒí˜• ë¬¸ì œë§Œ í•„í„°ë§
            filteredQuestions = questions.filter(q => 
                q.LAYER1 && q.LAYER1.trim() === selectedLayer1 && 
                q.TYPE === 'ì„ íƒí˜•'
            );
            
            if (filteredQuestions.length === 0) {
                alert('í•´ë‹¹ ëŒ€ë¶„ë¥˜ì— ì„ íƒí˜• ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentQuestionIndex = 0;
            document.getElementById('question-type-selection-area').classList.add('hidden');
            startQuiz();
        }
        
        function startQuiz() {
            document.getElementById('loading-area').classList.add('hidden');
            document.getElementById('progress-area').classList.remove('hidden');
            document.getElementById('quiz-area').classList.remove('hidden');
            document.getElementById('stats-area').classList.remove('hidden');
            displayQuestion();
            updateStats();
        }
        function displayQuestion() {
            if (filteredQuestions.length === 0) {
                document.getElementById('question-text').textContent = "í•´ë‹¹ ëŒ€ë¶„ë¥˜ì— ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }
            const question = filteredQuestions[currentQuestionIndex];
            document.getElementById('question-type').textContent = question.TYPE;
            document.getElementById('question-code').textContent = question.QCODE;
            
            // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ë¬¸ì œ í•„ë“œ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ í‘œì‹œ (íŒŒì‹±/ë¶„ì„ ì—†ìŒ)
            // ì§„ìœ„í˜•ì´ë“  ì„ íƒí˜•ì´ë“  ë¬¸ì œ í•„ë“œ ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ
            document.getElementById('question-text').innerHTML = question.QUESTION;
            
            document.getElementById('layer-info').textContent = `${question.LAYER1} > ${question.LAYER2}`;
            document.getElementById('progress-text').textContent = `${currentQuestionIndex + 1} / ${filteredQuestions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIndex + 1) / filteredQuestions.length) * 100}%`;
            
            // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ë¬¸ì œ ìœ í˜•ì— ë”°ë¼ ë²„íŠ¼ë§Œ ë‹¤ë¥´ê²Œ í‘œì‹œ
            const questionType = question.TYPE;
            let normalizedType = questionType;
            
            // ë¬¸ì œ ìœ í˜• ì •ê·œí™” (ì˜¤íƒ€ ë° ì˜ëª»ëœ ìœ í˜• ìˆ˜ì •)
            if (questionType === 'ì§„ìœ„í˜•' || questionType === 'ì§„ìœ„í—' || questionType === 'í¬ì¸íŠ¸') {
                normalizedType = 'ì§„ìœ„í˜•';
            } else {
                normalizedType = 'ì„ íƒí˜•';
            }
            
            // ì§„ìœ„í˜•: O/X ë²„íŠ¼, ì„ íƒí˜•: 1,2,3,4 ë²„íŠ¼ë§Œ í‘œì‹œ
            if (normalizedType === 'ì§„ìœ„í˜•') {
                document.getElementById('true-false-buttons').classList.remove('hidden');
                document.getElementById('choice-buttons').classList.add('hidden');
            } else {
                // ì„ íƒí˜•: ë¬¸ì œ í•„ë“œ ì „ì²´ í‘œì‹œ + 1,2,3,4 ë²„íŠ¼ë§Œ í‘œì‹œ
                document.getElementById('true-false-buttons').classList.add('hidden');
                document.getElementById('choice-buttons').classList.remove('hidden');
            }
            
            selectedAnswer = null;
            answered = false;
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('explanation-area').classList.add('hidden');
            document.getElementById('check-btn').classList.remove('hidden');
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'border-blue-500', 'border-2', 'bg-green-300', 'bg-red-300');
                btn.disabled = false;
            });
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = answered ? 'block' : 'none';
        }
        function selectAnswer(answer) {
            if (answered) return;
            selectedAnswer = answer;
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'border-blue-500', 'border-2');
            });
            document.querySelector(`[data-answer="${answer}"]`).classList.add('bg-blue-200', 'border-blue-500', 'border-2');
        }
        function checkAnswer() {
            if (!selectedAnswer || answered) return;
            const question = filteredQuestions[currentQuestionIndex];
            
            // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ì‚¬ìš©ì ì„ íƒê°’ê³¼ ì •ë‹µë§Œ ë¹„êµ
            // ì§„ìœ„í˜•: O/X ë¹„êµ, ì„ íƒí˜•: 1,2,3,4 ë¹„êµ
            // ë°ì´í„° íƒ€ì…ì„ ë¬¸ìì—´ë¡œ í†µì¼í•˜ì—¬ ì •í™•í•œ ë¹„êµ
            const userAnswer = String(selectedAnswer);
            const correctAnswer = String(question.ANSWER);
            const isCorrect = userAnswer === correctAnswer;
            
            answered = true;
            stats.totalAnswered++;
            if (isCorrect) stats.correctCount++;
            
            const resultArea = document.getElementById('result-area');
            const resultText = document.getElementById('result-text');
            const correctAnswerText = document.getElementById('correct-answer');
            
            if (isCorrect) {
                resultText.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                resultText.className = 'font-bold text-lg mb-2 text-green-600';
                resultArea.className = 'mb-6 p-4 rounded-lg bg-green-50 border border-green-200';
            } else {
                resultText.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤ ğŸ˜”';
                resultText.className = 'font-bold text-lg mb-2 text-red-600';
                resultArea.className = 'mb-6 p-4 rounded-lg bg-red-50 border border-red-200';
                correctAnswerText.textContent = `ì •ë‹µ: ${correctAnswer}`;
            }
            if (question.EXPLAIN && question.EXPLAIN.trim() !== '') {
                document.getElementById('explanation-text').textContent = question.EXPLAIN;
                document.getElementById('explanation-area').classList.remove('hidden');
            }
            resultArea.classList.remove('hidden');
            document.getElementById('check-btn').classList.add('hidden');
            document.getElementById('next-btn').style.display = 'block';
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.answer === correctAnswer) {
                    btn.classList.add('bg-green-300');
                } else if (btn.dataset.answer === userAnswer && userAnswer !== correctAnswer) {
                    btn.classList.add('bg-red-300');
                }
            });
            updateStats();
            if (!isCorrect) saveIncorrectProblem(question.QCODE);
            // 2. ì •ë‹µ í™•ì¸ í›„ 'í•´ì„¤ ë³´ê¸°' ë²„íŠ¼ í‘œì‹œ
            if (!document.getElementById('explain-btn')) {
              const explainBtn = document.createElement('button');
              explainBtn.id = 'explain-btn';
              explainBtn.className = 'mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105';
              explainBtn.textContent = 'í•´ì„¤ ë³´ê¸° (AI)';
              explainBtn.onclick = () => showExplainModal(question);
              resultArea.appendChild(explainBtn);
            }
            // 2. ì •ë‹µ í™•ì¸ ì‹œ í•™ìŠµ ì´ë ¥ ê¸°ë¡ ë° ì§„ë„ìœ¨ ì—…ë°ì´íŠ¸
            saveLearningHistory({
              qcode: question.QCODE,
              isCorrect,
              mode: getCurrentMode(),
              layer1: question.LAYER1,
              layer2: question.LAYER2
            });
            updateProgressRates();
            saveLastSolvedIndex(); // ë¬¸ì œ í’€ì´ í›„ ë§ˆì§€ë§‰ í’€ì´ ì¸ë±ìŠ¤ ì €ì¥
        }
        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                alert('ì´ ëŒ€ë¶„ë¥˜ì˜ ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰');
            }
        }
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }
        function updateStats() {
            document.getElementById('total-answered').textContent = stats.totalAnswered;
            document.getElementById('correct-count').textContent = stats.correctCount;
            const accuracy = stats.totalAnswered > 0 ? Math.round((stats.correctCount / stats.totalAnswered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('remaining').textContent = filteredQuestions.length - stats.totalAnswered;
        }
        // 2. ì˜¤ë‹µ ë¬¸ì œ LocalStorage ì €ì¥/ê°±ì‹  í•¨ìˆ˜
        function saveIncorrectProblem(qcode) {
            const key = 'aciu_incorrect_problems';
            let data = [];
            try { data = JSON.parse(localStorage.getItem(key)) || []; } catch {}
            const now = new Date().toISOString();
            const idx = data.findIndex(item => item.qcode === qcode);
            if (idx >= 0) {
                data[idx].incorrectCount++;
                data[idx].lastAttempt = now;
            } else {
                data.push({ qcode, incorrectCount: 1, lastAttempt: now });
            }
            localStorage.setItem(key, JSON.stringify(data));
        }
        // 2. í•™ìŠµ ì´ë ¥ ê¸°ë¡ í•¨ìˆ˜
        function saveLearningHistory({qcode, isCorrect, mode, layer1, layer2}) {
          const key = 'aciu_learning_history';
          let data = [];
          try { data = JSON.parse(localStorage.getItem(key)) || []; } catch {}
          const now = new Date().toISOString();
          data.push({ qcode, timestamp: now, isCorrect, mode, layer1, layer2 });
          localStorage.setItem(key, JSON.stringify(data));
        }
        // 3. ì§„ë„ìœ¨ ê³„ì‚° ë° í—¤ë” UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateProgressRates() {
          const key = 'aciu_learning_history';
          let data = [];
          try { data = JSON.parse(localStorage.getItem(key)) || []; } catch {}
          const totalQuestions = questions.length;
          const solvedQcodes = new Set(data.map(d => d.qcode));
          const overallRate = totalQuestions > 0 ? Math.round((solvedQcodes.size / totalQuestions) * 100) : 0;
          document.getElementById('overall-progress-rate').textContent = `ì „ì²´ ì§„ë„ìœ¨: ${overallRate}%`;
          // ì¼ì¼ ì§„ë„ìœ¨
          const today = new Date().toISOString().slice(0, 10);
          const todayData = data.filter(d => d.timestamp.slice(0, 10) === today);
          const todaySolved = todayData.length;
          const todayCorrect = todayData.filter(d => d.isCorrect).length;
          const dailyRate = todaySolved > 0 ? Math.round((todayCorrect / todaySolved) * 100) : 0;
          document.getElementById('daily-progress-rate').textContent = `ì˜¤ëŠ˜ ì§„ë„ìœ¨: ${dailyRate}%`;
        }
        // 4. í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ í’€ê¸° ëª¨ë“œ ì§„ì… í•¨ìˆ˜
        function enterIncorrectMode() {
            const key = 'aciu_incorrect_problems';
            let data = [];
            try { data = JSON.parse(localStorage.getItem(key)) || []; } catch {}
            if (data.length === 0) {
                alert('ì €ì¥ëœ ì˜¤ë‹µ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            // QCODE ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì œ í•„í„°ë§
            filteredQuestions = questions.filter(q => data.some(d => d.qcode === q.QCODE));
            currentQuestionIndex = 0;
            document.getElementById('mode-selection-screen').classList.add('hidden');
            document.getElementById('layer1-buttons').classList.add('hidden');
            startQuiz();
        }
        // 5. ëŒ€ë¶„ë¥˜ ëª¨ë“œ ì§„ì… í•¨ìˆ˜
        function enterLayer1Mode() {
            filteredQuestions = questions.filter(q => q.LAYER1 && q.LAYER1.trim() === currentLayer1);
            currentQuestionIndex = 0;
            document.getElementById('mode-selection-screen').classList.add('hidden');
            document.getElementById('layer1-buttons').classList.remove('hidden');
            startQuiz();
        }
        
        // 6. ì¤‘ë¶„ë¥˜ ëª¨ë“œ ì§„ì… í•¨ìˆ˜
        function enterLayer2Mode() {
            // ì¤‘ë¶„ë¥˜ ëª©ë¡ ìƒì„±
            const layer2List = [...new Set(questions.map(q => q.LAYER2).filter(Boolean))];
            const layer2Buttons = document.getElementById('layer2-buttons');
            layer2Buttons.innerHTML = '';
            
            layer2List.forEach(layer2 => {
                const btn = document.createElement('button');
                btn.textContent = layer2;
                btn.className = 'bg-green-100 hover:bg-green-300 text-green-800 font-bold py-2 px-4 rounded transition duration-200';
                btn.onclick = () => selectLayer2(layer2);
                layer2Buttons.appendChild(btn);
            });
            
            document.getElementById('mode-selection-screen').classList.add('hidden');
            document.getElementById('medium-category-selection-area').classList.remove('hidden');
        }
        
        // 7. ì¤‘ë¶„ë¥˜ ì„ íƒ í•¨ìˆ˜
        function selectLayer2(layer2) {
            filteredQuestions = questions.filter(q => q.LAYER2 && q.LAYER2.trim() === layer2);
            currentQuestionIndex = 0;
            document.getElementById('medium-category-selection-area').classList.add('hidden');
            startQuiz();
        }
        // 3. ëœë¤ 20ë¬¸ì œ ì¶”ì¶œ í•¨ìˆ˜
        function getRandomQuestions(arr, n) {
            const result = [];
            const used = new Set();
            while (result.length < n && used.size < arr.length) {
                const idx = Math.floor(Math.random() * arr.length);
                if (!used.has(idx)) {
                    result.push(arr[idx]);
                    used.add(idx);
                }
            }
            return result;
        }
        // 4. ëª¨ì˜ê³ ì‚¬ ëª¨ë“œ ì§„ì… í•¨ìˆ˜
        function enterMockTestMode() {
            // ëœë¤ 20ë¬¸ì œ ì¶”ì¶œ
            filteredQuestions = getRandomQuestions(questions, 20);
            currentQuestionIndex = 0;
            document.getElementById('mode-selection-screen').classList.add('hidden');
            document.getElementById('layer1-buttons').classList.add('hidden');
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('mock-test-screen').classList.remove('hidden');
            showMockTestQuestion();
        }
        // 5. ëª¨ì˜ê³ ì‚¬ ë¬¸ì œ í‘œì‹œ í•¨ìˆ˜
        function showMockTestQuestion() {
            if (filteredQuestions.length === 0) return;
            const question = filteredQuestions[currentQuestionIndex];
            document.getElementById('mock-test-progress').textContent = `${currentQuestionIndex + 1} / 20`;
            document.getElementById('mock-test-total-questions').textContent = `ì´ 20ë¬¸ì œ`;
            // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ë¬¸ì œ í•„ë“œ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ í‘œì‹œ (íŒŒì‹±/ë¶„ì„ ì—†ìŒ)
            let html = `<div class='mb-4'><span class='text-sm text-gray-500'>${question.LAYER1} > ${question.LAYER2}</span></div>`;
            html += `<div class='mb-4 text-lg font-semibold'>${question.QUESTION}</div>`;
            // ì¡°ëŒ€í‘œë‹˜ ì§€ì¹¨: ë¬¸ì œ ìœ í˜•ì— ë”°ë¼ ë²„íŠ¼ë§Œ ë‹¤ë¥´ê²Œ í‘œì‹œ
            if (question.TYPE === 'ì§„ìœ„í˜•') {
                html += `<div class='flex gap-4 mb-4'>
                    <button onclick='mockTestSelectAnswer("O")' class='mock-answer-btn bg-green-100 hover:bg-green-300 text-green-800 font-bold py-2 px-6 rounded' data-answer='O'>O (ë§ë‹¤)</button>
                    <button onclick='mockTestSelectAnswer("X")' class='mock-answer-btn bg-red-100 hover:bg-red-300 text-red-800 font-bold py-2 px-6 rounded' data-answer='X'>X (í‹€ë¦¬ë‹¤)</button>
                </div>`;
            } else {
                html += `<div class='flex flex-col gap-2 mb-4'>
                    <button onclick='mockTestSelectAnswer("1")' class='mock-answer-btn bg-gray-100 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded' data-answer='1'>1ë²ˆ</button>
                    <button onclick='mockTestSelectAnswer("2")' class='mock-answer-btn bg-gray-100 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded' data-answer='2'>2ë²ˆ</button>
                    <button onclick='mockTestSelectAnswer("3")' class='mock-answer-btn bg-gray-100 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded' data-answer='3'>3ë²ˆ</button>
                    <button onclick='mockTestSelectAnswer("4")' class='mock-answer-btn bg-gray-100 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded' data-answer='4'>4ë²ˆ</button>
                </div>`;
            }
            html += `<div id='mock-test-result-area' class='hidden mt-4'></div>`;
            html += `<div class='flex justify-between mt-6'>
                <button onclick='mockTestPrevQuestion()' class='bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded'>ì´ì „</button>
                <button onclick='mockTestCheckAnswer()' id='mock-test-check-btn' class='bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-5 rounded'>ì •ë‹µ í™•ì¸</button>
                <button onclick='mockTestNextQuestion()' class='bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-5 rounded'>ë‹¤ìŒ</button>
            </div>`;
            document.getElementById('mock-test-question-area').innerHTML = html;
        }
        // 6. ëª¨ì˜ê³ ì‚¬ ë‹µì•ˆ ì„ íƒ/ì •ë‹µ í™•ì¸/ì´ë™ í•¨ìˆ˜
        let mockTestSelectedAnswer = null;
        function mockTestSelectAnswer(ans) {
            mockTestSelectedAnswer = ans;
            document.querySelectorAll('.mock-answer-btn').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'border-blue-500', 'border-2');
                if (btn.dataset.answer === ans) {
                    btn.classList.add('bg-blue-200', 'border-blue-500', 'border-2');
                }
            });
        }
        function mockTestCheckAnswer() {
            if (!mockTestSelectedAnswer) return;
            const question = filteredQuestions[currentQuestionIndex];
            const isCorrect = mockTestSelectedAnswer === question.ANSWER;
            const resultArea = document.getElementById('mock-test-result-area');
            resultArea.classList.remove('hidden');
            if (isCorrect) {
                resultArea.innerHTML = `<span class='text-green-600 font-bold'>ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</span>`;
            } else {
                resultArea.innerHTML = `<span class='text-red-600 font-bold'>ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µ: ${question.ANSWER}</span>`;
            }
            document.getElementById('mock-test-check-btn').disabled = true;
            // 2. ì •ë‹µ í™•ì¸ ì‹œ í•™ìŠµ ì´ë ¥ ê¸°ë¡ ë° ì§„ë„ìœ¨ ì—…ë°ì´íŠ¸
            saveLearningHistory({
              qcode: question.QCODE,
              isCorrect,
              mode: getCurrentMode(),
              layer1: question.LAYER1,
              layer2: question.LAYER2
            });
            updateProgressRates();
        }
        function mockTestNextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                mockTestSelectedAnswer = null;
                showMockTestQuestion();
            }
        }
        function mockTestPrevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                mockTestSelectedAnswer = null;
                showMockTestQuestion();
            }
        }
        // 7. ëª¨ë“œ ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('mode-layer1').onclick = enterLayer1Mode;
        document.getElementById('mode-incorrect').onclick = enterIncorrectMode;
        document.getElementById('mode-mocktest').onclick = enterMockTestMode;
        document.getElementById('mode-layer2').onclick = enterLayer2Mode;
        
        // ì§„ìœ„í˜•/ì„ íƒí˜• ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('type-true-false').onclick = selectTrueFalseType;
        document.getElementById('type-choice').onclick = selectChoiceType;
        
        // 8. í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° í•¨ìˆ˜
        function goHome() {
            // ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('mode-selection-screen').classList.remove('hidden');
            document.getElementById('layer1-buttons').classList.add('hidden');
            document.getElementById('large-category-selection-area').classList.add('hidden');
            document.getElementById('question-type-selection-area').classList.add('hidden');
            document.getElementById('medium-category-selection-area').classList.add('hidden');
            document.getElementById('loading-area').classList.add('hidden');
            document.getElementById('progress-area').classList.add('hidden');
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('stats-area').classList.add('hidden');
            document.getElementById('mock-test-screen').classList.add('hidden');
            
            // ë³€ìˆ˜ ì´ˆê¸°í™”
            currentQuestionIndex = 0;
            selectedAnswer = null;
            answered = false;
            
            // í†µê³„ ì´ˆê¸°í™”
            stats = { totalAnswered: 0, correctCount: 0 };
            updateStats();
        }
        
        // 9. í™ˆ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('home-btn').onclick = goHome;
        
        // ì§„ìœ„í˜•/ì„ íƒí˜• ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('type-true-false').onclick = selectTrueFalseType;
        document.getElementById('type-choice').onclick = selectChoiceType;
        
        // 7. ì˜¤ë‹µ ëª©ë¡ ì´ˆê¸°í™” í•¨ìˆ˜ (ì½˜ì†”ì—ì„œ í˜¸ì¶œ)
        function clearIncorrectProblems() {
            localStorage.removeItem('aciu_incorrect_problems');
            alert('ì˜¤ë‹µ ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        window.clearIncorrectProblems = clearIncorrectProblems;
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') prevQuestion();
            if (e.key === 'ArrowRight') nextQuestion();
            if (e.key === 'Enter') checkAnswer();
            if (e.key === '1') selectAnswer('1');
            if (e.key === '2') selectAnswer('2');
            if (e.key === '3') selectAnswer('3');
            if (e.key === '4') selectAnswer('4');
            if (e.key === 'o' || e.key === 'O') selectAnswer('O');
            if (e.key === 'x' || e.key === 'X') selectAnswer('X');
        });
        // 8. ì•± ì‹œì‘ ì‹œ ëª¨ë“œ ì„ íƒ í™”ë©´ë§Œ ë³´ì´ë„ë¡ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            document.getElementById('main-start-area').classList.remove('hidden');
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('loading-area').classList.add('hidden');
            document.getElementById('progress-area').classList.add('hidden');
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('stats-area').classList.add('hidden');
            document.getElementById('mock-test-screen').classList.add('hidden'); // ëª¨ì˜ê³ ì‚¬ í™”ë©´ ì´ˆê¸°í™”
            loadCSVData();
            document.getElementById('date-header').textContent = new Date().toLocaleString('ko-KR');
            updateProgressRates();
        });
        // 3. í•´ì„¤ ëª¨ë‹¬ í‘œì‹œ/LLM API í˜¸ì¶œ í•¨ìˆ˜
        async function showExplainModal(question) {
          const modal = document.getElementById('explain-modal');
          const content = document.getElementById('explain-modal-content');
          modal.classList.remove('hidden');
          content.textContent = 'AIê°€ í•´ì„¤ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
          try {
            // í”„ë¡¬í”„íŠ¸ êµ¬ì„±
            const prompt = `ë‹¤ìŒì€ ${question.LAYER1 || ''}ì˜ ${question.LAYER2 || ''}ì— ëŒ€í•œ ë¬¸ì œì…ë‹ˆë‹¤.\në¬¸ì œ: ${question.QUESTION}\nì´ ë¬¸ì œì— ëŒ€í•œ ìƒì„¸í•œ í•´ì„¤ì„ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`;
            const chatHistory = [{ role: 'user', parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            const result = await response.json();
            let explainText = 'í•´ì„¤ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
              explainText = result.candidates[0].content.parts[0].text;
            } else if (result.promptFeedback && result.promptFeedback.blockReason) {
              explainText = `í•´ì„¤ ìƒì„±ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${result.promptFeedback.blockReason}`;
            }
            content.textContent = explainText;
          } catch (error) {
            content.textContent = `í•´ì„¤ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
          }
        }
        // 4. í•´ì„¤ ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
        if (document.getElementById('close-explain-modal')) {
          document.getElementById('close-explain-modal').onclick = () => {
            document.getElementById('explain-modal').classList.add('hidden');
          };
        }
        // 5. í˜„ì¬ ëª¨ë“œ ë°˜í™˜ í•¨ìˆ˜ (ëŒ€ë¶„ë¥˜/ì¤‘ë¶„ë¥˜/ì˜¤ë‹µ/ëª¨ì˜ê³ ì‚¬ ë“±)
        function getCurrentMode() {
          if (!document.getElementById('mode-selection-screen').classList.contains('hidden')) return 'ëª¨ë“œ ì„ íƒ';
          if (!document.getElementById('quiz-area').classList.contains('hidden')) {
            if (!document.getElementById('large-category-selection-area').classList.contains('hidden')) return 'ëŒ€ë¶„ë¥˜ í•™ìŠµ';
            if (!document.getElementById('medium-category-selection-area').classList.contains('hidden')) return 'ì¤‘ë¶„ë¥˜ í•™ìŠµ';
            return 'ê¸°ë³¸ í•™ìŠµ';
          }
          if (!document.getElementById('mock-test-screen').classList.contains('hidden')) return 'ëª¨ì˜ê³ ì‚¬';
          return 'ê¸°íƒ€';
        }
        // ì²˜ìŒë¶€í„° í’€ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        const startBtn = document.getElementById('start-quiz-btn');
        startBtn.addEventListener('click', () => {
          lastSolvedIndex = parseInt(localStorage.getItem('lastSolvedIndex') || '0', 10);
          if (lastSolvedIndex > 0) {
            document.getElementById('resume-modal').classList.remove('hidden');
          } else {
            startQuizFrom(0);
          }
        });

        // ì´ì–´ì„œ/ì²˜ìŒë¶€í„° ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸
        const resumeModal = document.getElementById('resume-modal');
        document.getElementById('resume-continue').onclick = () => {
          startQuizFrom(lastSolvedIndex);
          resumeModal.classList.add('hidden');
        };
        document.getElementById('resume-from-beginning').onclick = () => {
          startQuizFrom(0);
          resumeModal.classList.add('hidden');
        };
        document.getElementById('resume-cancel').onclick = () => {
          resumeModal.classList.add('hidden');
        };

        // ëŒ€ë¬¸ìœ¼ë¡œ ë²„íŠ¼ ì´ë²¤íŠ¸
        const goHomeBtn = document.getElementById('go-home-btn');
        goHomeBtn.addEventListener('click', () => {
          document.getElementById('quiz-area').classList.add('hidden');
          document.getElementById('mode-selection-screen').classList.remove('hidden');
        });

        // í€´ì¦ˆ ì‹œì‘ í•¨ìˆ˜
        function startQuizFrom(idx) {
          currentQuestionIndex = idx;
          // ê¸°ì¡´ í€´ì¦ˆ ì‹œì‘ ë¡œì§ í˜¸ì¶œ (ì˜ˆ: showQuizArea ë“±)
          document.getElementById('mode-selection-screen').classList.add('hidden');
          document.getElementById('quiz-area').classList.remove('hidden');
          showQuestion();
        }

        // ë¬¸ì œë¥¼ í’€ ë•Œë§ˆë‹¤ ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ ì €ì¥ (ì˜ˆì‹œ)
        function saveLastSolvedIndex() {
          localStorage.setItem('lastSolvedIndex', currentQuestionIndex);
        }
    </script>
</body>
</html>
