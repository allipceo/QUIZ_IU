<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICU QUIZ ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // CSV ë°ì´í„° ë¡œë“œ ë° ì²˜ë¦¬ í•¨ìˆ˜ë“¤
        ACIUApp.data = ACIUApp.data || {};
        ACIUApp.data.masterQuestions = [];
        ACIUApp.data.isDataLoaded = false;
        
        // CSV íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
        ACIUApp.data.loadMasterData = function() {
            return new Promise((resolve, reject) => {
                Papa.parse('ins_master_db.csv', {
                    download: true,
                    header: true,
                    complete: function(results) {
                        console.log('CSV ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', results.data.length, 'ê°œ ë¬¸ì œ');
                        ACIUApp.data.masterQuestions = results.data.filter(row => 
                            row.QCODE && row.QUESTION && row.ANSWER
                        );
                        ACIUApp.data.isDataLoaded = true;
                        resolve(ACIUApp.data.masterQuestions);
                    },
                    error: function(error) {
                        console.error('CSV ë¡œë“œ ì˜¤ë¥˜:', error);
                        reject(error);
                    }
                });
            });
        };
        
        // ë¬¸ì œ í•„í„°ë§ í•¨ìˆ˜
        ACIUApp.data.filterQuestions = function(filters = {}) {
            if (!ACIUApp.data.isDataLoaded) {
                console.warn('ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            let filteredQuestions = ACIUApp.data.masterQuestions;
            
            // LAYER1 í•„í„°ë§
            if (filters.layer1) {
                filteredQuestions = filteredQuestions.filter(q => q.LAYER1 === filters.layer1);
            }
            
            // LAYER2 í•„í„°ë§
            if (filters.layer2) {
                filteredQuestions = filteredQuestions.filter(q => q.LAYER2 === filters.layer2);
            }
            
            // TYPE í•„í„°ë§
            if (filters.type) {
                filteredQuestions = filteredQuestions.filter(q => q.TYPE === filters.type);
            }
            
            return filteredQuestions;
        };
        
        // ìˆœì„œëŒ€ë¡œ ë¬¸ì œ ê°€ì ¸ì˜¤ê¸° (ì²˜ìŒë¶€í„° í’€ê¸°)
        ACIUApp.data.getSequentialQuestions = function(filters = {}, startIndex = 0, count = 10) {
            const filteredQuestions = ACIUApp.data.filterQuestions(filters);
            return filteredQuestions.slice(startIndex, startIndex + count);
        };
    </script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .hidden { display: none; }

        /* ì¤‘ë¶„ë¥˜ í•™ìŠµ ì „ìš© ìŠ¤íƒ€ì¼ */
        .large-for-mid-btn.active {
            box-shadow: 0 0 0 4px rgb(59 130 246 / var(--tw-bg-opacity)); /* Tailwind ring-4 blue-500 equivalent */
            border-color: transparent; /* Remove default border if any */
        }

        .mid-btn {
            min-height: 60px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }

        .mid-btn:hover {
            background: #f0f9ff;
            border-color: #3b82f6;
        }

        .mid-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #2563eb;
            font-weight: bold;
        }

        .other-mid-btn {
            min-height: 40px;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            text-align: center;
        }

        .other-mid-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .other-mid-btn.active {
            background: #374151;
            color: white;
            border-color: #374151;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold text-blue-700">ACIU QUIZ ì•±</h1>
                    <span class="text-sm text-gray-600" id="current-mode">ëª¨ë“œ ì„ íƒ</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <span id="user-info">ì‚¬ìš©ì: ì¡°ëŒ€í‘œë‹˜</span> | 
                        <span id="exam-dday">D-90ì¼</span>
                    </div>
                    <div class="text-sm text-gray-600" id="current-time"></div>
                    <button onclick="ACIUApp.ui.showSettingsModal()" class="text-gray-600 hover:text-blue-600">
                        âš™ï¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="text-center">
                <p class="text-lg text-gray-700 italic" id="quote-of-day">
                    "í•™ìŠµì€ ê°€ì¥ ì¢‹ì€ íˆ¬ìì…ë‹ˆë‹¤."
                </p>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ë³´ìœ  ë¬¸ì œìˆ˜ í˜„í™©</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="ins-questions">0</div>
                    <div class="text-sm text-gray-600">ì¸ìŠ¤êµì¬</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="exam-questions">0</div>
                    <div class="text-sm text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600" id="total-questions">0</div>
                    <div class="text-sm text-gray-600">í•©ê³„</div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµ ì§„ë„ í˜„í™©</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="completed-questions">0</div>
                    <div class="text-sm text-gray-600">ì™„ë£Œí•œ ë¬¸ì œ</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="overall-progress-rate">0%</div>
                    <div class="text-sm text-gray-600">ì „ì²´ ì§„ë„ìœ¨</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600" id="daily-progress-rate">0%</div>
                    <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì§„ë„ìœ¨</div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                <button onclick="ACIUApp.learning.startMode('basic')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg">
                    ê¸°ë³¸ í•™ìŠµ
                </button>
                <button onclick="ACIUApp.learning.startMode('layer1')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg">
                    ëŒ€ë¶„ë¥˜ í•™ìŠµ
                </button>
                <button onclick="ACIUApp.learning.startMode('layer2')" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-6 rounded-lg">
                    ì¤‘ë¶„ë¥˜ í•™ìŠµ
                </button>
                <button onclick="ACIUApp.learning.startMode('choice')" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-6 rounded-lg">
                    ì„ íƒí˜• í•™ìŠµ
                </button>
                <button onclick="ACIUApp.learning.startMode('truefalse')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg">
                    ì§„ìœ„í˜• í•™ìŠµ
                </button>
                <button onclick="ACIUApp.learning.startMode('mock')" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg">
                    ëª¨ì˜ê³ ì‚¬
                </button>
            </div>
        </div>

        <div id="basic-learning-screen" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                    <button onclick="ACIUApp.ui.goToHome()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                        ğŸ  í™ˆìœ¼ë¡œ
                    </button>
                    <h2 class="text-xl font-semibold text-gray-800">ê¸°ë³¸ í•™ìŠµ</h2>
                    <div class="text-sm text-gray-600">
                        ë¬¸ì œ <span id="current-question-number">1</span> / <span id="total-questions">1379</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">í•™ìŠµ í˜„í™©</h3>
                    <p class="text-2xl font-bold text-blue-600" id="learning-progress">3.3%</p>
                    <p class="text-sm text-gray-600">ì´ 1379ë¬¸ì œ ì¤‘ 45ë¬¸ì œ ì™„ë£Œ</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">í•™ìŠµ ì„±ê³¼</h3>
                    <p class="text-2xl font-bold text-green-600" id="learning-performance">71%</p>
                    <p class="text-sm text-gray-600">í’€ì´ 45ë¬¸ì œ ì¤‘ 32ë¬¸ì œ ì •ë‹µ</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">ì˜¤ëŠ˜ì˜ í†µê³„</h3>
                    <p class="text-2xl font-bold text-orange-600" id="today-stats">75%</p>
                    <p class="text-sm text-gray-600">ì˜¤ëŠ˜ 8ë¬¸ì œ í’€ì´</p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">ë¬¸ì œ í’€ì´ ë°©ì‹ ì„ íƒ</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <button onclick="ACIUApp.learning.startContinue()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                        ì´ì–´í’€ê¸°
                    </button>
                    <button onclick="ACIUApp.learning.startFromBeginning()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                        ì²˜ìŒë¶€í„° í’€ê¸°
                    </button>
                    <button onclick="ACIUApp.learning.startRandom()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg">
                        ëœë¤ í’€ê¸°
                    </button>
                </div>
                <div class="text-center">
                    <span class="text-sm text-gray-600">í˜„ì¬: í•œ ë¬¸ì œì”© í’€ê¸°</span>
                </div>
            </div>

            <div id="question-area" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600" id="question-type">ì§„ìœ„í˜•</span>
                            <span class="text-sm text-gray-600" id="question-code">ABANK-0001</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <span id="layer-info">06ì¬ì‚°ë³´í—˜ > í™”ì¬ë³´í—˜</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë¬¸ì œ</h3>
                        <p class="text-gray-700 leading-relaxed" id="question-text">
                            ë¬¸ì œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë‹µì•ˆ ì„ íƒ</h3>
                        <div id="answer-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="ACIUApp.learning.selectAnswer('O')" class="answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg" data-answer="O">
                                O
                            </button>
                            <button onclick="ACIUApp.learning.selectAnswer('X')" class="answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg" data-answer="X">
                                X
                            </button>
                        </div>
                    </div>

                    <div id="result-area" class="hidden mb-6">
                        <div class="p-4 rounded-lg" id="result-message">
                            </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <button onclick="ACIUApp.learning.prevQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            ì´ì „ ë¬¸ì œ
                        </button>
                        <div class="flex space-x-2">
                            <button onclick="ACIUApp.learning.checkAnswer()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                                ì •ë‹µ í™•ì¸
                            </button>
                            <button onclick="ACIUApp.learning.showExplanation()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg hidden" id="explanation-btn">
                                í•´ì„¤ ë³´ê¸°
                            </button>
                        </div>
                        <button onclick="ACIUApp.learning.nextQuestion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                            ë‹¤ìŒ ë¬¸ì œ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="large-category-learning-screen" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                    <button onclick="ACIUApp.ui.goToHome()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                        ğŸ  í™ˆìœ¼ë¡œ
                    </button>
                    <h2 class="text-xl font-semibold text-gray-800">ëŒ€ë¶„ë¥˜ í•™ìŠµ</h2>
                    <div class="text-sm text-gray-600">
                        ì„ íƒëœ ëŒ€ë¶„ë¥˜: <span id="selected-category">ì—†ìŒ</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ë³´ìœ  ë¬¸ì œ í˜„í™©</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-lg font-semibold text-blue-800">ì¸ìŠ¤êµì¬</div>
                        <div class="text-sm text-gray-600">ì„ íƒí˜• 300ê°œ, ì§„ìœ„í˜• 400ê°œ</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-lg font-semibold text-green-800">ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜</div>
                        <div class="text-sm text-gray-600">ì§„ìœ„í˜• 200ê°œ, ì„ íƒí˜• 479ê°œ</div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600">ì´ê³„: 1,379ê°œ</div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµ ì§„ë„ í˜„í™©</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="category-progress">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-lg font-semibold text-blue-800">ì¬ì‚°ë³´í—˜</div>
                        <div class="text-sm text-gray-600">45 / 300 (15%)</div>
                        <div class="text-xs text-gray-500">ë¯¸í•™ìŠµ: 255</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-lg font-semibold text-green-800">íŠ¹ì¢…ë³´í—˜</div>
                        <div class="text-sm text-gray-600">32 / 250 (13%)</div>
                        <div class="text-xs text-gray-500">ë¯¸í•™ìŠµ: 218</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-lg font-semibold text-purple-800">ë°°ìƒì±…ì„ë³´í—˜</div>
                        <div class="text-sm text-gray-600">28 / 200 (14%)</div>
                        <div class="text-xs text-gray-500">ë¯¸í•™ìŠµ: 172</div>
                    </div>
                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <div class="text-lg font-semibold text-yellow-800">í•´ìƒë³´í—˜</div>
                        <div class="text-sm text-gray-600">15 / 150 (10%)</div>
                        <div class="text-xs text-gray-500">ë¯¸í•™ìŠµ: 135</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ëŒ€ë¶„ë¥˜ ì„ íƒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4" id="category-buttons">
                    <button onclick="ACIUApp.learning.selectCategory('ì¬ì‚°ë³´í—˜')" class="category-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg transition-all" data-category="ì¬ì‚°ë³´í—˜">
                        ì¬ì‚°ë³´í—˜<br><span class="text-sm">(300ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectCategory('íŠ¹ì¢…ë³´í—˜')" class="category-btn bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg transition-all" data-category="íŠ¹ì¢…ë³´í—˜">
                        íŠ¹ì¢…ë³´í—˜<br><span class="text-sm">(250ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectCategory('ë°°ìƒì±…ì„ë³´í—˜')" class="category-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-6 rounded-lg transition-all" data-category="ë°°ìƒì±…ì„ë³´í—˜">
                        ë°°ìƒì±…ì„ë³´í—˜<br><span class="text-sm">(200ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectCategory('í•´ìƒë³´í—˜')" class="category-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-6 rounded-lg transition-all" data-category="í•´ìƒë³´í—˜">
                        í•´ìƒë³´í—˜<br><span class="text-sm">(150ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectCategory('ìë™ì°¨ë³´í—˜')" class="category-btn bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg transition-all" data-category="ìë™ì°¨ë³´í—˜">
                        ìë™ì°¨ë³´í—˜<br><span class="text-sm">(479ë¬¸ì œ)</span>
                    </button>
                </div>
            </div>

            <div id="large-category-question-area" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600" id="large-category-question-type">ì§„ìœ„í˜•</span>
                            <span class="text-sm text-gray-600" id="large-category-question-code">ABANK-0001</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <span id="large-category-layer-info">06ì¬ì‚°ë³´í—˜ > í™”ì¬ë³´í—˜</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë¬¸ì œ</h3>
                        <p class="text-gray-700 leading-relaxed" id="large-category-question-text">
                            ëŒ€ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ë©´ ë¬¸ì œê°€ í‘œì‹œë©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë‹µì•ˆ ì„ íƒ</h3>
                        <div id="large-category-answer-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            </div>
                    </div>

                    <div id="large-category-result-area" class="hidden mb-6">
                        <div class="p-4 rounded-lg" id="large-category-result-message">
                            </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <button onclick="ACIUApp.learning.prevQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            ì´ì „ ë¬¸ì œ
                        </button>
                        <div class="flex space-x-2">
                            <button onclick="ACIUApp.learning.checkAnswer()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                                ì •ë‹µ í™•ì¸
                            </button>
                            <button onclick="ACIUApp.learning.showExplanation()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg hidden" id="large-category-explanation-btn">
                                í•´ì„¤ ë³´ê¸°
                            </button>
                        </div>
                        <button onclick="ACIUApp.learning.nextQuestion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                            ë‹¤ìŒ ë¬¸ì œ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="mid-category-learning-screen" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                    <button onclick="ACIUApp.ui.goToHome()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                        ğŸ  í™ˆìœ¼ë¡œ
                    </button>
                    <h2 class="text-xl font-semibold text-gray-800">ì¤‘ë¶„ë¥˜ í•™ìŠµ</h2>
                    <div class="text-sm text-gray-600">
                        <span id="selected-path">ì„ íƒ: ì—†ìŒ</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">1ë‹¨ê³„: ëŒ€ë¶„ë¥˜ ì„ íƒ</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="mid-large-category-buttons">
                    <button onclick="ACIUApp.learning.selectLargeForMid('06ì¬ì‚°ë³´í—˜')" 
                            class="large-for-mid-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-4 rounded-lg text-sm" 
                            data-category="06ì¬ì‚°ë³´í—˜">
                        ì¬ì‚°ë³´í—˜<br><span class="text-xs">(371ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectLargeForMid('07íŠ¹ì¢…ë³´í—˜')" 
                            class="large-for-mid-btn bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-4 rounded-lg text-sm" 
                            data-category="07íŠ¹ì¢…ë³´í—˜">
                        íŠ¹ì¢…ë³´í—˜<br><span class="text-xs">(292ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectLargeForMid('08ë°°ìƒì±…ì„ë³´í—˜')" 
                            class="large-for-mid-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-4 rounded-lg text-sm" 
                            data-category="08ë°°ìƒì±…ì„ë³´í—˜">
                        ë°°ìƒì±…ì„ë³´í—˜<br><span class="text-xs">(268ë¬¸ì œ)</span>
                    </button>
                    <button onclick="ACIUApp.learning.selectLargeForMid('09í•´ìƒë³´í—˜')" 
                            class="large-for-mid-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-4 rounded-lg text-sm" 
                            data-category="09í•´ìƒë³´í—˜">
                        í•´ìƒë³´í—˜<br><span class="text-xs">(448ë¬¸ì œ)</span>
                    </button>
                </div>
            </div>

            <div id="mid-category-selection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">2ë‹¨ê³„: ì¤‘ë¶„ë¥˜ ì„ íƒ</h3>
                
                <div id="main-mid-buttons" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    </div>
                
                <div id="other-mid-toggle" class="text-center mb-4 hidden">
                    <button onclick="ACIUApp.learning.toggleOtherMid()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-sm">
                        ê¸°íƒ€ ì„¸ë¶€ë¶„ë¥˜ ë³´ê¸° (<span id="other-count">0</span>ê°œ)
                    </button>
                </div>
                
                <div id="other-mid-details" class="hidden">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="text-md font-semibold text-gray-700 mb-3">ê¸°íƒ€ ì„¸ë¶€ë¶„ë¥˜</h4>
                        <div id="other-mid-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            </div>
                        <button onclick="ACIUApp.learning.toggleOtherMid()" 
                                class="w-full mt-3 bg-gray-400 hover:bg-gray-500 text-white py-1 px-4 rounded text-sm">
                            ì ‘ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <div id="mid-category-question-area" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-sm text-gray-600">
                            ë¬¸ì œ <span id="mid-current-question-number">1</span> / <span id="mid-total-questions">3</span>
                        </div>
                        <div class="text-sm text-gray-600" id="mid-question-code">FIRE-001</div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë¬¸ì œ</h3>
                        <p class="text-gray-700 leading-relaxed" id="mid-question-text">
                            ë¬¸ì œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë‹µì•ˆ ì„ íƒ</h3>
                        <div id="mid-answer-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="ACIUApp.learning.selectMidAnswer('O')" class="mid-answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg" data-answer="O">
                                O
                            </button>
                            <button onclick="ACIUApp.learning.selectMidAnswer('X')" class="mid-answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg" data-answer="X">
                                X
                            </button>
                        </div>
                    </div>

                    <div id="mid-result-area" class="hidden mb-6">
                        <div class="p-4 rounded-lg" id="mid-result-message">
                            <!-- ê²°ê³¼ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button onclick="ACIUApp.learning.previousMidQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            â† ì´ì „
                        </button>
                        <button onclick="ACIUApp.learning.checkMidAnswer()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg">
                            ì •ë‹µ í™•ì¸
                        </button>
                        <button onclick="ACIUApp.learning.nextMidQuestion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                            ë‹¤ìŒ â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="text-center">
                <button onclick="ACIUApp.ui.loadStatisticsData()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg text-lg">
                    ğŸ“Š í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <p class="text-sm text-gray-600 mt-2">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜„ì¬ìƒíƒœ ì´ê´„ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
        </div>

        <div id="statistics-section" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">í˜„ì¬ìƒíƒœ ì´ê´„</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">ê³¼ëª©ë³„ ì ìˆ˜</h3>
                        <div class="space-y-2" id="subject-cards">
                            </div>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">ì „ì²´ ìš”ì•½</h3>
                        <div class="space-y-3" id="summary-cards">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ì„¤ì •</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìš©ìëª…</label>
                    <input type="text" id="user-name-input" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì‹œí—˜ ë‚ ì§œ</label>
                    <input type="date" id="exam-date-input" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex space-x-2">
                    <button onclick="ACIUApp.ui.saveSettings()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                        ì €ì¥
                    </button>
                    <button onclick="ACIUApp.ui.hideSettingsModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ACIUApp ë„¤ì„ìŠ¤í˜ì´ìŠ¤ êµ¬ì¡°
        const ACIUApp = {
            // íƒ€ì´ë¨¸ ê´€ë¦¬
            timers: {
                timeUpdate: null,
                quoteUpdate: null,
                ddayUpdate: null
            },

            // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í™•ì¸
            compatibility: {
                checkBrowserSupport() {
                    if (!window.localStorage) {
                        this.showErrorMessage('localStorageë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                        return false;
                    }
                    return true;
                }
            },

            // ë°ì´í„° ê´€ë¦¬
            data: {
                questions: [],
                userSettings: {
                    name: 'ì¡°ëŒ€í‘œë‹˜',
                    examDate: '2024-12-31',
                    lastUpdated: new Date().toISOString()
                },
                learningHistory: {
                    attempts: {},
                    lastUpdated: new Date().toISOString()
                },

                // CSV ë°ì´í„° ë¡œë”©
                async loadQuestions() {
                    try {
                        const response = await fetch('ins_master_db.csv');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const csvContent = await response.text();
                        
                        const parsed = Papa.parse(csvContent, {
                            header: true,
                            dynamicTyping: false,
                            skipEmptyLines: true,
                            delimiter: ',',
                            quoteChar: '"',
                            fastMode: true
                        });

                        // í•„í„°ë§: QCODEê°€ ìˆê³  SOURCEê°€ 'ì¸ìŠ¤êµì¬' ë˜ëŠ” 'ì¤‘ê°œì‚¬ì‹œí—˜'ì¸ ê²½ìš°
                        this.questions = parsed.data.filter(row =>
                            row.QCODE && 
                            (row.SOURCE === 'ì¸ìŠ¤êµì¬' || row.SOURCE === 'ì¤‘ê°œì‚¬ì‹œí—˜')
                        );

                        console.log(`ë°ì´í„° ë¡œë”© ì™„ë£Œ: ${this.questions.length}ê°œ ë¬¸ì œ`);
                        
                        // ë°ì´í„° ë¡œë”© ì™„ë£Œ í›„ UI ì—…ë°ì´íŠ¸
                        ACIUApp.ui.updateQuestionCounts();
                        ACIUApp.ui.updateStatistics();
                    } catch (error) {
                        console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                        ACIUApp.ui.showErrorMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                },

                // ì‚¬ìš©ì ì„¤ì • ë¡œë”©
                loadUserSettings() {
                    try {
                        const saved = localStorage.getItem('aciu_user_settings');
                        if (saved) {
                            this.userSettings = { ...this.userSettings, ...JSON.parse(saved) };
                        }
                    } catch (error) {
                        console.error('ì‚¬ìš©ì ì„¤ì • ë¡œë”© ì‹¤íŒ¨:', error);
                    }
                },

                // ì‚¬ìš©ì ì„¤ì • ì €ì¥
                saveUserSettings() {
                    try {
                        localStorage.setItem('aciu_user_settings', JSON.stringify(this.userSettings));
                    } catch (error) {
                        console.error('ì‚¬ìš©ì ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                    }
                },

                // í•™ìŠµ ì´ë ¥ ë¡œë”©
                loadLearningHistory() {
                    try {
                        const saved = localStorage.getItem('aciu_learning_history');
                        if (saved) {
                            this.learningHistory = { ...this.learningHistory, ...JSON.parse(saved) };
                        }
                    } catch (error) {
                        console.error('í•™ìŠµ ì´ë ¥ ë¡œë”© ì‹¤íŒ¨:', error);
                    }
                }
            },

            // UI ê´€ë¦¬
            ui: {
                // ì´ˆê¸°í™”
                init() {
                    this.updateHeader();
                    this.updateQuestionCounts();
                    this.updateStatistics();
                    this.updateQuote();
                    this.updateCurrentTime();
                    this.updateDdayCount();
                },

                // í—¤ë” ì—…ë°ì´íŠ¸
                updateHeader() {
                    const userInfo = document.getElementById('user-info');
                    const examDday = document.getElementById('exam-dday');
                    
                    userInfo.textContent = `ì‚¬ìš©ì: ${ACIUApp.data.userSettings.name}`;
                    
                    const examDate = new Date(ACIUApp.data.userSettings.examDate);
                    const today = new Date();
                    const diffTime = examDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    examDday.textContent = `D-${Math.max(0, diffDays)}ì¼`;
                },

                // ì†ŒìŠ¤ë³„ ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸
                updateQuestionCounts() {
                    const questions = ACIUApp.data.questions;
                    
                    // ì†ŒìŠ¤ë³„ ë¬¸ì œ ìˆ˜ ê³„ì‚°
                    const insQuestions = questions.filter(q => q.SOURCE === 'ì¸ìŠ¤êµì¬').length;
                    const examQuestions = questions.filter(q => q.SOURCE === 'ì¤‘ê°œì‚¬ì‹œí—˜').length;
                    const totalQuestions = questions.length;
                    
                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('ins-questions').textContent = insQuestions.toLocaleString();
                    document.getElementById('exam-questions').textContent = examQuestions.toLocaleString();
                    document.getElementById('total-questions').textContent = totalQuestions.toLocaleString();
                },

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStatistics() {
                    const totalQuestions = ACIUApp.data.questions.length;
                    const solvedQcodes = new Set(Object.keys(ACIUApp.data.learningHistory.attempts));
                    const overallRate = totalQuestions > 0 ? Math.round((solvedQcodes.size / totalQuestions) * 100) : 0;
                    
                    // ì¼ì¼ ì§„ë„ìœ¨
                    const today = new Date().toISOString().slice(0, 10);
                    const todayData = Object.values(ACIUApp.data.learningHistory.attempts)
                        .filter(attempt => attempt.timestamp.slice(0, 10) === today);
                    const todaySolved = todayData.length;
                    const todayCorrect = todayData.filter(attempt => attempt.correct).length;
                    const dailyRate = todaySolved > 0 ? Math.round((todayCorrect / todaySolved) * 100) : 0;
                    
                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('completed-questions').textContent = solvedQcodes.size.toLocaleString();
                    document.getElementById('overall-progress-rate').textContent = `${overallRate}%`;
                    document.getElementById('daily-progress-rate').textContent = `${dailyRate}%`;
                },

                // ê¸°ë³¸ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°ì´í„° ë°˜ì˜)
                updateBasicLearningStats() {
                    // ì‹¤ì œ ë°ì´í„°ê°€ ë¡œë“œëœ ê²½ìš° ì‹¤ì œ í†µê³„ ì‚¬ìš©, ì•„ë‹ˆë©´ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    const totalQuestions = ACIUApp.data.isDataLoaded ? ACIUApp.data.masterQuestions.length : 1379;
                    const completedQuestions = 45; // ì„ì‹œë¡œ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    const correctAnswers = 32; // ì„ì‹œë¡œ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    const todayQuestions = 8; // ì„ì‹œë¡œ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    const todayCorrect = 6; // ì„ì‹œë¡œ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    
                    const stats = {
                        totalQuestions: totalQuestions,
                        completedQuestions: completedQuestions,
                        correctAnswers: correctAnswers,
                        todayQuestions: todayQuestions,
                        todayCorrect: todayCorrect
                    };
                    
                    // í•™ìŠµ í˜„í™© í†µê³„
                    const progressRate = totalQuestions > 0 ? Math.round((stats.completedQuestions / stats.totalQuestions) * 100) : 0;
                    document.getElementById('learning-progress').textContent = `${progressRate}%`;
                    
                    // í•™ìŠµ ì„±ê³¼ í†µê³„
                    const performanceRate = stats.completedQuestions > 0 ? Math.round((stats.correctAnswers / stats.completedQuestions) * 100) : 0;
                    document.getElementById('learning-performance').textContent = `${performanceRate}%`;
                    
                    // ì˜¤ëŠ˜ì˜ í†µê³„
                    const todayRate = stats.todayQuestions > 0 ? Math.round((stats.todayCorrect / stats.todayQuestions) * 100) : 0;
                    document.getElementById('today-stats').textContent = `${todayRate}%`;
                    
                    console.log(`í†µê³„ ì—…ë°ì´íŠ¸: ì´ ${totalQuestions}ê°œ ë¬¸ì œ, ì™„ë£Œ ${completedQuestions}ê°œ, ì •ë‹µ ${correctAnswers}ê°œ`);
                },

                // ê³¼ëª©ë³„ ì ìˆ˜ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë”ë¯¸ ë°ì´í„° ì ìš©)
                updateSubjectCards() {
                    const subjects = ['06ì¬ì‚°ë³´í—˜', '07íŠ¹ì¢…ë³´í—˜', '08ë°°ìƒì±…ì„ë³´í—˜', '09í•´ìƒë³´í—˜'];
                    const scores = [55, 65, 67, 30]; // ë”ë¯¸ ì ìˆ˜
                    const subjectCards = document.getElementById('subject-cards');
                    subjectCards.innerHTML = '';
                    
                    subjects.forEach((subject, index) => {
                        const score = scores[index];
                        const isPass = score >= 40;
                        const card = document.createElement('div');
                        card.className = 'flex justify-between items-center p-2 bg-white rounded border';
                        card.innerHTML = `
                            <div class="flex-1">
                                <div class="font-medium text-sm">${subject}</div>
                                <div class="text-xs text-gray-500">ê¸°ì¤€: 40ì </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold ${isPass ? 'text-green-600' : 'text-red-600'}">${score}ì </div>
                                <div class="text-xs ${isPass ? 'text-green-600' : 'text-red-600'}">${isPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©'}</div>
                            </div>
                        `;
                        subjectCards.appendChild(card);
                    });
                },

                // ì „ì²´ ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë”ë¯¸ ë°ì´í„° ì ìš©)
                updateSummaryCards() {
                    const scores = [55, 65, 67, 30]; // ë”ë¯¸ ì ìˆ˜
                    const overallScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
                    const lowestScore = Math.min(...scores);
                    const isPass = overallScore >= 60 && lowestScore >= 40;
                    
                    const summaryCards = document.getElementById('summary-cards');
                    summaryCards.innerHTML = '';
                    
                    // í‰ê·  ì ìˆ˜ ì¹´ë“œ
                    const isAvgPass = overallScore >= 60;
                    const avgCard = document.createElement('div');
                    avgCard.className = 'flex justify-between items-center p-3 bg-white rounded border';
                    avgCard.innerHTML = `
                        <div class="flex-1">
                            <div class="font-semibold">í‰ê· ì ìˆ˜</div>
                            <div class="text-xs text-gray-500">ê¸°ì¤€: 60ì </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold ${isAvgPass ? 'text-green-600' : 'text-red-600'}">${overallScore}ì </div>
                            <div class="text-xs ${isAvgPass ? 'text-green-600' : 'text-red-600'}">${isAvgPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©'}</div>
                        </div>
                    `;
                    summaryCards.appendChild(avgCard);
                    
                    // ìµœì¢… í•©ê²© ì—¬ë¶€ ì¹´ë“œ
                    const finalCard = document.createElement('div');
                    finalCard.className = `flex justify-between items-center p-3 rounded border ${isPass ? 'bg-green-100 border-green-300' : 'bg-red-100 border-red-300'}`;
                    finalCard.innerHTML = `
                        <div class="flex-1">
                            <div class="font-bold">ìµœì¢…í•©ê²©ì—¬ë¶€</div>
                            <div class="text-xs text-gray-500">ëª¨ë“  ì¡°ê±´ ë§Œì¡±</div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold ${isPass ? 'text-green-600' : 'text-red-600'}">${isPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©'}</div>
                            <div class="text-xs ${isPass ? 'text-green-600' : 'text-red-600'}">${isPass ? 'ğŸ‰' : 'âš ï¸'}</div>
                        </div>
                    `;
                    summaryCards.appendChild(finalCard);
                },

                // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
                updateCurrentTime() {
                    const now = new Date();
                    const timeString = now.toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'long',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: true
                    });
                    document.getElementById('current-time').textContent = timeString;
                },

                // D-Day ì—…ë°ì´íŠ¸
                updateDdayCount() {
                    const examDate = new Date(ACIUApp.data.userSettings.examDate);
                    const today = new Date();
                    const diffTime = examDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('exam-dday').textContent = `D-${Math.max(0, diffDays)}ì¼`;
                },

                // ëª…ì–¸ ì—…ë°ì´íŠ¸
                updateQuote() {
                    const quotes = [
                        "í•™ìŠµì€ ê°€ì¥ ì¢‹ì€ íˆ¬ìì…ë‹ˆë‹¤.",
                        "ê¾¸ì¤€í•¨ì´ ìµœê³ ì˜ ì¬ëŠ¥ì…ë‹ˆë‹¤.",
                        "ì˜¤ëŠ˜ì˜ ë…¸ë ¥ì´ ë‚´ì¼ì˜ ì„±ê³µì„ ë§Œë“­ë‹ˆë‹¤.",
                        "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆì…ë‹ˆë‹¤.",
                        "ì‘ì€ ì§„ì „ë„ í° ì„±ì·¨ì˜ ì‹œì‘ì…ë‹ˆë‹¤.",
                        "ëê¹Œì§€ ê°€ëŠ” ìê°€ ì´ê¸´ë‹¤.",
                        "ìì‹ ì„ ë¯¿ì–´ë¼, ë‹¹ì‹ ì€ í•  ìˆ˜ ìˆë‹¤.",
                        "ì‹œê°„ì€ ê°€ì¥ ê·€ì¤‘í•œ ìì‚°ì…ë‹ˆë‹¤.",
                        "ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒì”© ë‚˜ì•„ê°€ë¼.",
                        "ë°°ì›€ì—ëŠ” ëì´ ì—†ë‹¤."
                    ];
                    
                    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                    document.getElementById('quote-of-day').textContent = `"${randomQuote}"`;
                },

                // ì„¤ì • ëª¨ë‹¬ í‘œì‹œ
                showSettingsModal() {
                    document.getElementById('user-name-input').value = ACIUApp.data.userSettings.name;
                    document.getElementById('exam-date-input').value = ACIUApp.data.userSettings.examDate;
                    document.getElementById('settings-modal').classList.remove('hidden');
                },

                // ì„¤ì • ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
                hideSettingsModal() {
                    document.getElementById('settings-modal').classList.add('hidden');
                },

                // ì„¤ì • ì €ì¥
                saveSettings() {
                    const name = document.getElementById('user-name-input').value.trim();
                    const examDate = document.getElementById('exam-date-input').value;
                    
                    if (name) {
                        ACIUApp.data.userSettings.name = name;
                    }
                    if (examDate) {
                        ACIUApp.data.userSettings.examDate = examDate;
                    }
                    
                    ACIUApp.data.userSettings.lastUpdated = new Date().toISOString();
                    ACIUApp.data.saveUserSettings();
                    this.updateHeader();
                    this.hideSettingsModal();
                },

                // í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                loadStatisticsData() {
                    console.log('í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
                    
                    // í†µê³„ ì„¹ì…˜ í‘œì‹œ
                    document.getElementById('statistics-section').classList.remove('hidden');
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    this.updateSubjectCards();
                    this.updateSummaryCards();
                    
                    console.log('í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
                },

                // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                showErrorMessage(message) {
                    alert(message);
                },
                
                // ëª¨ë“  í•™ìŠµ í™”ë©´ ìˆ¨ê¸°ê¸°
                hideAllScreens() {
                    document.getElementById('basic-learning-screen').classList.add('hidden');
                    document.getElementById('large-category-learning-screen').classList.add('hidden');
                    document.getElementById('mid-category-learning-screen').classList.add('hidden');
                    document.getElementById('statistics-section').classList.add('hidden'); // í†µê³„ ì„¹ì…˜ë„ ìˆ¨ê¹€
                },

                // í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                goToHome() {
                    console.log('í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°');
                    
                    this.hideAllScreens();
                    
                    // í˜„ì¬ ëª¨ë“œ ì—…ë°ì´íŠ¸
                    document.getElementById('current-mode').textContent = 'ëª¨ë“œ ì„ íƒ';
                }
            },

            // í•™ìŠµ ì—”ì§„
            learning: {
                // í•™ìŠµ ìƒíƒœ ë³€ìˆ˜
                currentQuestionIndex: 0,
                filteredQuestions: [],
                selectedAnswer: null,
                currentQuestion: null,
                isAnswerChecked: false,

                // ê¸°ë³¸ í•™ìŠµ ëª¨ë“œ ì‹œì‘
                startMode(mode) {
                    console.log(`í•™ìŠµ ëª¨ë“œ ì‹œì‘: ${mode}`);
                    
                    ACIUApp.ui.hideAllScreens(); // ëª¨ë“  í™”ë©´ ìˆ¨ê¹€
                    
                    if (mode === 'basic') {
                        this.startBasicLearning();
                    } else if (mode === 'layer1') {
                        this.startLargeCategoryLearning();
                    } else if (mode === 'layer2') {
                        ACIUApp.learning.startMidCategoryLearning(); // ì¤‘ë¶„ë¥˜ í•™ìŠµ ëª¨ë“œ ì‹œì‘
                    } else {
                        alert(`${mode} ëª¨ë“œê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
                    }
                },

                // ê¸°ë³¸ í•™ìŠµ ì‹œì‘
                startBasicLearning() {
                    console.log('ê¸°ë³¸ í•™ìŠµ ëª¨ë“œ ì‹œì‘');
                    
                    // ê¸°ë³¸ í•™ìŠµ í™”ë©´ í‘œì‹œ
                    document.getElementById('basic-learning-screen').classList.remove('hidden');
                    
                    // í˜„ì¬ ëª¨ë“œ ì—…ë°ì´íŠ¸
                    document.getElementById('current-mode').textContent = 'ê¸°ë³¸ í•™ìŠµ';
                    
                    // CSV ë°ì´í„° ë¡œë“œ í™•ì¸
                    if (!ACIUApp.data.isDataLoaded) {
                        ACIUApp.data.loadMasterData().then(() => {
                            console.log('ê¸°ë³¸í•™ìŠµ ëª¨ë“œì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                            this.initializeBasicLearning();
                        }).catch(error => {
                            console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                            alert('ë¬¸ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        });
                    } else {
                        this.initializeBasicLearning();
                    }
                },

                // ê¸°ë³¸í•™ìŠµ ì´ˆê¸°í™”
                initializeBasicLearning() {
                    // ì „ì²´ ë¬¸ì œ ëª©ë¡ ì„¤ì • (ì²˜ìŒë¶€í„° í’€ê¸°ìš©)
                    this.filteredQuestions = ACIUApp.data.masterQuestions;
                    this.currentQuestionIndex = 0;
                    this.sequentialStartIndex = 0;
                    
                    // ê¸°ë³¸ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸
                    ACIUApp.ui.updateBasicLearningStats();
                    
                    console.log(`ì´ ${this.filteredQuestions.length}ê°œ ë¬¸ì œ ë¡œë“œë¨`);
                },

                // ëŒ€ë¶„ë¥˜ í•™ìŠµ ì‹œì‘
                startLargeCategoryLearning() {
                    console.log('ëŒ€ë¶„ë¥˜ í•™ìŠµ ëª¨ë“œ ì‹œì‘');
                    
                    // ëŒ€ë¶„ë¥˜ í•™ìŠµ í™”ë©´ í‘œì‹œ
                    document.getElementById('large-category-learning-screen').classList.remove('hidden');
                    
                    // í˜„ì¬ ëª¨ë“œ ì—…ë°ì´íŠ¸
                    document.getElementById('current-mode').textContent = 'ëŒ€ë¶„ë¥˜ í•™ìŠµ';
                    
                    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”
                    this.selectedCategory = null;
                    
                    console.log('ëŒ€ë¶„ë¥˜ í•™ìŠµ í™”ë©´ í‘œì‹œë¨');
                },

                // ëŒ€ë¶„ë¥˜ ì„ íƒ
                selectCategory(category) {
                    console.log(`ëŒ€ë¶„ë¥˜ ì„ íƒ: ${category}`);
                    
                    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì €ì¥
                    this.selectedCategory = category;
                    
                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('selected-category').textContent = category;
                    
                    // ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
                    this.updateCategoryButtonSelection(category);
                    
                    // ë”ë¯¸ ë¬¸ì œ ìƒì„± ë° í‘œì‹œ
                    this.loadDummyQuestionsForCategory(category);
                    
                    console.log(`${category} ì¹´í…Œê³ ë¦¬ ì„ íƒë¨`);
                },

                // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateCategoryButtonSelection(selectedCategory) {
                    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('ring-4', 'ring-blue-300', 'ring-2', 'ring-white');
                    });
                    
                    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ê°•ì¡°
                    const selectedButton = document.querySelector(`[data-category="${selectedCategory}"]`);
                    if (selectedButton) {
                        selectedButton.classList.add('ring-4', 'ring-blue-300');
                    }
                },

                // ì¹´í…Œê³ ë¦¬ë³„ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ
                loadDummyQuestionsForCategory(category) {
                    // ë”ë¯¸ ë¬¸ì œ ë°ì´í„° ìƒì„±
                    const dummyQuestions = this.createDummyQuestions(category);
                    
                    // ë¬¸ì œ ëª©ë¡ ì„¤ì •
                    this.filteredQuestions = dummyQuestions;
                    this.currentQuestionIndex = 0;
                    
                    // ë¬¸ì œ í‘œì‹œ ì˜ì—­ í‘œì‹œ
                    document.getElementById('large-category-question-area').classList.remove('hidden');
                    
                    // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
                    this.displayLargeCategoryQuestion();
                    
                    console.log(`${category} ì¹´í…Œê³ ë¦¬ ë”ë¯¸ ë¬¸ì œ ${dummyQuestions.length}ê°œ ë¡œë“œë¨`);
                },

                // ë”ë¯¸ ë¬¸ì œ ìƒì„±
                createDummyQuestions(category) {
                    const questions = [];
                    
                    // ì§„ìœ„í˜• ë¬¸ì œ 3ê°œ
                    for (let i = 1; i <= 3; i++) {
                        questions.push({
                            QCODE: `${category}-TF-${i.toString().padStart(3, '0')}`,
                            TYPE: 'ì§„ìœ„í˜•',
                            QUESTION: `${category} ê´€ë ¨ ì§„ìœ„í˜• ë¬¸ì œ ${i}ë²ˆì…ë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤.`,
                            ANSWER: i % 2 === 0 ? 'O' : 'X',
                            LAYER1: category,
                            LAYER2: 'ë”ë¯¸ì„œë¸Œì¹´í…Œê³ ë¦¬',
                            EXPLAIN: `${category} ì§„ìœ„í˜• ë¬¸ì œ ${i}ë²ˆ í•´ì„¤ì…ë‹ˆë‹¤.`
                        });
                    }
                    
                    // ì„ íƒí˜• ë¬¸ì œ 2ê°œ
                    for (let i = 1; i <= 2; i++) {
                        questions.push({
                            QCODE: `${category}-CH-${i.toString().padStart(3, '0')}`,
                            TYPE: 'ì„ íƒí˜•',
                            QUESTION: `${category} ê´€ë ¨ ì„ íƒí˜• ë¬¸ì œ ${i}ë²ˆì…ë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤.`,
                            ANSWER: i.toString(),
                            LAYER1: category,
                            LAYER2: 'ë”ë¯¸ì„œë¸Œì¹´í…Œê³ ë¦¬',
                            EXPLAIN: `${category} ì„ íƒí˜• ë¬¸ì œ ${i}ë²ˆ í•´ì„¤ì…ë‹ˆë‹¤.`
                        });
                    }
                    
                    return questions;
                },

                // ëŒ€ë¶„ë¥˜ ë¬¸ì œ í‘œì‹œ
                displayLargeCategoryQuestion() {
                    if (this.currentQuestionIndex >= this.filteredQuestions.length) {
                        alert('ëª¨ë“  ë¬¸ì œë¥¼ í’€ì´í–ˆìŠµë‹ˆë‹¤!');
                        return;
                    }

                    this.currentQuestion = this.filteredQuestions[this.currentQuestionIndex];
                    this.selectedAnswer = null;
                    this.isAnswerChecked = false;

                    console.log('ëŒ€ë¶„ë¥˜ ë¬¸ì œ í‘œì‹œ:', this.currentQuestion);

                    // ë¬¸ì œ ì •ë³´ ì—…ë°ì´íŠ¸
                    document.getElementById('large-category-question-type').textContent = this.currentQuestion.TYPE === 'ì§„ìœ„í˜•' ? 'ì§„ìœ„í˜•' : 'ì„ íƒí˜•';
                    document.getElementById('large-category-question-code').textContent = this.currentQuestion.QCODE;
                    document.getElementById('large-category-layer-info').textContent = `${this.currentQuestion.LAYER1} > ${this.currentQuestion.LAYER2}`;
                    document.getElementById('large-category-question-text').textContent = this.currentQuestion.QUESTION;

                    // ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                    this.updateLargeCategoryAnswerButtons();

                    // ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”
                    document.getElementById('large-category-result-area').classList.add('hidden');
                    document.getElementById('large-category-explanation-btn').classList.add('hidden');
                },

                // ëŒ€ë¶„ë¥˜ ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                updateLargeCategoryAnswerButtons() {
                    const container = document.getElementById('large-category-answer-buttons');
                    container.innerHTML = '';

                    if (this.currentQuestion.TYPE === 'ì§„ìœ„í˜•') {
                        // ì§„ìœ„í˜• ë²„íŠ¼
                        const oButton = document.createElement('button');
                        oButton.className = 'answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg';
                        oButton.setAttribute('data-answer', 'O');
                        oButton.onclick = () => this.selectAnswer('O');
                        oButton.textContent = 'O';
                        container.appendChild(oButton);

                        const xButton = document.createElement('button');
                        xButton.className = 'answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg';
                        xButton.setAttribute('data-answer', 'X');
                        xButton.onclick = () => this.selectAnswer('X');
                        xButton.textContent = 'X';
                        container.appendChild(xButton);
                    } else {
                        // ì„ íƒí˜• ë²„íŠ¼
                        for (let i = 1; i <= 4; i++) {
                            const button = document.createElement('button');
                            button.className = 'answer-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg';
                            button.setAttribute('data-answer', i.toString());
                            button.onclick = () => this.selectAnswer(i.toString());
                            button.textContent = i.toString();
                            container.appendChild(button);
                        }
                    }
                },

                // ì´ì–´í’€ê¸° ì‹œì‘
                startContinue() {
                    console.log('ì´ì–´í’€ê¸° ì‹œì‘');
                    this.startQuestionMode();
                },

                // ì²˜ìŒë¶€í„° í’€ê¸° ì‹œì‘ - CSV ì§ì ‘ ë¡œë”© ë°©ì‹
                startFromBeginning() {
                    console.log('=== ì²˜ìŒë¶€í„° í’€ê¸° ì‹œì‘ (CSV ì§ì ‘ ë¡œë”©) ===');
                    
                    // 1. ì²˜ìŒë¶€í„°í’€ê¸° ì‹ í˜¸ë¥¼ ë°›ëŠ”ë‹¤ (ì´ë¯¸ ë°›ìŒ)
                    
                    // 2. í•˜ë‹¨ì— ë°•ìŠ¤ ê³µê°„ì„ ë§Œë“ ë‹¤
                    const questionArea = document.getElementById('question-area');
                    if (questionArea) {
                        questionArea.classList.remove('hidden');
                        console.log('2ë‹¨ê³„: ë°•ìŠ¤ ê³µê°„ ìƒì„± ì™„ë£Œ');
                    } else {
                        console.error('question-area ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                        alert('ë¬¸ì œ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    // 3. CSV ë°ì´í„° ì§ì ‘ ë¡œë”© ë° ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
                    console.log('3ë‹¨ê³„: CSV ë°ì´í„° ë¡œë”© ì‹œì‘');
                    
                    Papa.parse('ins_master_db.csv', {
                        download: true,
                        header: true,
                        complete: function(results) {
                            console.log('CSV íŒŒì‹± ì™„ë£Œ:', results.data.length, 'ê°œ í–‰');
                            
                            // ìœ íš¨í•œ ë°ì´í„°ë§Œ í•„í„°ë§
                            const csvData = results.data.filter(row => 
                                row.QCODE && row.QUESTION && row.ANSWER
                            );
                            
                            console.log('í•„í„°ë§ëœ ë°ì´í„°:', csvData.length, 'ê°œ ë¬¸ì œ');
                            
                            if (csvData.length > 0) {
                                // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
                                const firstQuestion = csvData[0];
                                console.log('ì²« ë²ˆì§¸ ë¬¸ì œ:', firstQuestion);
                                
                                // ë¬¸ì œ í…ìŠ¤íŠ¸ í‘œì‹œ
                                const questionText = document.getElementById('question-text');
                                if (questionText) {
                                    questionText.textContent = firstQuestion.QUESTION;
                                    console.log('ë¬¸ì œ í…ìŠ¤íŠ¸ í‘œì‹œ ì™„ë£Œ');
                                } else {
                                    console.error('question-text ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                                    return;
                                }
                                
                                // ë¬¸ì œ ë²ˆí˜¸ í‘œì‹œ
                                const currentQuestionNumber = document.getElementById('current-question-number');
                                const totalQuestions = document.getElementById('total-questions');
                                if (currentQuestionNumber) currentQuestionNumber.textContent = '1';
                                if (totalQuestions) totalQuestions.textContent = csvData.length;
                                
                                // 4. ë°•ìŠ¤ì˜ í•˜ë‹¨ì— o, x ë˜ëŠ” 1,2,3,4 ë²„íŠ¼ì„ ì œì‹œí•œë‹¤
                                ACIUApp.learning.updateAnswerButtons();
                                
                                // í˜„ì¬ ë¬¸ì œ ìƒíƒœ ì„¤ì •
                                ACIUApp.learning.currentQuestionIndex = 0;
                                ACIUApp.learning.currentQuestion = firstQuestion;
                                ACIUApp.learning.selectedAnswer = null;
                                ACIUApp.learning.isAnswerChecked = false;
                                
                                // CSV ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥
                                ACIUApp.learning.csvData = csvData;
                                
                                console.log('4ë‹¨ê³„: ë‹µì•ˆ ë²„íŠ¼ ì œì‹œ ì™„ë£Œ');
                                console.log('5ë‹¨ê³„: ë°˜ì‘ ëŒ€ê¸° ì¤‘...');
                            } else {
                                console.error('ìœ íš¨í•œ ë¬¸ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                                alert('ë¬¸ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                            }
                        },
                        error: function(error) {
                            console.error('CSV ë¡œë“œ ì˜¤ë¥˜:', error);
                            alert('CSV íŒŒì¼ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                        }
                    });
                },

                // ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (4ë‹¨ê³„) - CSV ë°ì´í„° ì‚¬ìš©
                updateAnswerButtons() {
                    const answerButtons = document.getElementById('answer-buttons');
                    if (!answerButtons) {
                        console.error('answer-buttons ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                        return;
                    }
                    
                    answerButtons.innerHTML = '';
                    
                    // ì§„ìœ„í˜• ë²„íŠ¼ (O, X)
                    const oButton = document.createElement('button');
                    oButton.className = 'answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg mr-2';
                    oButton.setAttribute('data-answer', 'O');
                    oButton.onclick = () => this.selectAnswer('O');
                    oButton.textContent = 'O';
                    answerButtons.appendChild(oButton);

                    const xButton = document.createElement('button');
                    xButton.className = 'answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg';
                    xButton.setAttribute('data-answer', 'X');
                    xButton.onclick = () => this.selectAnswer('X');
                    xButton.textContent = 'X';
                    answerButtons.appendChild(xButton);
                },

                // ë‹µì•ˆ ì„ íƒ (6ë‹¨ê³„) - CSV ë°ì´í„° ì‚¬ìš©
                selectAnswer(answer) {
                    console.log('6ë‹¨ê³„: ì‚¬ìš©ì ë‹µì•ˆ ì„ íƒ:', answer);
                    this.selectedAnswer = answer;
                    
                    // ëª¨ë“  ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
                    this.resetAnswerButtons();
                    
                    // ì„ íƒëœ ë‹µì•ˆ ë²„íŠ¼ ê°•ì¡°
                    const selectedButton = document.querySelector(`[data-answer="${answer}"]`);
                    if (selectedButton) {
                        selectedButton.classList.remove('bg-blue-500', 'bg-red-500');
                        selectedButton.classList.add('bg-yellow-500');
                    }
                },

                // ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™” - CSV ë°ì´í„° ì‚¬ìš©
                resetAnswerButtons() {
                    const buttons = document.querySelectorAll('.answer-btn');
                    buttons.forEach(button => {
                        button.classList.remove('bg-yellow-500');
                        if (button.getAttribute('data-answer') === 'O') {
                            button.classList.add('bg-blue-500');
                        } else if (button.getAttribute('data-answer') === 'X') {
                            button.classList.add('bg-red-500');
                        }
                    });
                },

                // ì •ë‹µ í™•ì¸ (7ë‹¨ê³„) - CSV ë°ì´í„° ì‚¬ìš©
                checkAnswer() {
                    if (!this.selectedAnswer) {
                        alert('ë‹µì•ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }

                    console.log('7ë‹¨ê³„: ì •ë‹µ í™•ì¸');
                    const isCorrect = this.selectedAnswer === this.currentQuestion.ANSWER;
                    this.isAnswerChecked = true;

                    // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
                    const resultArea = document.getElementById('result-area');
                    const resultMessage = document.getElementById('result-message');
                    
                    if (resultArea && resultMessage) {
                        if (isCorrect) {
                            resultMessage.className = 'p-4 rounded-lg bg-green-100 text-green-800';
                            resultMessage.innerHTML = `
                                <div class="flex items-center">
                                    <span class="text-2xl mr-2">âœ…</span>
                                    <span class="font-bold">ì •ë‹µì…ë‹ˆë‹¤!</span>
                                </div>
                                <p class="mt-2">ì •ë‹µ: ${this.currentQuestion.ANSWER}</p>
                            `;
                        } else {
                            resultMessage.className = 'p-4 rounded-lg bg-red-100 text-red-800';
                            resultMessage.innerHTML = `
                                <div class="flex items-center">
                                    <span class="text-2xl mr-2">âŒ</span>
                                    <span class="font-bold">í‹€ë ¸ìŠµë‹ˆë‹¤.</span>
                                </div>
                                <p class="mt-2">ì •ë‹µ: ${this.currentQuestion.ANSWER}</p>
                                <p class="mt-2">ì„ íƒí•œ ë‹µ: ${this.selectedAnswer}</p>
                            `;
                        }
                        
                        resultArea.classList.remove('hidden');
                        console.log('8ë‹¨ê³„: ëŒ€ê¸° ì¤‘...');
                    }
                },

                // ë‹¤ìŒ ë¬¸ì œ (9ë‹¨ê³„) - CSV ë°ì´í„° ì‚¬ìš©
                nextQuestion() {
                    console.log('9ë‹¨ê³„: ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™');
                    
                    if (!this.csvData || this.currentQuestionIndex >= this.csvData.length - 1) {
                        alert('ë§ˆì§€ë§‰ ë¬¸ì œì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
                    this.currentQuestionIndex++;
                    const nextQuestion = this.csvData[this.currentQuestionIndex];
                    
                    console.log('ë‹¤ìŒ ë¬¸ì œ:', nextQuestion);
                    
                    // ë¬¸ì œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    const questionText = document.getElementById('question-text');
                    if (questionText) {
                        questionText.textContent = nextQuestion.QUESTION;
                    }
                    
                    // ë¬¸ì œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                    const currentQuestionNumber = document.getElementById('current-question-number');
                    if (currentQuestionNumber) {
                        currentQuestionNumber.textContent = this.currentQuestionIndex + 1;
                    }
                    
                    // í˜„ì¬ ë¬¸ì œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    this.currentQuestion = nextQuestion;
                    this.selectedAnswer = null;
                    this.isAnswerChecked = false;
                    
                    // ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
                    this.resetAnswerButtons();
                    
                    // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
                    const resultArea = document.getElementById('result-area');
                    if (resultArea) {
                        resultArea.classList.add('hidden');
                    }
                    
                    console.log('ë‹¤ìŒ ë¬¸ì œ í‘œì‹œ ì™„ë£Œ - 3ë‹¨ê³„ë¡œ ëŒì•„ê°');
                },

                // ì´ì „ ë¬¸ì œ - CSV ë°ì´í„° ì‚¬ìš©
                prevQuestion() {
                    if (this.currentQuestionIndex <= 0) {
                        alert('ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    this.currentQuestionIndex--;
                    const prevQuestion = this.csvData[this.currentQuestionIndex];
                    
                    console.log('ì´ì „ ë¬¸ì œ:', prevQuestion);
                    
                    // ë¬¸ì œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    const questionText = document.getElementById('question-text');
                    if (questionText) {
                        questionText.textContent = prevQuestion.QUESTION;
                    }
                    
                    // ë¬¸ì œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                    const currentQuestionNumber = document.getElementById('current-question-number');
                    if (currentQuestionNumber) {
                        currentQuestionNumber.textContent = this.currentQuestionIndex + 1;
                    }
                    
                    // í˜„ì¬ ë¬¸ì œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    this.currentQuestion = prevQuestion;
                    this.selectedAnswer = null;
                    this.isAnswerChecked = false;
                    
                    // ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
                    this.resetAnswerButtons();
                    
                    // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
                    const resultArea = document.getElementById('result-area');
                    if (resultArea) {
                        resultArea.classList.add('hidden');
                    }
                },

                // ëœë¤ í’€ê¸° ì‹œì‘
                startRandom() {
                    console.log('ëœë¤ í’€ê¸° ì‹œì‘');
                    this.currentQuestionIndex = Math.floor(Math.random() * this.filteredQuestions.length);
                    this.startQuestionMode();
                },

                // ë¬¸ì œ í’€ì´ ëª¨ë“œ ì‹œì‘ - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // startQuestionMode() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  startFromBeginning() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // ë¬¸ì œ í‘œì‹œ - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // displayQuestion() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  displayFirstQuestion() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸ - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // updateAnswerButtons() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  ìƒˆë¡œìš´ updateAnswerButtons() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // ë‹µì•ˆ ì„ íƒ - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // selectAnswer() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  ìƒˆë¡œìš´ selectAnswer() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™” - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // resetAnswerButtons() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  ìƒˆë¡œìš´ resetAnswerButtons() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // ì •ë‹µ í™•ì¸ - ì‚¬ìš©ì ìš”ì²­ ê°„ë‹¨í•œ ë²„ì „ (ì œê±°ë¨)
                // checkAnswer() í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ 9ë‹¨ê³„ ë¡œì§ì— ë”°ë¼ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
                // ëŒ€ì‹  ìƒˆë¡œìš´ checkAnswer() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

                // í•´ì„¤ ë³´ê¸°
                showExplanation() {
                    if (this.currentQuestion.EXPLAIN) {
                        alert(`í•´ì„¤: ${this.currentQuestion.EXPLAIN}`);
                    } else {
                        alert('í•´ì„¤ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                },

                // í•™ìŠµ ì´ë ¥ ì €ì¥
                saveLearningHistory(isCorrect) {
                    if (!this.currentQuestion) return;

                    const learningData = {
                        qcode: this.currentQuestion.QCODE,
                        timestamp: new Date().toISOString(),
                        isCorrect: isCorrect,
                        layer1: this.currentQuestion.LAYER1,
                        layer2: this.currentQuestion.LAYER2,
                        mode: this.selectedCategory ? 'large-category' : 'basic'
                    };

                    let history = JSON.parse(localStorage.getItem('aciu_learning_history')) || [];
                    history.push(learningData);
                    localStorage.setItem('aciu_learning_history', JSON.stringify(history));

                    console.log('í•™ìŠµ ì´ë ¥ ì €ì¥ë¨:', learningData);
                }
            }
        };

        // ì¤‘ë¶„ë¥˜ ë°ì´í„° (ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•´ ìµœì†Œí•œë§Œ)
        ACIUApp.midCategoryData = {
            '06ì¬ì‚°ë³´í—˜': {
                main: [
                    { name: 'í™”ì¬ë³´í—˜', count: 188 },
                    { name: 'ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜', count: 130 },
                    { name: 'íŒ¨í‚¤ì§€ë³´í—˜', count: 53 }
                ],
                other: [
                    { name: 'ë™ì‚°ì¢…í•©ë³´í—˜', count: 15 },
                    { name: 'ê¸°ì—…íœ´ì§€ë³´í—˜', count: 8 },
                    { name: 'ì¬ë¬¼ë³´í—˜', count: 5 }
                ]
            },
            '07íŠ¹ì¢…ë³´í—˜': {
                main: [
                    { name: 'ê¸°íƒ€', count: 110 },
                    { name: 'ê¸°ìˆ ë³´í—˜', count: 93 },
                    { name: 'ë²”ì£„ë³´í—˜', count: 51 }
                ],
                other: [
                    { name: 'ê¸°íƒ€íŠ¹ì¢…ë³´í—˜', count: 26 },
                    { name: 'ì¢…í•©ë³´í—˜', count: 8 },
                    { name: 'ê°œìš”', count: 4 }
                ]
            },
            '08ë°°ìƒì±…ì„ë³´í—˜': {
                main: [], // 50ë¬¸ì œ ì´ìƒ ì—†ìŒ
                other: [
                    { name: 'ë³´ê´€ìë°°ìƒì±…ì„', count: 49 },
                    { name: 'ì „ë¬¸ì§ì—…ë°°ìƒ', count: 47 },
                    { name: 'ê°œìš”', count: 37 },
                    { name: 'ë„ê¸‰ì—…ìë°°ìƒì±…ì„', count: 33 },
                    { name: 'ì„ì›ë°°ìƒ', count: 32 },
                    { name: 'ì‹œì„¤ì†Œìœ ê´€ë¦¬ì', count: 26 },
                    { name: 'ìƒì‚°ë¬¼ë°°ìƒì±…ì„', count: 24 },
                    { name: 'ê¸°íƒ€ì£¼ìš”ë³´í—˜', count: 20 }
                ]
            },
            '09í•´ìƒë³´í—˜': {
                main: [
                    { name: 'ê¸°íƒ€', count: 165 },
                    { name: 'í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„', count: 57 },
                    { name: 'í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì •', count: 53 }
                ],
                other: [
                    { name: 'ì í•˜ë³´í—˜', count: 42 },
                    { name: 'í•´ìƒë³´í—˜ê¸°ì´ˆ', count: 33 },
                    { name: 'ê³„ì•½ì˜ ì²´ê²°ê³¼ ë³´í—˜ë£Œ', count: 23 },
                    { name: 'ì„ ë°•ë³´í—˜', count: 23 },
                    { name: 'ìš´ì†¡ë³´í—˜', count: 20 },
                    { name: 'í•´ìƒë³´í—˜ì¡°ê±´', count: 4 }
                ]
            }
        };

        // ì¤‘ë¶„ë¥˜ í•™ìŠµ ìƒíƒœ
        ACIUApp.midCategoryState = {
            selectedLarge: null,
            selectedMid: null,
            isOtherOpen: false,
            currentQuestionIndex: 0,
            filteredQuestions: [],
            selectedAnswer: null,
            isAnswerChecked: false
        };

        // ê¸°ì¡´ learning ê°ì²´ì— ì¤‘ë¶„ë¥˜ ë©”ì„œë“œ ì¶”ê°€
        ACIUApp.learning.startMidCategoryLearning = function() {
            console.log('ì¤‘ë¶„ë¥˜ í•™ìŠµ ëª¨ë“œ ì‹œì‘');
            
            ACIUApp.ui.hideAllScreens(); // ëª¨ë“  í™”ë©´ ìˆ¨ê¹€
            
            // ì¤‘ë¶„ë¥˜ í•™ìŠµ í™”ë©´ í‘œì‹œ
            document.getElementById('mid-category-learning-screen').classList.remove('hidden');
            
            // í˜„ì¬ ëª¨ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('current-mode').textContent = 'ì¤‘ë¶„ë¥˜ í•™ìŠµ';
            
            // ìƒíƒœ ì´ˆê¸°í™”
            ACIUApp.midCategoryState.selectedLarge = null;
            ACIUApp.midCategoryState.selectedMid = null;
            ACIUApp.midCategoryState.isOtherOpen = false;
            
            ACIUApp.learning.resetMidCategoryUI();
        };

        ACIUApp.learning.selectLargeForMid = function(largeCategory) {
            console.log('ì¤‘ë¶„ë¥˜ìš© ëŒ€ë¶„ë¥˜ ì„ íƒ:', largeCategory);
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            ACIUApp.midCategoryState.selectedLarge = largeCategory;
            ACIUApp.midCategoryState.selectedMid = null;
            ACIUApp.midCategoryState.isOtherOpen = false;
            
            // ëŒ€ë¶„ë¥˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            ACIUApp.learning.updateLargeForMidButtons(largeCategory);
            
            // ì¤‘ë¶„ë¥˜ ì˜ì—­ í‘œì‹œ ë° ë²„íŠ¼ ìƒì„±
            ACIUApp.learning.showMidCategoryButtons(largeCategory);
            
            // ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('selected-path').textContent = `ì„ íƒ: ${largeCategory.substring(2)}`;
        };

        ACIUApp.learning.updateLargeForMidButtons = function(selectedCategory) {
            // ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.large-for-mid-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            const selectedBtn = document.querySelector(`[data-category="${selectedCategory}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
        };

        ACIUApp.learning.showMidCategoryButtons = function(largeCategory) {
            const data = ACIUApp.midCategoryData[largeCategory];
            if (!data) return;
            
            const mainContainer = document.getElementById('main-mid-buttons');
            const otherToggle = document.getElementById('other-mid-toggle');
            const midSelection = document.getElementById('mid-category-selection');
            
            // ì¤‘ë¶„ë¥˜ ì„ íƒ ì˜ì—­ í‘œì‹œ
            midSelection.classList.remove('hidden');
            
            // ë©”ì¸ ì¤‘ë¶„ë¥˜ ë²„íŠ¼ ìƒì„±
            mainContainer.innerHTML = '';
            data.main.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'mid-btn';
                btn.innerHTML = `${item.name}<br><span class="text-xs text-gray-500">(${item.count}ë¬¸ì œ)</span>`;
                btn.onclick = () => ACIUApp.learning.selectMidCategory(item.name);
                mainContainer.appendChild(btn);
            });
            
            // ê¸°íƒ€ ì¤‘ë¶„ë¥˜ê°€ ìˆìœ¼ë©´ í† ê¸€ ë²„íŠ¼ í‘œì‹œ
            if (data.other && data.other.length > 0) {
                document.getElementById('other-count').textContent = data.other.length;
                otherToggle.classList.remove('hidden');
                ACIUApp.learning.generateOtherMidButtons(data.other);
            } else {
                otherToggle.classList.add('hidden');
            }
            
            // ê¸°íƒ€ ìƒì„¸ëŠ” ìˆ¨ê¹€
            document.getElementById('other-mid-details').classList.add('hidden');
        };

        ACIUApp.learning.generateOtherMidButtons = function(otherData) {
            const container = document.getElementById('other-mid-buttons');
            container.innerHTML = '';
            
            otherData.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'other-mid-btn';
                btn.innerHTML = `${item.name}<br><span class="text-xs text-gray-400">(${item.count})</span>`;
                btn.onclick = () => ACIUApp.learning.selectMidCategory(item.name);
                container.appendChild(btn);
            });
        };

        ACIUApp.learning.toggleOtherMid = function() {
            const details = document.getElementById('other-mid-details');
            ACIUApp.midCategoryState.isOtherOpen = !ACIUApp.midCategoryState.isOtherOpen;
            
            if (ACIUApp.midCategoryState.isOtherOpen) {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        };

        ACIUApp.learning.selectMidCategory = function(midCategory) {
            console.log('ì¤‘ë¶„ë¥˜ ì„ íƒ:', midCategory);
            
            ACIUApp.midCategoryState.selectedMid = midCategory;
            
            // ëª¨ë“  ì¤‘ë¶„ë¥˜ ë²„íŠ¼ì—ì„œ active ì œê±°
            document.querySelectorAll('.mid-btn, .other-mid-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ì— active ì¶”ê°€ (í…ìŠ¤íŠ¸ ê¸°ë°˜ ê²€ìƒ‰)
            const allMidBtns = document.querySelectorAll('.mid-btn, .other-mid-btn');
            allMidBtns.forEach(btn => {
                if (btn.textContent.includes(midCategory)) { // í…ìŠ¤íŠ¸ì— ì¤‘ë¶„ë¥˜ ì´ë¦„ì´ í¬í•¨ëœ ë²„íŠ¼ì„ ì°¾ìŒ
                    btn.classList.add('active');
                }
            });
            
            // ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const largeName = ACIUApp.midCategoryState.selectedLarge.substring(2);
            document.getElementById('selected-path').textContent = `ì„ íƒ: ${largeName} > ${midCategory}`;
            
            // ì¤‘ë¶„ë¥˜ë³„ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ
            if (midCategory === 'í™”ì¬ë³´í—˜') {
                this.loadFireInsuranceQuestions();
            } else if (midCategory === 'ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜') {
                this.loadPropertyReinsuranceQuestions();
            } else if (midCategory === 'íŒ¨í‚¤ì§€ ëª¨í—˜') {
                this.loadPackageRiskQuestions();
            } else if (midCategory === 'ê¸°íƒ€') {
                this.loadSpecialOtherQuestions();
            } else if (midCategory === 'ê¸°ìˆ ë³´í—˜') {
                this.loadTechnicalInsuranceQuestions();
            } else if (midCategory === 'ë²”ì£„ë³´í—˜') {
                this.loadCrimeInsuranceQuestions();
            } else if (midCategory === 'ê¸°íƒ€' && ACIUApp.midCategoryState.selectedLarge === '09í•´ìƒë³´í—˜') {
                this.loadMarineOtherQuestions();
            } else if (midCategory === 'í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„') {
                this.loadMarineConditionQuestions();
            } else if (midCategory === 'í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì •') {
                this.loadMarineDamageAssessmentQuestions();
            } else {
                // ë‹¤ë¥¸ ì¤‘ë¶„ë¥˜ëŠ” ë‚˜ì¤‘ì— êµ¬í˜„
                alert(`${midCategory} ë¬¸ì œëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
            }
        };

        ACIUApp.learning.resetMidCategoryUI = function() {
            // ì¤‘ë¶„ë¥˜ ì„ íƒ ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.getElementById('mid-category-selection').classList.add('hidden');
            document.getElementById('mid-category-question-area').classList.add('hidden');
            
            // ê²½ë¡œ í‘œì‹œ ì´ˆê¸°í™”
            document.getElementById('selected-path').textContent = 'ì„ íƒ: ì—†ìŒ';
            
            // ëª¨ë“  ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            document.querySelectorAll('.large-for-mid-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì¤‘ë¶„ë¥˜ í•™ìŠµ ìƒíƒœ ì´ˆê¸°í™”
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.filteredQuestions = [];
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
        };

        // í™”ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadFireInsuranceQuestions = function() {
            console.log('í™”ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // í™”ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const fireQuestions = [
                {
                    QCODE: 'FIRE-001',
                    QUESTION: 'í™”ì¬ë³´í—˜ì—ì„œ ë³´í—˜ì‚¬ê³ ê°€ ë°œìƒí•œ ê²½ìš°, í”¼ë³´í—˜ìëŠ” ì§€ì²´ ì—†ì´ ë³´í—˜íšŒì‚¬ì— ê·¸ ì‚¬ì‹¤ì„ í†µì§€í•˜ì—¬ì•¼ í•œë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'í™”ì¬ë³´í—˜'
                },
                {
                    QCODE: 'FIRE-002',
                    QUESTION: 'í™”ì¬ë³´í—˜ì˜ ë³´í—˜ê¸°ê°„ì€ ë³´í—˜ê³„ì•½ìê°€ ë³´í—˜ë£Œë¥¼ ë‚©ì…í•œ ë‚ ë¡œë¶€í„° ì‹œì‘ëœë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'í™”ì¬ë³´í—˜'
                },
                {
                    QCODE: 'FIRE-003',
                    QUESTION: 'í™”ì¬ë³´í—˜ì—ì„œ ë³´í—˜ëª©ì ë¬¼ì˜ ì†Œìœ ê¶Œì´ ë³€ê²½ëœ ê²½ìš°, ë³´í—˜ê³„ì•½ì€ ìë™ìœ¼ë¡œ í•´ì§€ëœë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'í™”ì¬ë³´í—˜'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = fireQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadPropertyReinsuranceQuestions = function() {
            console.log('ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const propertyReinsuranceQuestions = [
                {
                    QCODE: 'PROP-RE-001',
                    QUESTION: 'ì¬ë³´í—˜ì€ ì›ë³´í—˜ìê°€ ìœ„í—˜ì„ ë¶„ì‚°ì‹œí‚¤ê¸° ìœ„í•´ ë³´í—˜íšŒì‚¬ì— ë‹¤ì‹œ ë³´í—˜ì„ ë“¤ ìˆ˜ ìˆëŠ” ì œë„ì´ë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜'
                },
                {
                    QCODE: 'PROP-RE-002',
                    QUESTION: 'ì¬ë³´í—˜ê³„ì•½ì—ì„œ ì›ë³´í—˜ìëŠ” ì¬ë³´í—˜ìì—ê²Œ ë³´í—˜ë£Œë¥¼ ì§€ê¸‰í•  ì˜ë¬´ê°€ ì—†ë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜'
                },
                {
                    QCODE: 'PROP-RE-003',
                    QUESTION: 'ì¬ë³´í—˜ì€ ì›ë³´í—˜ìì˜ ì±…ì„ì„ ì™„ì „íˆ ë©´ì œì‹œì¼œì£¼ëŠ” ì œë„ì´ë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'ì¬ë¬¼ë³´í—˜ì¬ë³´í—˜'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = propertyReinsuranceQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // íŒ¨í‚¤ì§€ ëª¨í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadPackageRiskQuestions = function() {
            console.log('íŒ¨í‚¤ì§€ ëª¨í—˜ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // íŒ¨í‚¤ì§€ ëª¨í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const packageRiskQuestions = [
                {
                    QCODE: 'PKG-RISK-001',
                    QUESTION: 'íŒ¨í‚¤ì§€ ë³´í—˜ì€ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ìœ„í—˜ì„ í•˜ë‚˜ì˜ ê³„ì•½ìœ¼ë¡œ ë¬¶ì–´ì„œ ë³´ì¥í•˜ëŠ” ì œë„ì´ë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'íŒ¨í‚¤ì§€ ëª¨í—˜'
                },
                {
                    QCODE: 'PKG-RISK-002',
                    QUESTION: 'íŒ¨í‚¤ì§€ ë³´í—˜ì˜ ë³´í—˜ë£ŒëŠ” ê° ìœ„í—˜ë³„ë¡œ ê°œë³„ì ìœ¼ë¡œ ê³„ì‚°ëœë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'íŒ¨í‚¤ì§€ ëª¨í—˜'
                },
                {
                    QCODE: 'PKG-RISK-003',
                    QUESTION: 'íŒ¨í‚¤ì§€ ë³´í—˜ì—ì„œ í•˜ë‚˜ì˜ ìœ„í—˜ì´ ë°œìƒí•˜ë©´ ë‹¤ë¥¸ ìœ„í—˜ì— ëŒ€í•œ ë³´ì¥ë„ ìë™ìœ¼ë¡œ í•´ì§€ëœë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'ì¬ì‚°ë³´í—˜',
                    LAYER2: 'íŒ¨í‚¤ì§€ ëª¨í—˜'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = packageRiskQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // íŠ¹ì¢…ë³´í—˜ ê¸°íƒ€ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadSpecialOtherQuestions = function() {
            console.log('íŠ¹ì¢…ë³´í—˜ ê¸°íƒ€ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // íŠ¹ì¢…ë³´í—˜ ê¸°íƒ€ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const specialOtherQuestions = [
                {
                    QCODE: 'SPEC-OTHER-001',
                    QUESTION: 'íŠ¹ì¢…ë³´í—˜ì€ ì¼ë°˜ì ì¸ ë³´í—˜ìœ¼ë¡œëŠ” ë³´ì¥í•˜ê¸° ì–´ë ¤ìš´ íŠ¹ìˆ˜í•œ ìœ„í—˜ì„ ë‹¤ë£¨ëŠ” ë³´í—˜ì´ë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°íƒ€'
                },
                {
                    QCODE: 'SPEC-OTHER-002',
                    QUESTION: 'íŠ¹ì¢…ë³´í—˜ì€ í•­ìƒ ì˜ë¬´ ê°€ì… ëŒ€ìƒì´ë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°íƒ€'
                },
                {
                    QCODE: 'SPEC-OTHER-003',
                    QUESTION: 'íŠ¹ì¢…ë³´í—˜ì˜ ë³´í—˜ë£ŒëŠ” ì¼ë°˜ ë³´í—˜ë³´ë‹¤ í•­ìƒ ë†’ë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°íƒ€'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = specialOtherQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // ê¸°ìˆ ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadTechnicalInsuranceQuestions = function() {
            console.log('ê¸°ìˆ ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // ê¸°ìˆ ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const technicalInsuranceQuestions = [
                {
                    QCODE: 'TECH-INS-001',
                    QUESTION: 'ê¸°ìˆ ë³´í—˜ì€ ê±´ì„¤ê³µì‚¬ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì†í•´ë¥¼ ë³´ì¥í•˜ëŠ” ë³´í—˜ì´ë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°ìˆ ë³´í—˜'
                },
                {
                    QCODE: 'TECH-INS-002',
                    QUESTION: 'ê¸°ìˆ ë³´í—˜ì€ ì™„ì„±ëœ ê±´ë¬¼ì˜ í’ˆì§ˆ ì €í•˜ë¡œ ì¸í•œ ì†ì‹¤ë„ ë³´ìƒí•œë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°ìˆ ë³´í—˜'
                },
                {
                    QCODE: 'TECH-INS-003',
                    QUESTION: 'ê¸°ìˆ ë³´í—˜ì€ ì„¤ê³„ ì˜¤ë¥˜ë¡œ ì¸í•œ ì†í•´ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ê¸°ìˆ ë³´í—˜'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = technicalInsuranceQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // ë²”ì£„ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadCrimeInsuranceQuestions = function() {
            console.log('ë²”ì£„ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            
            // ë²”ì£„ë³´í—˜ ë”ë¯¸ ë¬¸ì œ ìƒì„±
            const crimeInsuranceQuestions = [
                {
                    QCODE: 'CRIME-INS-001',
                    QUESTION: 'ë²”ì£„ë³´í—˜ì€ ê¸°ì—…ì˜ ì§ì›ì— ì˜í•œ íš¡ë ¹ ì†í•´ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ë²”ì£„ë³´í—˜'
                },
                {
                    QCODE: 'CRIME-INS-002',
                    QUESTION: 'ë²”ì£„ë³´í—˜ì€ ëª¨ë“  ì¢…ë¥˜ì˜ ì‚¬ê¸° í–‰ìœ„ë¡œ ì¸í•œ ì†í•´ë¥¼ ë¬´ì¡°ê±´ ë³´ì¥í•œë‹¤.',
                    ANSWER: 'X',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ë²”ì£„ë³´í—˜'
                },
                {
                    QCODE: 'CRIME-INS-003',
                    QUESTION: 'ë²”ì£„ë³´í—˜ì€ ê°•ë„ë‚˜ ì ˆë„ë¡œ ì¸í•œ ì¬ì‚° ì†ì‹¤ì„ ë³´ì¥í•œë‹¤.',
                    ANSWER: 'O',
                    TYPE: 'ì§„ìœ„í˜•',
                    LAYER1: 'íŠ¹ì¢…ë³´í—˜',
                    LAYER2: 'ë²”ì£„ë³´í—˜'
                }
            ];
            
            // ë¬¸ì œ ëª©ë¡ ì„¤ì •
            ACIUApp.midCategoryState.filteredQuestions = crimeInsuranceQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            
            // ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            
            // ì²« ë²ˆì§¸ ë¬¸ì œ í‘œì‹œ
            this.displayMidQuestion();
        };

        // í•´ìƒë³´í—˜ ê¸°íƒ€ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadMarineOtherQuestions = function() {
            console.log('í•´ìƒë³´í—˜ ê¸°íƒ€ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            const marineOtherQuestions = [
                { QCODE: 'MARINE-OTHER-001', QUESTION: 'í•´ìƒë³´í—˜ì€ í•´ìƒì—ì„œ ë°œìƒí•˜ëŠ” ìœ„í—˜ì„ ë³´ì¥í•˜ëŠ” ë³´í—˜ì´ë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'ê¸°íƒ€' },
                { QCODE: 'MARINE-OTHER-002', QUESTION: 'í•´ìƒë³´í—˜ì€ ìœ¡ìƒì—ì„œ ë°œìƒí•˜ëŠ” ëª¨ë“  ìœ„í—˜ì„ ë³´ì¥í•œë‹¤.', ANSWER: 'X', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'ê¸°íƒ€' },
                { QCODE: 'MARINE-OTHER-003', QUESTION: 'í•´ìƒë³´í—˜ì€ ì„ ë°•, ì í•˜, ìš´ì†¡ ë“±ê³¼ ê´€ë ¨ëœ ìœ„í—˜ì„ ë‹¤ë£¬ë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'ê¸°íƒ€' }
            ];
            ACIUApp.midCategoryState.filteredQuestions = marineOtherQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            this.displayMidQuestion();
        };

        // í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„ ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadMarineConditionQuestions = function() {
            console.log('í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„ ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            const marineConditionQuestions = [
                { QCODE: 'MARINE-COND-001', QUESTION: 'í•´ìƒë³´í—˜ì˜ ë³´ìƒë²”ìœ„ëŠ” ë³´í—˜ì¦ê¶Œì— ëª…ì‹œëœ ì¡°ê±´ì— ë”°ë¼ ê²°ì •ëœë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„' },
                { QCODE: 'MARINE-COND-002', QUESTION: 'í•´ìƒë³´í—˜ì€ ëª¨ë“  í•´ìƒì‚¬ê³ ë¥¼ ë¬´ì¡°ê±´ ë³´ìƒí•œë‹¤.', ANSWER: 'X', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„' },
                { QCODE: 'MARINE-COND-003', QUESTION: 'í•´ìƒë³´í—˜ì˜ ì¡°ê±´ì—ëŠ” ë©´ì±…ì‚¬ìœ ê°€ í¬í•¨ë  ìˆ˜ ìˆë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì¡°ê±´ê³¼ë³´ìƒë²”ìœ„' }
            ];
            ACIUApp.midCategoryState.filteredQuestions = marineConditionQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            this.displayMidQuestion();
        };

        // í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì • ë”ë¯¸ ë¬¸ì œ ìƒì„±
        ACIUApp.learning.loadMarineDamageAssessmentQuestions = function() {
            console.log('í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì • ë”ë¯¸ ë¬¸ì œ ë¡œë“œ');
            const marineDamageAssessmentQuestions = [
                { QCODE: 'MARINE-DAMAGE-001', QUESTION: 'í•´ìƒë³´í—˜ì˜ ì†í•´ì‚¬ì •ì€ ì „ë¬¸ì ì¸ ì§€ì‹ê³¼ ê²½í—˜ì´ í•„ìš”í•œ ì—…ë¬´ì´ë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì •' },
                { QCODE: 'MARINE-DAMAGE-002', QUESTION: 'ì†í•´ì‚¬ì •ì€ ë³´í—˜ê¸ˆ ì§€ê¸‰ì˜ ê·¼ê±°ê°€ ë˜ëŠ” ì¤‘ìš”í•œ ì ˆì°¨ì´ë‹¤.', ANSWER: 'O', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì •' },
                { QCODE: 'MARINE-DAMAGE-003', QUESTION: 'í•´ìƒë³´í—˜ì˜ ì†í•´ì‚¬ì •ì€ ìœ¡ìƒë³´í—˜ê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì§„í–‰ëœë‹¤.', ANSWER: 'X', TYPE: 'ì§„ìœ„í˜•', LAYER1: 'í•´ìƒë³´í—˜', LAYER2: 'í•´ìƒë³´í—˜ì˜ì†í•´ì‚¬ì •' }
            ];
            ACIUApp.midCategoryState.filteredQuestions = marineDamageAssessmentQuestions;
            ACIUApp.midCategoryState.currentQuestionIndex = 0;
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;
            document.getElementById('mid-category-question-area').classList.remove('hidden');
            this.displayMidQuestion();
        };

        // ì¤‘ë¶„ë¥˜ ë¬¸ì œ í‘œì‹œ
        ACIUApp.learning.displayMidQuestion = function() {
            if (ACIUApp.midCategoryState.currentQuestionIndex >= ACIUApp.midCategoryState.filteredQuestions.length) {
                alert('ëª¨ë“  ë¬¸ì œë¥¼ í’€ì´í–ˆìŠµë‹ˆë‹¤!');
                return;
            }

            const currentQuestion = ACIUApp.midCategoryState.filteredQuestions[ACIUApp.midCategoryState.currentQuestionIndex];
            ACIUApp.midCategoryState.selectedAnswer = null;
            ACIUApp.midCategoryState.isAnswerChecked = false;

            console.log('ì¤‘ë¶„ë¥˜ ë¬¸ì œ í‘œì‹œ:', currentQuestion);

            // ë¬¸ì œ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('mid-question-code').textContent = currentQuestion.QCODE;
            document.getElementById('mid-question-text').textContent = currentQuestion.QUESTION;
            document.getElementById('mid-current-question-number').textContent = ACIUApp.midCategoryState.currentQuestionIndex + 1;
            document.getElementById('mid-total-questions').textContent = ACIUApp.midCategoryState.filteredQuestions.length;

            // ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            this.updateMidAnswerButtons();

            // ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”
            document.getElementById('mid-result-area').classList.add('hidden');

            // ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
            this.resetMidAnswerButtons();
        };

        // ì¤‘ë¶„ë¥˜ ë‹µì•ˆ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        ACIUApp.learning.updateMidAnswerButtons = function() {
            const answerButtons = document.getElementById('mid-answer-buttons');
            answerButtons.innerHTML = '';

            // ì§„ìœ„í˜• ë²„íŠ¼
            const oButton = document.createElement('button');
            oButton.className = 'mid-answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg';
            oButton.setAttribute('data-answer', 'O');
            oButton.onclick = () => ACIUApp.learning.selectMidAnswer('O');
            oButton.textContent = 'O';
            answerButtons.appendChild(oButton);

            const xButton = document.createElement('button');
            xButton.className = 'mid-answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg';
            xButton.setAttribute('data-answer', 'X');
            xButton.onclick = () => ACIUApp.learning.selectMidAnswer('X');
            xButton.textContent = 'X';
            answerButtons.appendChild(xButton);
        };

        // ì¤‘ë¶„ë¥˜ ë‹µì•ˆ ì„ íƒ
        ACIUApp.learning.selectMidAnswer = function(answer) {
            console.log('ì¤‘ë¶„ë¥˜ ë‹µì•ˆ ì„ íƒ:', answer);
            ACIUApp.midCategoryState.selectedAnswer = answer;
            
            // ëª¨ë“  ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
            this.resetMidAnswerButtons();
            
            // ì„ íƒëœ ë‹µì•ˆ ë²„íŠ¼ ê°•ì¡°
            const selectedButton = document.querySelector(`[data-answer="${answer}"]`);
            if (selectedButton) {
                selectedButton.classList.remove('bg-blue-500', 'bg-red-500');
                selectedButton.classList.add('bg-yellow-500');
            }
        };

        // ì¤‘ë¶„ë¥˜ ë‹µì•ˆ ë²„íŠ¼ ì´ˆê¸°í™”
        ACIUApp.learning.resetMidAnswerButtons = function() {
            const buttons = document.querySelectorAll('.mid-answer-btn');
            buttons.forEach(button => {
                button.classList.remove('bg-yellow-500');
                if (button.getAttribute('data-answer') === 'O') {
                    button.classList.add('bg-blue-500');
                } else if (button.getAttribute('data-answer') === 'X') {
                    button.classList.add('bg-red-500');
                }
            });
        };

        // ì¤‘ë¶„ë¥˜ ì •ë‹µ í™•ì¸
        ACIUApp.learning.checkMidAnswer = function() {
            if (!ACIUApp.midCategoryState.selectedAnswer) {
                alert('ë‹µì•ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const currentQuestion = ACIUApp.midCategoryState.filteredQuestions[ACIUApp.midCategoryState.currentQuestionIndex];
            const isCorrect = ACIUApp.midCategoryState.selectedAnswer === currentQuestion.ANSWER;
            ACIUApp.midCategoryState.isAnswerChecked = true;

            // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
            const resultArea = document.getElementById('mid-result-area');
            const resultMessage = document.getElementById('mid-result-message');
            
            if (isCorrect) {
                resultMessage.className = 'p-4 rounded-lg bg-green-100 text-green-800';
                resultMessage.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">âœ…</span>
                        <span class="font-bold">ì •ë‹µì…ë‹ˆë‹¤!</span>
                    </div>
                    <p class="mt-2">ì •ë‹µ: ${currentQuestion.ANSWER}</p>
                `;
            } else {
                resultMessage.className = 'p-4 rounded-lg bg-red-100 text-red-800';
                resultMessage.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">âŒ</span>
                        <span class="font-bold">í‹€ë ¸ìŠµë‹ˆë‹¤.</span>
                    </div>
                    <p class="mt-2">ì •ë‹µ: ${currentQuestion.ANSWER}</p>
                    <p class="mt-2">ì„ íƒí•œ ë‹µ: ${ACIUApp.midCategoryState.selectedAnswer}</p>
                `;
            }
            
            resultArea.classList.remove('hidden');
        };

        // ì¤‘ë¶„ë¥˜ ë‹¤ìŒ ë¬¸ì œ
        ACIUApp.learning.nextMidQuestion = function() {
            if (ACIUApp.midCategoryState.currentQuestionIndex < ACIUApp.midCategoryState.filteredQuestions.length - 1) {
                ACIUApp.midCategoryState.currentQuestionIndex++;
                this.displayMidQuestion();
            } else {
                alert('ë§ˆì§€ë§‰ ë¬¸ì œì…ë‹ˆë‹¤.');
            }
        };

        // ì¤‘ë¶„ë¥˜ ì´ì „ ë¬¸ì œ
        ACIUApp.learning.previousMidQuestion = function() {
            if (ACIUApp.midCategoryState.currentQuestionIndex > 0) {
                ACIUApp.midCategoryState.currentQuestionIndex--;
                this.displayMidQuestion();
            } else {
                alert('ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.');
            }
        };

        // ACIUApp ì´ˆê¸°í™” í•¨ìˆ˜
        ACIUApp.init = async function() {
            console.log('ACIUApp ì´ˆê¸°í™” ì‹œì‘');
            
            // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í™•ì¸
            this.compatibility.checkBrowserSupport();
            
            // CSV ë°ì´í„° ë¡œë”©
            try {
                await ACIUApp.data.loadMasterData();
                console.log('CSV ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('CSV ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            
            // ê¸°ì¡´ ë°ì´í„° ë¡œë”©
            await this.data.loadQuestions();
            this.data.loadUserSettings();
            this.data.loadLearningHistory();
            
            // UI ì´ˆê¸°í™”
            this.ui.init();
            
            // ê¸°ë³¸ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸
            this.ui.updateBasicLearningStats();
            
            console.log('ACIUApp ì´ˆê¸°í™” ì™„ë£Œ');
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            ACIUApp.init();
        });
    </script>
</body>
</html>