[코코치의 기획안]

AICU QUIZ 앱 통계 기능 개발 기획안 V1.0
📊 프로젝트 개요
목표: index_test_v1.0.html 앱에 조대표님의 상세 통계 요구사항을 반영하여 학습 현황을 시각적으로 명확하게 제공하고, 사용자 경험을 향상시킵니다.

핵심 원칙:

코드 최소화: 기존 함수 재활용 및 신규 함수는 엄격히 모듈화하여 2,000줄 이상의 코드 라인 수를 효율적으로 관리합니다.

데이터 지속성: 사용자가 어떤 디바이스에서 접근하더라도 통계 수치가 계속 업데이트되도록 Local Storage를 활용합니다.

사용자 중심: 설정에서 사용자 등록 시점부터 통계 기록을 개시하며, 초기화 기능을 통해 모든 데이터를 관리할 수 있도록 합니다.

🏗️ 시스템 구성 및 데이터 관리
1. 데이터 저장 구조 (Local Storage)
기존 aicu_save_data 및 aicu_user_settings 외에, 통계 데이터를 보다 세분화하여 저장할 수 있도록 구조를 확장합니다.

aicu_statistics_global: 전체 앱에 대한 누적 통계

totalSolved: 총 푼 문제 수

totalCorrect: 총 정답 수

totalIncorrect: 총 오답 수

lastUpdated: 마지막 업데이트 시점 (ISO String)

registrationDate: 사용자 등록 시점 (통계 기록 개시 시점)

aicu_statistics_daily: 일별 통계 (날짜별로 관리)

YYYY-MM-DD: { solved: 오늘 푼 문제 수, correct: 오늘 정답 수, incorrect: 오늘 오답 수 }

aicu_statistics_mode: 학습 모드별 통계 (기본학습, 대분류학습)

basic: { totalSolved, totalCorrect, totalIncorrect }

largeCategory: { totalSolved, totalCorrect, totalIncorrect }

aicu_statistics_category: 대분류 카테고리별 통계 (재산보험, 특종보험 등)

재산보험: { totalSolved, totalCorrect, totalIncorrect, dailySolved, dailyCorrect, dailyIncorrect }

특종보험: { totalSolved, totalCorrect, totalIncorrect, dailySolved, dailyCorrect, dailyIncorrect }

... (나머지 카테고리 동일)

2. 데이터 기록 시점
사용자 등록 시점: saveUserSettings() 함수 내에서 aicu_statistics_global의 registrationDate를 현재 시점으로 기록합니다. 이 시점부터 모든 통계 기록이 개시됩니다.

문제 풀이 시점: checkAnswer() 함수 내에서 정답/오답 여부에 따라 aicu_statistics_global, aicu_statistics_daily, aicu_statistics_mode, aicu_statistics_category 데이터를 실시간으로 업데이트합니다.

🔧 핵심 기능 구현 방안
1. 대문 (Home Screen) 통계
현재 index_test_v1.0.html의 대문 섹션에 통계 정보를 표시합니다.

1.1. 보유 문제수 현황:

ins_master_db.csv에서 "인스교재" 및 "보험중개사 시험"에 해당하는 행 수를 카운트하여 표시합니다.

기존 함수 활용: Papa.parse를 통해 ins_master_db.csv를 로드하는 함수를 재활용하거나, 앱 초기 로딩 시 한 번만 계산하여 전역 변수에 저장합니다.

표시 위치: 현재 "보유 문제수 현황" 섹션 (id="ins-questions", id="exam-questions", id="total-questions")을 업데이트합니다.

1.2. 학습 진도 현황:

완료한 문제: aicu_statistics_global.totalSolved 값을 표시합니다.

전체 진도율: aicu_statistics_global.totalSolved / 총 보유 문제수 (인스교재 + 보험중개사 시험) * 100%를 계산하여 표시합니다.

정답률 (오늘의 진도율 변경): aicu_statistics_global.totalCorrect / aicu_statistics_global.totalSolved * 100%를 계산하여 표시합니다.

표시 위치: 현재 "학습 진도 현황" 섹션 (id="completed-questions", id="overall-progress-rate", id="daily-progress-rate"를 accuracy-rate 등으로 변경)을 업데이트합니다.

1.3. 금일의 학습 현황 박스 (신규 추가):

HTML 구조 추가: 대문 화면에 새로운 박스를 추가하여 "금일의 학습 현황"을 표시합니다.

오늘 풀이한 총 문제수: aicu_statistics_daily[오늘 날짜].solved 값을 표시합니다.

오늘 풀이한 총 문제 중 정답 수: aicu_statistics_daily[오늘 날짜].correct 값을 표시합니다.

오늘 풀이한 전체 문제 대비 정답률: aicu_statistics_daily[오늘 날짜].correct / aicu_statistics_daily[오늘 날짜].solved * 100%를 계산하여 표시합니다.

갱신 시점:

개별 문제 풀이 시 (checkAnswer()) 자동으로 갱신됩니다.

"통계 데이터 불러오기" 버튼 클릭 시 (loadStatisticsData()) 갱신됩니다.

2. 기본학습 (Basic Learning Screen) 통계
기존 basic-learning-screen 내의 통계 영역을 확장합니다.

2.1. 누적 현황:

aicu_statistics_mode.basic.totalSolved (총 문제수)

aicu_statistics_mode.basic.totalCorrect (총 정답수)

aicu_statistics_mode.basic.totalCorrect / aicu_statistics_mode.basic.totalSolved * 100% (총 정답률)

표시 위치: 현재 "학습 통계" 섹션 (id="total-questions", id="correct-answers", id="incorrect-answers")을 재구성하여 표시합니다.

2.2. 금일 현황 (신규 추가):

HTML 구조 추가: 누적 현황 아래에 "금일 현황" 섹션을 추가합니다.

aicu_statistics_daily[오늘 날짜].solved (금일 푼 문제수)

aicu_statistics_daily[오늘 날짜].correct (금일 정답수)

aicu_statistics_daily[오늘 날짜].correct / aicu_statistics_daily[오늘 날짜].solved * 100% (금일 정답률)

갱신 시점: 문제 풀이 시 (checkAnswer()) 및 화면 진입 시 (loadBasicLearningData()) 갱신됩니다.

3. 대분류학습 (Large Category Screen) 통계
기존 large-category-screen 내의 통계 영역을 확장합니다.

3.1. 대분류 학습 전체 누적 통계:

표시 위치: "대분류학습" 제목 우측에 별도 UI 요소를 추가하여 표시합니다.

aicu_statistics_mode.largeCategory.totalSolved (푼 문제수)

aicu_statistics_mode.largeCategory.totalCorrect (맞은 문제수)

aicu_statistics_mode.largeCategory.totalCorrect / aicu_statistics_mode.largeCategory.totalSolved * 100% (정답률)

갱신 시점: 대분류 학습 모드 진입 시 (selectLargeCategory()) 및 문제 풀이 시 (checkAnswer()) 갱신됩니다.

3.2. 특정 대분류 (재산보험, 특종보험 등) 통계:

HTML 구조 추가: 각 카테고리 선택 버튼 아래 또는 별도 섹션에 해당 카테고리의 통계 박스를 추가합니다.

누적 현황:

aicu_statistics_category[카테고리명].totalSolved (총 문제수)

aicu_statistics_category[카테고리명].totalCorrect (총 정답수)

aicu_statistics_category[카테고리명].totalCorrect / aicu_statistics_category[카테고리명].totalSolved * 100% (총 정답률)

금일 현황:

aicu_statistics_category[카테고리명].dailySolved (금일 푼 문제수)

aicu_statistics_category[카테고리명].dailyCorrect (금일 정답수)

aicu_statistics_category[카테고리명].dailyCorrect / aicu_statistics_category[카테고리명].dailySolved * 100% (금일 정답률)

갱신 시점: 해당 카테고리 선택 시 (selectLargeCategory(category)) 및 해당 카테고리 문제 풀이 시 (checkAnswer()) 갱신됩니다.

4. 설정 (User Settings) 모달 통계 관리
현재 학습 통계 표시: updateCurrentStatsDisplay() 함수를 사용하여 aicu_statistics_global 데이터를 기반으로 "푼 문제: X개, 정답률: Y%"를 표시합니다.

전체 초기화: clearAllStatistics() 함수를 확장하여 aicu_statistics_global, aicu_statistics_daily, aicu_statistics_mode, aicu_statistics_category 등 모든 통계 관련 Local Storage 데이터를 삭제하고, 화면에 표시되는 통계 값들을 0으로 초기화합니다.

🛠️ 함수 재활용 및 신규 함수 설계 (모듈화)
기존 ACIU_FINAL_개발경과보고서V1.0.md에 명시된 함수들을 최대한 재활용하고, 필요한 경우 새로운 함수를 추가하되, 기능별로 명확히 분리하여 모듈성을 유지합니다.

1. 기존 함수 확장/수정
updateStatistics(isCorrect, mode, category):

매개변수를 추가하여 현재 학습 모드와 카테고리 정보를 받습니다.

이 함수 내에서 aicu_statistics_global, aicu_statistics_daily, aicu_statistics_mode, aicu_statistics_category 데이터를 모두 업데이트하도록 로직을 확장합니다.

saveProgress() (혹은 새로운 통계 저장 함수)를 호출하여 Local Storage에 변경사항을 즉시 반영합니다.

loadStatisticsData():

대문 화면의 "통계 데이터 불러오기" 버튼 클릭 시 호출됩니다.

Local Storage에서 모든 통계 데이터를 로드하여 전역 window.statistics 객체 및 각 통계 표시 UI에 반영하는 역할을 합니다.

updateQuestionCounts(), updateProgressData(), updateDailyStatisticsDisplay() (신규), updateModeStatisticsDisplay() (신규), updateCategoryStatisticsDisplay() (신규) 등을 호출하여 모든 통계 UI를 갱신합니다.

updateProgressData():

기존 함수를 확장하여 aicu_statistics_global 데이터를 기반으로 "완료한 문제", "전체 진도율", "정답률"을 계산하고 대문에 표시합니다.

updateBasicStatistics() / updateLargeCategoryStatistics():

각 학습 모드 화면에서 호출되며, 해당 모드의 누적 통계(aicu_statistics_mode)를 기반으로 UI를 갱신하도록 로직을 수정합니다.

2. 신규 함수 (필요시)
initializeStatistics():

앱 초기 로딩 시 또는 clearAllStatistics() 호출 시 모든 통계 데이터를 0으로 초기화하고 Local Storage에 저장합니다.

사용자 등록 시 registrationDate를 설정하고, 이 날짜 이전의 통계는 기록하지 않도록 로직을 포함합니다.

updateDailyStatisticsDisplay():

aicu_statistics_daily 데이터를 기반으로 "금일의 학습 현황" 박스를 업데이트하는 전용 함수.

updateModeStatisticsDisplay(mode):

특정 학습 모드(기본학습, 대분류학습)의 통계(aicu_statistics_mode)를 UI에 반영하는 함수.

updateCategoryStatisticsDisplay(category):

특정 대분류 카테고리의 통계(aicu_statistics_category)를 UI에 반영하는 함수.

getTodayDateString():

오늘 날짜를 YYYY-MM-DD 형식의 문자열로 반환하는 유틸리티 함수. 일별 통계 관리에 사용됩니다.

🚀 개발 로드맵 (Phase별)
Phase 1: 데이터 모델 및 초기화 (1일)
Local Storage에 통계 데이터(aicu_statistics_global, aicu_statistics_daily, aicu_statistics_mode, aicu_statistics_category)를 저장할 초기 구조 정의.

initializeStatistics() 함수 구현 및 앱 초기 로딩 시 호출.

saveUserSettings() 함수에 registrationDate 기록 로직 추가.

clearAllStatistics() 함수 확장하여 모든 통계 데이터 초기화 기능 구현.

Phase 2: 대문 통계 구현 (2일)
"보유 문제수 현황" 섹션 업데이트 로직 구현. (CSV 파싱 로직 재활용)

"학습 진도 현황" 섹션 업데이트 로직 구현 (완료한 문제, 전체 진도율, 정답률).

"금일의 학습 현황" 박스 HTML 구조 추가 및 updateDailyStatisticsDisplay() 함수 구현.

checkAnswer() 함수 내에서 대문 통계 데이터 업데이트 로직 연동.

"통계 데이터 불러오기" 버튼 (loadStatisticsData()) 기능 구현 및 연동.

Phase 3: 학습 모드별 통계 구현 (3일)
기본학습:

"누적 현황" 및 "금일 현황" 섹션 HTML 구조 추가/수정.

updateBasicStatistics() 함수 확장하여 해당 UI 업데이트.

checkAnswer() 함수 내에서 기본학습 통계 데이터 업데이트 로직 연동.

대분류학습:

"대분류 학습 전체 누적 통계" HTML 구조 추가 및 updateModeStatisticsDisplay('largeCategory') 함수 구현.

각 특정 대분류(재산보험, 특종보험 등) 통계 섹션 HTML 구조 추가.

updateCategoryStatisticsDisplay(category) 함수 구현.

checkAnswer() 함수 내에서 대분류학습 및 특정 카테고리 통계 데이터 업데이트 로직 연동.

Phase 4: 테스트 및 최적화 (1일)
각 통계 기능별 단위 테스트 수행.

통계 데이터가 Local Storage에 정상적으로 저장되고 로드되는지 확인.

코드 중복 제거 및 함수 재활용 여부 최종 검토.

성능 저하 여부 확인 및 필요한 경우 최적화.

📈 예상 성과 지표
기능 완성도: 통계 요구사항 100% 구현

코드 품질:

신규 코드 라인 최소화 (기존 코드 대비 10% 이내 목표)

함수 재활용률 80% 이상

모듈화 원칙 준수

데이터 지속성: Local Storage를 통한 영구 데이터 저장 및 디바이스 간 동기화 (간접)

사용자 경험: 학습 현황에 대한 명확하고 실시간적인 피드백 제공

⚠️ 고려사항 및 리스크
데이터 정합성: checkAnswer() 함수 내에서 여러 통계 데이터를 동시에 업데이트할 때 데이터 정합성 유지에 주의해야 합니다. 트랜잭션 개념은 아니지만, 순차적으로 업데이트하여 오류를 방지합니다.

Local Storage 용량: 대량의 일별 통계 데이터가 누적될 경우 Local Storage 용량 제한에 유의해야 합니다. (일반적으로 5~10MB) 현재 앱 규모에서는 큰 문제가 없을 것으로 예상되나, 장기적으로는 서버 DB 연동을 고려할 수 있습니다.

날짜 기반 통계: 일별 통계는 사용자의 디바이스 날짜 설정에 의존하므로, 날짜 변경 시 통계가 초기화되는 것처럼 보일 수 있습니다. (이는 요구사항에 부합)

UI 업데이트 성능: 통계 데이터가 많아질 경우 UI 업데이트 시 성능 저하가 발생할 수 있으므로, 효율적인 DOM 조작 방안을 고려합니다.

조대표님, 이 기획안을 바탕으로 통계 기능 개발을 진행하시면 코드 품질과 기능 완성도 모두를 만족시킬 수 있을 것입니다. 추가적인 의견이나 수정사항이 있으시면 언제든지 말씀해 주십시오.

[서대리의 기획안]
현재 작업파일의 구조를 먼저 확인하고, 통계기능 요구사항을 분석한 후 구현 방안을 제시하겠습니다.

Read file: index_test_v1.0.html
파일이 너무 길어서 전체를 읽을 수 없습니다. 통계기능 요구사항을 분석하고 구현 방안을 제시하겠습니다.

## 현재 파일 구조 분석

현재 `index_test_v1.0.html` 파일을 확인한 결과:

### 기존 구조
1. **대문 화면**: 보유문제수 현황, 학습진도 현황이 이미 구현되어 있음
2. **기본학습 화면**: 이어풀기, 처음풀기, 랜덤풀기 모드
3. **대분류학습 화면**: 재산보험, 특종보험, 배상책임보험, 해상보험
4. **통계 기능**: 기본적인 통계 표시 기능이 있지만 요구사항에 맞지 않음

## 통계기능 요구사항 분석

### 1. 보유문제수 현황
- **현재**: 인스교재, 보험중개사시험, 합계로 표시
- **요구사항**: `ins_master_db.csv`에서 소스필드 기준으로 인스교재 제외 보험중개사 시험 행수 카운트

### 2. 학습진도 현황
- **현재**: 완료한 문제, 전체 진도율, 오늘 진도율
- **요구사항**: 
  - 완료한 문제: 사용자 등록 후 풀이한 모든 문제 수
  - 전체진도율: 풀이한 문제 / 보유문제수
  - 정답율: 풀이한 문제 중 정답 비율

### 3. 금일 학습현황 (새로 추가 필요)
- 오늘 풀이한 총 문제수
- 오늘 정답수
- 오늘 정답율

### 4. 기본학습 통계
- 누적현황: 총 문제수, 총 정답수, 총 정답률
- 금일현황: 금일 푼 문제수, 금일 정답수, 금일 정답율

### 5. 대분류학습 통계
- 전체 대분류 학습 통계
- 개별 대분류별 통계 (재산보험, 특종보험, 배상책임보험, 해상보험)

## 구현 방안 제시

### 1. 데이터 구조 설계

```javascript
// 통계 데이터 구조
const StatisticsData = {
  // 사용자 정보
  userInfo: {
    registrationDate: '2025-01-01',
    deviceId: 'unique-device-id'
  },
  
  // 보유문제수
  questionCounts: {
    insQuestions: 0,      // 인스교재 문제수
    examQuestions: 0,     // 보험중개사시험 문제수
    totalQuestions: 0     // 합계
  },
  
  // 학습진도
  learningProgress: {
    completedQuestions: 0,    // 완료한 문제수
    overallProgressRate: 0,   // 전체진도율
    accuracyRate: 0          // 정답율
  },
  
  // 금일 현황
  todayStats: {
    totalQuestions: 0,    // 오늘 푼 문제수
    correctAnswers: 0,    // 오늘 정답수
    accuracyRate: 0       // 오늘 정답율
  },
  
  // 기본학습 통계
  basicLearning: {
    cumulative: {
      totalQuestions: 0,
      correctAnswers: 0,
      accuracyRate: 0
    },
    today: {
      totalQuestions: 0,
      correctAnswers: 0,
      accuracyRate: 0
    }
  },
  
  // 대분류학습 통계
  largeCategoryLearning: {
    overall: {
      totalQuestions: 0,
      correctAnswers: 0,
      accuracyRate: 0
    },
    categories: {
      '재산보험': {
        cumulative: { totalQuestions: 0, correctAnswers: 0, accuracyRate: 0 },
        today: { totalQuestions: 0, correctAnswers: 0, accuracyRate: 0 }
      },
      '특종보험': { /* 동일 구조 */ },
      '배상책임보험': { /* 동일 구조 */ },
      '해상보험': { /* 동일 구조 */ }
    }
  }
};
```

### 2. 실시간 업데이트 시스템

```javascript
// 통계 업데이트 함수들
const StatisticsManager = {
  // 문제 풀이 시 호출
  updateOnQuestionAnswered: function(questionData, isCorrect, category, mode) {
    // 1. 전체 통계 업데이트
    this.updateOverallStatistics(isCorrect);
    
    // 2. 금일 통계 업데이트
    this.updateTodayStatistics(isCorrect);
    
    // 3. 모드별 통계 업데이트
    if (mode === 'basic') {
      this.updateBasicLearningStatistics(isCorrect);
    } else if (mode === 'large-category') {
      this.updateLargeCategoryStatistics(isCorrect, category);
    }
    
    // 4. 화면 업데이트
    this.updateDisplay();
    
    // 5. 로컬 스토리지 저장
    this.saveToLocalStorage();
  },
  
  // 보유문제수 계산
  calculateQuestionCounts: function() {
    // ins_master_db.csv에서 소스필드 기준으로 계산
    // 인스교재 제외 보험중개사 시험 문제수 카운트
  },
  
  // 진도율 계산
  calculateProgressRate: function() {
    const completed = this.getCompletedQuestions();
    const total = this.getTotalQuestions();
    return total > 0 ? (completed / total) * 100 : 0;
  },
  
  // 정답율 계산
  calculateAccuracyRate: function(questions, correct) {
    return questions > 0 ? (correct / questions) * 100 : 0;
  }
};
```

### 3. 데이터 저장 및 동기화

```javascript
// 로컬 스토리지 관리
const StorageManager = {
  // 통계 데이터 저장
  saveStatistics: function(data) {
    localStorage.setItem('aicu_statistics', JSON.stringify(data));
  },
  
  // 통계 데이터 로드
  loadStatistics: function() {
    const data = localStorage.getItem('aicu_statistics');
    return data ? JSON.parse(data) : this.getInitialStatistics();
  },
  
  // 초기 통계 데이터
  getInitialStatistics: function() {
    return {
      userInfo: {
        registrationDate: new Date().toISOString(),
        deviceId: this.generateDeviceId()
      },
      // ... 나머지 초기 데이터
    };
  },
  
  // 디바이스 ID 생성
  generateDeviceId: function() {
    // 브라우저 정보 + 시간 기반 고유 ID 생성
  }
};
```

### 4. UI 업데이트 시스템

```javascript
// 화면 업데이트 관리
const DisplayManager = {
  // 대문 통계 업데이트
  updateHomeStatistics: function() {
    // 보유문제수 현황 업데이트
    this.updateQuestionCounts();
    
    // 학습진도 현황 업데이트
    this.updateLearningProgress();
    
    // 금일 학습현황 업데이트
    this.updateTodayStats();
  },
  
  // 기본학습 통계 업데이트
  updateBasicLearningStats: function() {
    // 누적현황 업데이트
    this.updateCumulativeStats();
    
    // 금일현황 업데이트
    this.updateTodayStats();
  },
  
  // 대분류학습 통계 업데이트
  updateLargeCategoryStats: function(category) {
    // 전체 통계 업데이트
    this.updateOverallLargeCategoryStats();
    
    // 개별 카테고리 통계 업데이트
    if (category) {
      this.updateCategoryStats(category);
    }
  }
};
```

### 5. 자동 갱신 시스템

```javascript
// 실시간 업데이트 설정
const AutoUpdateManager = {
  // 문제 풀이 시 자동 갱신
  setupAutoUpdate: function() {
    // 문제 풀이 완료 이벤트 리스너
    document.addEventListener('questionAnswered', (event) => {
      const { questionData, isCorrect, category, mode } = event.detail;
      StatisticsManager.updateOnQuestionAnswered(questionData, isCorrect, category, mode);
    });
  },
  
  // 수동 갱신 버튼
  setupManualUpdate: function() {
    const updateButton = document.getElementById('load-statistics-btn');
    if (updateButton) {
      updateButton.addEventListener('click', () => {
        this.refreshAllStatistics();
      });
    }
  },
  
  // 모든 통계 새로고침
  refreshAllStatistics: function() {
    // 1. 보유문제수 재계산
    StatisticsManager.calculateQuestionCounts();
    
    // 2. 진도율 재계산
    StatisticsManager.calculateProgressRate();
    
    // 3. 정답율 재계산
    StatisticsManager.calculateAccuracyRate();
    
    // 4. 화면 업데이트
    DisplayManager.updateHomeStatistics();
  }
};
```

### 6. 초기화 기능

```javascript
// 설정 초기화 기능
const ResetManager = {
  // 모든 데이터 초기화
  resetAllData: function() {
    // 1. 로컬 스토리지 클리어
    localStorage.removeItem('aicu_statistics');
    localStorage.removeItem('aicu_progress');
    localStorage.removeItem('aicu_save_data');
    
    // 2. 전역 변수 초기화
    window.statistics = null;
    window.currentQuestionIndex = 0;
    window.selectedAnswer = null;
    
    // 3. 초기 통계 데이터 생성
    const initialStats = StorageManager.getInitialStatistics();
    StorageManager.saveStatistics(initialStats);
    
    // 4. 화면 새로고침
    location.reload();
  }
};
```

## 구현 우선순위

### Phase 1: 핵심 통계 기능
1. 보유문제수 현황 (ins_master_db.csv 분석)
2. 학습진도 현황 (완료한 문제, 전체진도율, 정답율)
3. 금일 학습현황 (새로운 박스 추가)

### Phase 2: 모드별 통계
1. 기본학습 통계 (누적현황, 금일현황)
2. 대분류학습 통계 (전체 + 개별 카테고리)

### Phase 3: 고급 기능
1. 실시간 업데이트 최적화
2. 데이터 동기화 (여러 디바이스)
3. 성능 최적화

## 기술적 고려사항

1. **데이터 일관성**: 로컬 스토리지를 활용하여 디바이스 간 데이터 동기화
2. **성능 최적화**: 통계 계산을 효율적으로 처리
3. **사용자 경험**: 실시간 업데이트와 수동 갱신 옵션 제공
4. **확장성**: 새로운 학습 모드 추가 시 쉽게 확장 가능한 구조

이 방안으로 구현하면 요구사항에 맞는 완전한 통계 시스템을 구축할 수 있습니다.

[노팀장의 기획안]
조대표님의 요구사항을 분석하여 종합적인 통계기능 개발 기획안을 작성했습니다. 

## 🎯 **핵심 특징**

1. **코드 효율성**: 기존 2000+ 줄 코드에 최소한의 추가로 구현
2. **함수 재사용**: 동일 기능을 하나의 함수로 통합 처리
3. **데이터 일관성**: 모든 디바이스에서 동기화되는 LocalStorage 기반 시스템
4. **실시간 업데이트**: 답안 제출 시 즉시 통계 반영

## 📊 **주요 구현 사항**

### **대문 화면**
- 보유 문제수 현황 (ins_master_db.csv 기반)
- 학습 진도 현황 (완료 문제, 전체 진도율, 정답률)
- **새로운 금일 학습현황 박스** (오늘 풀이 문제, 정답 수, 정답률)

### **기본학습**
- 누적 현황 (총 문제, 정답 수, 정답률)
- 금일 현황 (오늘 문제, 정답 수, 정답률)

### **대분류학습**
- 전체 누적 통계 (상단 표시)
- 카테고리별 상세 통계 (재산보험, 특종보험, 배상책임보험, 해상보험)

## 🛠️ **기술적 장점**

1. **모듈화된 함수 구조**: 각 통계 기능을 독립적인 함수로 분리
2. **배치 업데이트**: 성능 최적화를 위한 일괄 처리
3. **캐시 시스템**: 중복 계산 방지
4. **에러 처리**: 견고한 데이터 관리

이 기획안대로 구현하시면 요구사항을 모두 충족하면서도 코드 품질을 유지할 수 있을 것입니다. 개발 단계별로 진행하시면서 필요한 부분은 언제든 질문해 주세요!

세부기획안

# 📊 AICU 통계기능 개발 기획안 v1.0

## 🎯 **프로젝트 개요**

- **대상 파일**: `index_test_v1.0.html`
- **현재 코드 라인**: 2,000+ 줄
- **목표**: 종합적인 통계 시스템 구현
- **개발 원칙**: 코드 최적화 및 함수 재사용 극대화

---

## 📋 **요구사항 분석**

### **1. 데이터 기록 시점**
- 사용자 설정 등록 시점부터 통계 시작
- 크로스 디바이스 데이터 동기화 (로컬스토리지 기반)
- 설정 초기화 시 모든 데이터 삭제

### **2. 통계 카테고리**
- **대문 통계**: 전체 현황 + 오늘 학습현황
- **기본학습 통계**: 누적 + 금일 현황
- **대분류학습 통계**: 전체 + 카테고리별 (누적 + 금일)

---

## 🏗️ **데이터 구조 설계**

### **LocalStorage 데이터 스키마**
```javascript
const statisticsSchema = {
  userInfo: {
    registeredAt: "2025-07-29T00:00:00Z",
    userName: "조대표님",
    lastSyncAt: "2025-07-29T15:30:00Z"
  },
  globalStats: {
    totalAttempted: 0,
    totalCorrect: 0,
    totalIncorrect: 0,
    accuracy: 0
  },
  dailyStats: {
    "2025-07-29": {
      attempted: 0,
      correct: 0,
      incorrect: 0,
      accuracy: 0
    }
  },
  modeStats: {
    basic: {
      cumulative: { attempted: 0, correct: 0, accuracy: 0 },
      daily: { attempted: 0, correct: 0, accuracy: 0 }
    },
    largeCategory: {
      cumulative: { attempted: 0, correct: 0, accuracy: 0 },
      daily: { attempted: 0, correct: 0, accuracy: 0 },
      categories: {
        "재산보험": {
          cumulative: { attempted: 0, correct: 0, accuracy: 0 },
          daily: { attempted: 0, correct: 0, accuracy: 0 }
        },
        "특종보험": {
          cumulative: { attempted: 0, correct: 0, accuracy: 0 },
          daily: { attempted: 0, correct: 0, accuracy: 0 }
        },
        "배상책임보험": {
          cumulative: { attempted: 0, correct: 0, accuracy: 0 },
          daily: { attempted: 0, correct: 0, accuracy: 0 }
        },
        "해상보험": {
          cumulative: { attempted: 0, correct: 0, accuracy: 0 },
          daily: { attempted: 0, correct: 0, accuracy: 0 }
        }
      }
    }
  },
  questionCounts: {
    "인스교재": 0,
    "보험중개사시험": 0,
    total: 0
  }
}
```

---

## 🛠️ **핵심 함수 설계**

### **1. 데이터 관리 함수**
```javascript
// 통계 데이터 초기화
function initializeStatistics()

// 통계 데이터 로드
function loadStatisticsData()

// 통계 데이터 저장
function saveStatisticsData(stats)

// 일일 통계 초기화 (자정 시)
function resetDailyStats()

// 전체 통계 초기화
function clearAllStatistics()
```

### **2. 데이터 계산 함수**
```javascript
// 정답률 계산
function calculateAccuracy(correct, total)

// 진도율 계산
function calculateProgress(completed, total)

// 오늘 날짜 키 생성
function getTodayKey()

// 문제 소스별 카운트
function countQuestionsBySource(csvData)
```

### **3. 통계 업데이트 함수**
```javascript
// 답안 결과 기록
function recordAnswerResult(isCorrect, mode, category = null)

// 글로벌 통계 업데이트
function updateGlobalStatistics(isCorrect)

// 모드별 통계 업데이트
function updateModeStatistics(mode, category, isCorrect)

// 일일 통계 업데이트
function updateDailyStatistics(isCorrect, mode, category = null)
```

### **4. UI 업데이트 함수**
```javascript
// 대문 통계 표시
function updateHomeStatistics()

// 보유 문제수 표시
function updateQuestionCounts()

// 학습 진도 현황 표시
function updateProgressDisplay()

// 금일 학습현황 표시
function updateTodayStats()

// 기본학습 통계 표시
function updateBasicLearningStats()

// 대분류학습 통계 표시
function updateLargeCategoryStats(category = null)
```

---

## 📱 **UI 구조 설계**

### **1. 대문 화면 수정**
```html
<!-- 기존 보유 문제수 현황 유지 -->

<!-- 학습 진도 현황 수정 -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">학습 진도 현황</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center">
            <div class="text-2xl font-bold text-blue-600" id="completed-questions">0</div>
            <div class="text-sm text-gray-600">완료한 문제</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-green-600" id="overall-progress-rate">0%</div>
            <div class="text-sm text-gray-600">전체 진도율</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-purple-600" id="overall-accuracy-rate">0%</div>
            <div class="text-sm text-gray-600">정답률</div>
        </div>
    </div>
</div>

<!-- 새로운 금일 학습현황 박스 -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">금일 학습현황</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center">
            <div class="text-2xl font-bold text-orange-600" id="today-attempted">0</div>
            <div class="text-sm text-gray-600">오늘 풀이한 문제</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-green-600" id="today-correct">0</div>
            <div class="text-sm text-gray-600">오늘 정답 수</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-blue-600" id="today-accuracy">0%</div>
            <div class="text-sm text-gray-600">오늘 정답률</div>
        </div>
    </div>
</div>
```

### **2. 기본학습 화면 통계 추가**
```html
<!-- 기존 통계 정보 영역 수정 -->
<div class="mt-6 p-4 bg-blue-50 rounded">
    <h4 class="font-semibold mb-4">기본학습 통계</h4>
    
    <!-- 누적 현황 -->
    <div class="mb-4">
        <h5 class="text-sm font-medium text-gray-700 mb-2">누적 현황</h5>
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-lg font-bold text-blue-600" id="basic-total-attempted">0</div>
                <div class="text-xs text-gray-600">총 문제</div>
            </div>
            <div>
                <div class="text-lg font-bold text-green-600" id="basic-total-correct">0</div>
                <div class="text-xs text-gray-600">총 정답</div>
            </div>
            <div>
                <div class="text-lg font-bold text-purple-600" id="basic-total-accuracy">0%</div>
                <div class="text-xs text-gray-600">총 정답률</div>
            </div>
        </div>
    </div>
    
    <!-- 금일 현황 -->
    <div>
        <h5 class="text-sm font-medium text-gray-700 mb-2">금일 현황</h5>
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-lg font-bold text-orange-600" id="basic-today-attempted">0</div>
                <div class="text-xs text-gray-600">금일 문제</div>
            </div>
            <div>
                <div class="text-lg font-bold text-green-600" id="basic-today-correct">0</div>
                <div class="text-xs text-gray-600">금일 정답</div>
            </div>
            <div>
                <div class="text-lg font-bold text-blue-600" id="basic-today-accuracy">0%</div>
                <div class="text-xs text-gray-600">금일 정답률</div>
            </div>
        </div>
    </div>
</div>
```

### **3. 대분류학습 화면 통계 추가**
```html
<!-- 대분류 전체 누적 통계 (상단) -->
<div class="mb-6 p-4 bg-green-50 rounded">
    <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold">대분류학습</h3>
        <div class="flex space-x-4 text-sm">
            <span>총 <span id="large-category-total" class="font-bold">0</span>문제</span>
            <span>정답 <span id="large-category-correct" class="font-bold">0</span>개</span>
            <span>정답률 <span id="large-category-accuracy" class="font-bold">0%</span></span>
        </div>
    </div>
</div>

<!-- 개별 카테고리 선택 후 상세 통계 (기존 통계 영역 대체) -->
<div id="category-specific-stats" class="mt-6 p-4 bg-green-50 rounded hidden">
    <h4 class="font-semibold mb-4"><span id="current-category-name">재산보험</span> 통계</h4>
    
    <!-- 누적 현황 -->
    <div class="mb-4">
        <h5 class="text-sm font-medium text-gray-700 mb-2">누적 현황</h5>
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-lg font-bold text-green-600" id="category-total-attempted">0</div>
                <div class="text-xs text-gray-600">총 문제</div>
            </div>
            <div>
                <div class="text-lg font-bold text-green-600" id="category-total-correct">0</div>
                <div class="text-xs text-gray-600">총 정답</div>
            </div>
            <div>
                <div class="text-lg font-bold text-purple-600" id="category-total-accuracy">0%</div>
                <div class="text-xs text-gray-600">총 정답률</div>
            </div>
        </div>
    </div>
    
    <!-- 금일 현황 -->
    <div>
        <h5 class="text-sm font-medium text-gray-700 mb-2">금일 현황</h5>
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-lg font-bold text-orange-600" id="category-today-attempted">0</div>
                <div class="text-xs text-gray-600">금일 문제</div>
            </div>
            <div>
                <div class="text-lg font-bold text-green-600" id="category-today-correct">0</div>
                <div class="text-xs text-gray-600">금일 정답</div>
            </div>
            <div>
                <div class="text-lg font-bold text-blue-600" id="category-today-accuracy">0%</div>
                <div class="text-xs text-gray-600">금일 정답률</div>
            </div>
        </div>
    </div>
</div>
```

---

## 🔄 **통합 워크플로우**

### **1. 앱 초기화 시**
```javascript
function initializeApp() {
    // 기존 초기화 로직
    
    // 통계 시스템 초기화
    initializeStatistics();
    
    // 문제 수 카운트 (CSV 로드 후)
    loadQuestionCounts();
    
    // 통계 UI 업데이트
    updateAllStatistics();
}
```

### **2. 답안 제출 시**
```javascript
function checkAnswer(mode) {
    // 기존 정답 확인 로직
    const isCorrect = selectedAnswer === currentQuestion.ANSWER;
    
    // 통계 기록
    recordAnswerResult(isCorrect, mode, currentCategory);
    
    // UI 업데이트
    updateModeSpecificStats(mode, currentCategory);
    updateHomeStatistics();
}
```

### **3. 설정 변경 시**
```javascript
function saveUserSettings() {
    // 기존 사용자 설정 저장 로직
    
    // 통계 초기화 (신규 사용자인 경우)
    if (isNewUser) {
        initializeStatistics();
    }
}

function clearAllStatistics() {
    // 모든 통계 데이터 삭제
    localStorage.removeItem('aicu_statistics');
    
    // UI 초기화
    resetAllStatisticsUI();
}
```

---

## 📈 **성능 최적화 전략**

### **1. 데이터 배치 업데이트**
```javascript
// 개별 업데이트 대신 배치 업데이트 사용
function batchUpdateStatistics() {
    const stats = loadStatisticsData();
    
    // 모든 계산을 메모리에서 수행
    updateAllCalculations(stats);
    
    // 한 번에 UI 업데이트
    updateAllUI(stats);
    
    // 한 번에 저장
    saveStatisticsData(stats);
}
```

### **2. 캐시 활용**
```javascript
// 계산 결과 캐싱
const calculationCache = new Map();

function getCachedCalculation(key, calculationFn) {
    if (!calculationCache.has(key)) {
        calculationCache.set(key, calculationFn());
    }
    return calculationCache.get(key);
}
```

### **3. 지연 로딩**
```javascript
// 필요할 때만 통계 계산
function getStatisticsOnDemand(type) {
    return lazy(() => calculateStatistics(type));
}
```

---

## 🧪 **테스트 전략**

### **1. 단위 테스트**
```javascript
// 통계 계산 함수 테스트
function testCalculateAccuracy() {
    assert(calculateAccuracy(7, 10) === 70);
    assert(calculateAccuracy(0, 0) === 0);
}

// 데이터 저장/로드 테스트
function testStatisticsStorage() {
    const testStats = { attempted: 10, correct: 7 };
    saveStatisticsData(testStats);
    const loaded = loadStatisticsData();
    assert(JSON.stringify(testStats) === JSON.stringify(loaded));
}
```

### **2. 통합 테스트**
```javascript
// 전체 워크플로우 테스트
function testCompleteWorkflow() {
    initializeStatistics();
    recordAnswerResult(true, 'basic');
    recordAnswerResult(false, 'basic');
    
    const stats = loadStatisticsData();
    assert(stats.globalStats.totalAttempted === 2);
    assert(stats.globalStats.totalCorrect === 1);
}
```

---

## 📅 **개발 일정**

### **Phase 1: 데이터 구조 구축 (1일)**
- [ ] LocalStorage 스키마 설계
- [ ] 기본 데이터 관리 함수 구현
- [ ] CSV 파싱 및 문제 수 카운트

### **Phase 2: 핵심 통계 로직 (1일)**
- [ ] 답안 결과 기록 시스템
- [ ] 통계 계산 함수들
- [ ] 일일 통계 관리

### **Phase 3: UI 통합 (1일)**
- [ ] 대문 통계 표시
- [ ] 기본학습 통계 표시
- [ ] 대분류학습 통계 표시

### **Phase 4: 최적화 및 테스트 (0.5일)**
- [ ] 성능 최적화
- [ ] 버그 수정
- [ ] 통합 테스트

---

## 🎯 **성공 지표**

### **기능적 요구사항**
- [ ] 모든 통계 수치가 실시간으로 정확하게 계산됨
- [ ] 크로스 디바이스에서 데이터 동기화 됨
- [ ] 설정 초기화 시 모든 데이터가 삭제됨

### **성능 요구사항**
- [ ] 통계 업데이트 시간 < 100ms
- [ ] 메모리 사용량 증가 < 10%
- [ ] 코드 라인 증가 < 500줄

### **사용자 경험**
- [ ] 직관적인 통계 표시
- [ ] 로딩 지연 없음
- [ ] 데이터 손실 없음

---

## 🔧 **리스크 관리**

### **데이터 손실 방지**
- 매 답안 제출 시 자동 저장
- 브라우저 종료 시 최종 저장
- 백업 데이터 유지

### **성능 저하 방지**
- 배치 업데이트 적용
- 불필요한 계산 최소화
- 메모리 누수 방지

### **코드 복잡도 관리**
- 함수 분리 및 재사용
- 명확한 네이밍 컨벤션
- 주석 및 문서화

---

**📋 결론**: 위 기획안에 따라 개발하면 효율적이고 확장 가능한 통계 시스템을 구축할 수 있으며, 기존 코드와의 원활한 통합이 가능합니다.