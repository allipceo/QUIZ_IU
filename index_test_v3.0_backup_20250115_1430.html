<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICU QUIZ ì•± v3.0</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Papa Parse ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .hidden {
            display: none !important;
        }
        
        .answer-btn {
            transition: all 0.3s ease;
        }
        
        .answer-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- ê¸°ë³¸ ì»¨í…Œì´ë„ˆ -->
    <div id="app" class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
            AICU QUIZ ì•± v3.0
        </h1>
        
        <!-- í™ˆ í™”ë©´ (ëª¨ë“ˆ 3.1) -->
        <div id="home-screen" class="bg-white rounded-lg shadow-md p-8">
            <!-- ì²« ë²ˆì§¸ ë°•ìŠ¤ - D-day ì¹´ìš´í„°ì™€ ëª…ì–¸ -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
                <!-- ìƒë‹¨ ì •ë³´ -->
                <div class="flex justify-between items-start mb-6">
                    <!-- ì¢Œì¸¡ìƒë‹¨: ì‚¬ìš©ìëª…ê³¼ ì‹œí—˜ëª… -->
                    <div class="text-left">
                        <div class="text-lg font-semibold text-gray-800" id="user-name-display">ì‚¬ìš©ì: ì¡°ëŒ€í‘œë‹˜</div>
                        <div class="text-sm text-gray-600">ì‹œí—˜ëª…: ACIU</div>
                    </div>
                    
                    <!-- ìš°ì¸¡ìƒë‹¨: ì‹œí—˜ì¼ -->
                    <div class="text-right">
                        <div class="text-sm text-gray-600">ì‹œí—˜ì¼</div>
                        <div class="text-lg font-semibold text-gray-800" id="exam-date-display">2025ë…„ 12ì›” 15ì¼</div>
                    </div>
                </div>
                
                <!-- D-day ì¹´ìš´í„° -->
                <div class="text-center mb-6">
                    <div class="text-6xl font-bold text-blue-600 mb-2" id="d-day-display">D-138ì¼</div>
                    <div class="text-sm text-gray-600">ì‹œí—˜ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜</div>
                </div>
                
                <!-- ì˜¤ëŠ˜ì˜ ëª…ì–¸ -->
                <div class="text-center">
                    <p class="text-3xl text-gray-700 italic font-medium" id="quote-of-day">
                        "ê¾¸ì¤€í•¨ì´ ìµœê³ ì˜ ì¬ëŠ¥ì…ë‹ˆë‹¤."
                    </p>
                </div>
            </div>

            <!-- ì„¤ì • ë²„íŠ¼ê³¼ í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ -->
            <div class="flex justify-end mb-4 space-x-3">
                <button onclick="loadStatisticsData()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm">
                    ğŸ“Š í†µê³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <button onclick="openUserSettings()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded text-sm">
                    âš™ï¸ ì„¤ì •
                </button>
            </div>

            <!-- ë³´ìœ  ë¬¸ì œìˆ˜ í˜„í™© -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ë³´ìœ  ë¬¸ì œìˆ˜ í˜„í™©</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="ins-questions">0</div>
                        <div class="text-sm text-gray-600">ì¸ìŠ¤êµì¬</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="exam-questions">0</div>
                        <div class="text-sm text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="total-questions">0</div>
                        <div class="text-sm text-gray-600">í•©ê³„</div>
                    </div>
                </div>
            </div>

            <!-- í•™ìŠµ ì§„ë„ í˜„í™© -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµ ì§„ë„ í˜„í™©</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="completed-questions">0</div>
                        <div class="text-sm text-gray-600">ì™„ë£Œí•œ ë¬¸ì œ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="progress-rate">0%</div>
                        <div class="text-sm text-gray-600">ì „ì²´ ì§„ë„ìœ¨</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600" id="accuracy-rate">0%</div>
                        <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                    </div>
                </div>
            </div>

            <!-- ê¸ˆì¼ í•™ìŠµ í˜„í™© (ì¡°ëŒ€í‘œë‹˜ ìš”êµ¬ì‚¬í•­ 3ë²ˆ) -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">ê¸ˆì¼ í•™ìŠµ í˜„í™©</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="today-total">0</div>
                        <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì´ ë¬¸ì œìˆ˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="today-correct">0</div>
                        <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µìˆ˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600" id="today-accuracy">0%</div>
                        <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µë¥ </div>
                    </div>
                </div>
            </div>

            <!-- í•™ìŠµ ëª¨ë“œ ì„ íƒ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">í•™ìŠµ ëª¨ë“œ ì„ íƒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="startBasicLearning()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-lg font-semibold transition-colors">
                        ğŸ“š ê¸°ë³¸í•™ìŠµ
                    </button>
                    <button onclick="startLargeCategoryLearning()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-lg font-semibold transition-colors">
                        ğŸ¯ ëŒ€ë¶„ë¥˜í•™ìŠµ
                    </button>
                </div>
            </div>
        </div>

        <!-- ê¸°ë³¸í•™ìŠµ í™”ë©´ (ëª¨ë“ˆ 3.2) -->
        <div id="basic-learning-screen" class="hidden bg-white rounded-lg shadow-md p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ê¸°ë³¸í•™ìŠµ</h2>
                <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                    â† í™ˆìœ¼ë¡œ
                </button>
            </div>

            <!-- ê¸°ë³¸í•™ìŠµ í†µê³„ (ëˆ„ì /ê¸ˆì¼ êµ¬ë¶„) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- ëˆ„ì í˜„í™© -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3">ëˆ„ì í˜„í™©</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-xl font-bold text-blue-600" id="basic-cumulative-total">0</div>
                            <div class="text-sm text-gray-600">ì´ ë¬¸ì œìˆ˜</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-green-600" id="basic-cumulative-correct">0</div>
                            <div class="text-sm text-gray-600">ì •ë‹µìˆ˜</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-orange-600" id="basic-cumulative-accuracy">0%</div>
                            <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                        </div>
                    </div>
                </div>
                
                <!-- ê¸ˆì¼í˜„í™© -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">ê¸ˆì¼í˜„í™©</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-xl font-bold text-blue-600" id="basic-daily-total">0</div>
                            <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ë¬¸ì œìˆ˜</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-green-600" id="basic-daily-correct">0</div>
                            <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µìˆ˜</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-orange-600" id="basic-daily-accuracy">0%</div>
                            <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µë¥ </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¬¸ì œ í‘œì‹œ ì˜ì—­ -->
            <div id="question-container" class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="text-center">
                    <p class="text-lg text-gray-600 mb-4">í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                </div>
            </div>

            <!-- ë‹µì•ˆ ë²„íŠ¼ ì˜ì—­ -->
            <div id="answer-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ë‹µì•ˆ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ëŒ€ë¶„ë¥˜í•™ìŠµ í™”ë©´ (ëª¨ë“ˆ 3.3) -->
        <div id="large-category-learning-screen" class="hidden bg-white rounded-lg shadow-md p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ëŒ€ë¶„ë¥˜í•™ìŠµ</h2>
                <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                    â† í™ˆìœ¼ë¡œ
                </button>
            </div>

            <!-- ëŒ€ë¶„ë¥˜í•™ìŠµ ì „ì²´ ëˆ„ì  í†µê³„ -->
            <div class="bg-blue-50 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">ëŒ€ë¶„ë¥˜í•™ìŠµ ì „ì²´ ëˆ„ì  í†µê³„</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-xl font-bold text-blue-600" id="large-cumulative-total">0</div>
                        <div class="text-sm text-gray-600">ì´ ë¬¸ì œìˆ˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-green-600" id="large-cumulative-correct">0</div>
                        <div class="text-sm text-gray-600">ì •ë‹µìˆ˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-orange-600" id="large-cumulative-accuracy">0%</div>
                        <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <button onclick="selectCategory('ì¬ì‚°ë³´í—˜')" class="category-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center transition-colors">
                    <div class="text-lg font-semibold">ì¬ì‚°ë³´í—˜</div>
                    <div class="text-sm opacity-90">Property Insurance</div>
                </button>
                <button onclick="selectCategory('íŠ¹ì¢…ë³´í—˜')" class="category-btn bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center transition-colors">
                    <div class="text-lg font-semibold">íŠ¹ì¢…ë³´í—˜</div>
                    <div class="text-sm opacity-90">Special Insurance</div>
                </button>
                <button onclick="selectCategory('ë°°ìƒì±…ì„ë³´í—˜')" class="category-btn bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center transition-colors">
                    <div class="text-lg font-semibold">ë°°ìƒì±…ì„ë³´í—˜</div>
                    <div class="text-sm opacity-90">Liability Insurance</div>
                </button>
                <button onclick="selectCategory('í•´ìƒë³´í—˜')" class="category-btn bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-lg text-center transition-colors">
                    <div class="text-lg font-semibold">í•´ìƒë³´í—˜</div>
                    <div class="text-sm opacity-90">Marine Insurance</div>
                </button>
            </div>

            <!-- ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í†µê³„ -->
            <div id="category-stats" class="hidden bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 id="selected-category-title" class="text-xl font-semibold text-gray-800 mb-4">ì¹´í…Œê³ ë¦¬ í†µê³„</h3>
                
                <!-- ëˆ„ì /ê¸ˆì¼ êµ¬ë¶„ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ëˆ„ì í˜„í™© -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="text-lg font-semibold text-blue-800 mb-3">ëˆ„ì í˜„í™©</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-xl font-bold text-blue-600" id="category-cumulative-total">0</div>
                                <div class="text-sm text-gray-600">ì´ ë¬¸ì œìˆ˜</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-green-600" id="category-cumulative-correct">0</div>
                                <div class="text-sm text-gray-600">ì •ë‹µìˆ˜</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-orange-600" id="category-cumulative-accuracy">0%</div>
                                <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê¸ˆì¼í˜„í™© -->
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="text-lg font-semibold text-green-800 mb-3">ê¸ˆì¼í˜„í™©</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-xl font-bold text-blue-600" id="category-daily-total">0</div>
                                <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ë¬¸ì œìˆ˜</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-green-600" id="category-daily-correct">0</div>
                                <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µìˆ˜</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-orange-600" id="category-daily-accuracy">0%</div>
                                <div class="text-sm text-gray-600">ì˜¤ëŠ˜ ì •ë‹µë¥ </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¬¸ì œ í‘œì‹œ ì˜ì—­ -->
            <div id="category-question-container" class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="text-center">
                    <p class="text-lg text-gray-600 mb-4">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                </div>
            </div>

            <!-- ë‹µì•ˆ ë²„íŠ¼ ì˜ì—­ -->
            <div id="category-answer-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ë‹µì•ˆ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ì ì„¤ì • ëª¨ë‹¬ -->
    <div id="user-settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">ì‚¬ìš©ì ì„¤ì •</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ìëª…</label>
                <input type="text" id="user-name-input" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œí—˜ì¼</label>
                <input type="date" id="exam-date-input" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">ì—°ë½ì²˜</label>
                <input type="text" id="user-phone-input" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            
            <div class="flex justify-end space-x-3">
                <button onclick="closeUserSettings()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                    ì·¨ì†Œ
                </button>
                <button onclick="saveUserSettings()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== ê°„ì†Œí™”ëœ í†µê³„ ì‹œìŠ¤í…œ (v2.0ì—ì„œ ì±„ìš©) =====
        
        // ì „ì—­ ë³€ìˆ˜
        let statistics = null;
        let isUserRegistered = false;
        let currentMode = null;
        let currentCategory = null;
        let currentQuestion = null;
        let questions = [];
        let currentQuestionIndex = 0;
        
        // ê°„ì†Œí™”ëœ í†µê³„ ì´ˆê¸°í™”
        const initStatistics = () => ({
            meta: {
                version: "3.0",
                userName: null,
                registeredAt: null,
                dataStartDate: null,
                lastUpdated: new Date().toISOString()
            },
            questionCounts: {
                "ì¸ìŠ¤êµì¬": 700,
                "ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜": 679,
                "total": 1379
            },
            global: {
                cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                daily: { attempted: 0, correct: 0, accuracy: 0 }
            },
            modes: {
                basic: {
                    cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                    daily: { attempted: 0, correct: 0, accuracy: 0 }
                },
                categories: {
                    "ì¬ì‚°ë³´í—˜": { cumulative: { attempted: 0, correct: 0, accuracy: 0 }, daily: { attempted: 0, correct: 0, accuracy: 0 } },
                    "íŠ¹ì¢…ë³´í—˜": { cumulative: { attempted: 0, correct: 0, accuracy: 0 }, daily: { attempted: 0, correct: 0, accuracy: 0 } },
                    "ë°°ìƒì±…ì„ë³´í—˜": { cumulative: { attempted: 0, correct: 0, accuracy: 0 }, daily: { attempted: 0, correct: 0, accuracy: 0 } },
                    "í•´ìƒë³´í—˜": { cumulative: { attempted: 0, correct: 0, accuracy: 0 }, daily: { attempted: 0, correct: 0, accuracy: 0 } }
                },
                largeCategoryTotal: {
                    cumulative: { attempted: 0, correct: 0, accuracy: 0 },
                    daily: { attempted: 0, correct: 0, accuracy: 0 }
                }
            }
        });

        // ì¬í™œìš© ê°€ëŠ¥í•œ í•µì‹¬ í•¨ìˆ˜ë“¤
        function calculateAccuracy(correct, total) {
            return total > 0 ? Math.round((correct / total) * 100) : 0;
        }

        function calculateProgress(completed, total) {
            return total > 0 ? Math.round((completed / total) * 100) : 0;
        }

        function generateUserKey(userName, userPhone) {
            return `${userName}_${userPhone}`.replace(/[^a-zA-Z0-9_]/g, '');
        }

        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì¬í™œìš© ê°€ëŠ¥)
        function updateStatistics(isCorrect, mode, category = null) {
            if (!isUserRegistered || !statistics) return;
            
            const today = getTodayKey();
            
            // ì „ì—­ í†µê³„ ì—…ë°ì´íŠ¸
            statistics.global.cumulative.attempted++;
            statistics.global.daily.attempted++;
            
            if (isCorrect) {
                statistics.global.cumulative.correct++;
                statistics.global.daily.correct++;
            }
            
            // ëª¨ë“œë³„ í†µê³„ ì—…ë°ì´íŠ¸
            if (mode === 'basic') {
                updateModeStatistics(statistics.modes.basic, isCorrect);
            } else if (mode === 'largeCategory') {
                updateModeStatistics(statistics.modes.largeCategoryTotal, isCorrect);
                if (category && statistics.modes.categories[category]) {
                    updateModeStatistics(statistics.modes.categories[category], isCorrect);
                }
            }
            
            // ì •í™•ë„ ì¬ê³„ì‚°
            statistics.global.cumulative.accuracy = calculateAccuracy(statistics.global.cumulative.correct, statistics.global.cumulative.attempted);
            statistics.global.daily.accuracy = calculateAccuracy(statistics.global.daily.correct, statistics.global.daily.attempted);
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ê¸°ë¡
            statistics.meta.lastUpdated = new Date().toISOString();
            
            // ì €ì¥
            saveStatistics();
            
            // UI ì—…ë°ì´íŠ¸
            updateAllDisplays();
        }

        // ëª¨ë“œë³„ í†µê³„ ì—…ë°ì´íŠ¸ (ì¬í™œìš© ê°€ëŠ¥)
        function updateModeStatistics(modeStats, isCorrect) {
            modeStats.cumulative.attempted++;
            modeStats.daily.attempted++;
            
            if (isCorrect) {
                modeStats.cumulative.correct++;
                modeStats.daily.correct++;
            }
            
            modeStats.cumulative.accuracy = calculateAccuracy(modeStats.cumulative.correct, modeStats.cumulative.attempted);
            modeStats.daily.accuracy = calculateAccuracy(modeStats.daily.correct, modeStats.daily.attempted);
        }

        // ì €ì¥/ë¡œë“œ í•¨ìˆ˜ (ê°„ì†Œí™”)
        function saveStatistics() {
            if (!isUserRegistered || !statistics) return;
            
            const userKey = generateUserKey(statistics.meta.userName, statistics.meta.userPhone);
            localStorage.setItem(`aciu_statistics_${userKey}`, JSON.stringify(statistics));
        }

        function loadStatistics() {
            if (!isUserRegistered) return;
            
            const userKey = generateUserKey(statistics.meta.userName, statistics.meta.userPhone);
            const saved = localStorage.getItem(`aciu_statistics_${userKey}`);
            
            if (saved) {
                statistics = JSON.parse(saved);
            } else {
                statistics = initStatistics();
                statistics.meta.userName = document.getElementById('user-name-input').value;
                statistics.meta.userPhone = document.getElementById('user-phone-input').value;
                statistics.meta.registeredAt = new Date().toISOString();
                statistics.meta.dataStartDate = new Date().toISOString().split('T')[0];
            }
        }

        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateAllDisplays() {
            updateHomeStatistics();
            updateModeStatisticsDisplay();
        }

        function updateHomeStatistics() {
            if (!statistics) return;
            
            // ë³´ìœ  ë¬¸ì œìˆ˜ í˜„í™©
            document.getElementById('ins-questions').textContent = statistics.questionCounts["ì¸ìŠ¤êµì¬"];
            document.getElementById('exam-questions').textContent = statistics.questionCounts["ë³´í—˜ì¤‘ê°œì‚¬ì‹œí—˜"];
            document.getElementById('total-questions').textContent = statistics.questionCounts.total;
            
            // í•™ìŠµ ì§„ë„ í˜„í™©
            document.getElementById('completed-questions').textContent = statistics.global.cumulative.attempted;
            document.getElementById('progress-rate').textContent = calculateProgress(statistics.global.cumulative.attempted, statistics.questionCounts.total) + '%';
            document.getElementById('accuracy-rate').textContent = statistics.global.cumulative.accuracy + '%';
            
            // ê¸ˆì¼ í•™ìŠµ í˜„í™©
            document.getElementById('today-total').textContent = statistics.global.daily.attempted;
            document.getElementById('today-correct').textContent = statistics.global.daily.correct;
            document.getElementById('today-accuracy').textContent = statistics.global.daily.accuracy + '%';
        }

        function updateModeStatisticsDisplay() {
            if (!statistics) return;
            
            // ê¸°ë³¸í•™ìŠµ í†µê³„
            document.getElementById('basic-cumulative-total').textContent = statistics.modes.basic.cumulative.attempted;
            document.getElementById('basic-cumulative-correct').textContent = statistics.modes.basic.cumulative.correct;
            document.getElementById('basic-cumulative-accuracy').textContent = statistics.modes.basic.cumulative.accuracy + '%';
            
            document.getElementById('basic-daily-total').textContent = statistics.modes.basic.daily.attempted;
            document.getElementById('basic-daily-correct').textContent = statistics.modes.basic.daily.correct;
            document.getElementById('basic-daily-accuracy').textContent = statistics.modes.basic.daily.accuracy + '%';
            
            // ëŒ€ë¶„ë¥˜í•™ìŠµ ì „ì²´ í†µê³„
            document.getElementById('large-cumulative-total').textContent = statistics.modes.largeCategoryTotal.cumulative.attempted;
            document.getElementById('large-cumulative-correct').textContent = statistics.modes.largeCategoryTotal.cumulative.correct;
            document.getElementById('large-cumulative-accuracy').textContent = statistics.modes.largeCategoryTotal.cumulative.accuracy + '%';
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ (ì„ íƒëœ ì¹´í…Œê³ ë¦¬ê°€ ìˆì„ ë•Œë§Œ)
            if (currentCategory && statistics.modes.categories[currentCategory]) {
                const categoryStats = statistics.modes.categories[currentCategory];
                document.getElementById('category-cumulative-total').textContent = categoryStats.cumulative.attempted;
                document.getElementById('category-cumulative-correct').textContent = categoryStats.cumulative.correct;
                document.getElementById('category-cumulative-accuracy').textContent = categoryStats.cumulative.accuracy + '%';
                
                document.getElementById('category-daily-total').textContent = categoryStats.daily.attempted;
                document.getElementById('category-daily-correct').textContent = categoryStats.daily.correct;
                document.getElementById('category-daily-accuracy').textContent = categoryStats.daily.accuracy + '%';
            }
        }

        // ===== ê¸°ì¡´ ë¬¸ì œ í’€ì´ ê¸°ëŠ¥ (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€) =====
        
        // ëª¨ë“œ ì„¤ì • (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€)
        const MODE_CONFIG = {
            'continue': { name: 'ì´ì–´ì„œ í’€ê¸°', description: 'ì´ì „ì— í’€ë˜ ë¬¸ì œë¶€í„° ê³„ì†' },
            'startFromScratch': { name: 'ì²˜ìŒë¶€í„° í’€ê¸°', description: 'ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘' },
            'randomSolve': { name: 'ëœë¤ í’€ê¸°', description: 'ë¬´ì‘ìœ„ë¡œ ë¬¸ì œ ì„ íƒ' }
        };

        // ë¬¸ì œ í‘œì‹œ í•¨ìˆ˜ (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€)
        function displayQuestion(question) {
            const container = currentMode === 'largeCategory' ? 
                document.getElementById('category-question-container') : 
                document.getElementById('question-container');
            
            container.innerHTML = `
                <div class="mb-4">
                    <div class="text-sm text-gray-500 mb-2">ë¬¸ì œ ${currentQuestionIndex + 1}</div>
                    <p class="text-lg text-gray-800 leading-relaxed">${question.question}</p>
                </div>
            `;
            
            currentQuestion = question;
            createAnswerButtons(question.answers);
        }

        // ë‹µì•ˆ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜ (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€)
        function createAnswerButtons(answers) {
            const container = currentMode === 'largeCategory' ? 
                document.getElementById('category-answer-container') : 
                document.getElementById('answer-container');
            
            container.innerHTML = '';
            
            answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn bg-white border-2 border-gray-300 rounded-lg p-4 text-left hover:border-blue-500 transition-colors';
                button.textContent = `${String.fromCharCode(65 + index)}. ${answer}`;
                button.onclick = () => checkAnswer(index);
                container.appendChild(button);
            });
        }

        // ì •ë‹µ í™•ì¸ í•¨ìˆ˜ (í†µê³„ ì—…ë°ì´íŠ¸ ë¶€ë¶„ë§Œ ìˆ˜ì •)
        function checkAnswer(selectedIndex) {
            if (!currentQuestion) return;
            
            const isCorrect = selectedIndex === currentQuestion.correctAnswer;
            const buttons = document.querySelectorAll('.answer-btn');
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            buttons.forEach((button, index) => {
                button.disabled = true;
                if (index === currentQuestion.correctAnswer) {
                    button.classList.add('border-green-500', 'bg-green-50');
                } else if (index === selectedIndex && !isCorrect) {
                    button.classList.add('border-red-500', 'bg-red-50');
                }
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ê°„ì†Œí™”ëœ í•¨ìˆ˜ ì‚¬ìš©)
            if (isUserRegistered) {
                updateStatistics(isCorrect, currentMode, currentCategory);
            }
            
            // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    displayQuestion(questions[currentQuestionIndex]);
                } else {
                    showCompletionMessage();
                }
            }, 2000);
        }

        // ===== ê¸°ì¡´ UI í•¨ìˆ˜ë“¤ (ìµœì†Œí•œì˜ ìˆ˜ì •) =====
        
        function startBasicLearning() {
            currentMode = 'basic';
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('basic-learning-screen').classList.remove('hidden');
            loadQuestions();
        }

        function startLargeCategoryLearning() {
            currentMode = 'largeCategory';
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('large-category-learning-screen').classList.remove('hidden');
        }

        function selectCategory(category) {
            currentCategory = category;
            document.getElementById('selected-category-title').textContent = `${category} í†µê³„`;
            document.getElementById('category-stats').classList.remove('hidden');
            loadCategoryQuestions(category);
        }

        function goHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('basic-learning-screen').classList.add('hidden');
            document.getElementById('large-category-learning-screen').classList.add('hidden');
            currentMode = null;
            currentCategory = null;
        }

        function loadQuestions() {
            // ê¸°ì¡´ ë¬¸ì œ ë¡œë”© ë¡œì§ ìœ ì§€
            Papa.parse('ins_master_db.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    questions = results.data.filter(q => q.question && q.question.trim() !== '');
                    if (questions.length > 0) {
                        currentQuestionIndex = 0;
                        displayQuestion(questions[0]);
                    }
                }
            });
        }

        function loadCategoryQuestions(category) {
            const categoryFiles = {
                'ì¬ì‚°ë³´í—˜': 'ins_1db.csv',
                'íŠ¹ì¢…ë³´í—˜': 'ins_2db.csv',
                'ë°°ìƒì±…ì„ë³´í—˜': 'ins_3db.csv',
                'í•´ìƒë³´í—˜': 'ins_4db.csv'
            };
            
            const fileName = categoryFiles[category];
            if (fileName) {
                Papa.parse(fileName, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        questions = results.data.filter(q => q.question && q.question.trim() !== '');
                        if (questions.length > 0) {
                            currentQuestionIndex = 0;
                            displayQuestion(questions[0]);
                        }
                    }
                });
            }
        }

        function showCompletionMessage() {
            const container = currentMode === 'largeCategory' ? 
                document.getElementById('category-question-container') : 
                document.getElementById('question-container');
            
            container.innerHTML = `
                <div class="text-center">
                    <h3 class="text-xl font-semibold text-green-600 mb-4">í•™ìŠµ ì™„ë£Œ!</h3>
                    <p class="text-gray-600 mb-4">ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆìŠµë‹ˆë‹¤.</p>
                    <button onclick="goHome()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded">
                        í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            `;
        }

        // ===== ì‚¬ìš©ì ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
        
        function openUserSettings() {
            document.getElementById('user-settings-modal').classList.remove('hidden');
            loadUserSettings();
        }

        function closeUserSettings() {
            document.getElementById('user-settings-modal').classList.add('hidden');
        }

        function loadUserSettings() {
            const savedName = localStorage.getItem('aicu_user_name') || '';
            const savedDate = localStorage.getItem('aicu_exam_date') || '';
            const savedPhone = localStorage.getItem('aicu_user_phone') || '';
            
            document.getElementById('user-name-input').value = savedName;
            document.getElementById('exam-date-input').value = savedDate;
            document.getElementById('user-phone-input').value = savedPhone;
        }

        function saveUserSettings() {
            const userName = document.getElementById('user-name-input').value;
            const examDate = document.getElementById('exam-date-input').value;
            const userPhone = document.getElementById('user-phone-input').value;
            
            if (!userName || !examDate || !userPhone) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ ì„¤ì • ì €ì¥
            localStorage.setItem('aicu_user_name', userName);
            localStorage.setItem('aicu_exam_date', examDate);
            localStorage.setItem('aicu_user_phone', userPhone);
            
            // ì‚¬ìš©ì ë“±ë¡ ë° í†µê³„ ì´ˆê¸°í™”
            isUserRegistered = true;
            statistics = initStatistics();
            statistics.meta.userName = userName;
            statistics.meta.userPhone = userPhone;
            statistics.meta.registeredAt = new Date().toISOString();
            statistics.meta.dataStartDate = new Date().toISOString().split('T')[0];
            
            // í†µê³„ ì €ì¥
            saveStatistics();
            
            // UI ì—…ë°ì´íŠ¸
            updateUserDisplay();
            updateAllDisplays();
            
            closeUserSettings();
        }

        function updateUserDisplay() {
            const userName = localStorage.getItem('aicu_user_name') || 'ì¡°ëŒ€í‘œë‹˜';
            const examDate = localStorage.getItem('aicu_exam_date') || '2025ë…„ 12ì›” 15ì¼';
            
            document.getElementById('user-name-display').textContent = `ì‚¬ìš©ì: ${userName}`;
            document.getElementById('exam-date-display').textContent = examDate;
            
            // D-day ê³„ì‚°
            if (examDate) {
                const exam = new Date(examDate);
                const today = new Date();
                const diffTime = exam - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                document.getElementById('d-day-display').textContent = `D-${diffDays}ì¼`;
            }
        }

        function loadStatisticsData() {
            if (isUserRegistered && statistics) {
                updateAllDisplays();
                alert('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
            } else {
                alert('ë¨¼ì € ì‚¬ìš©ì ì„¤ì •ì—ì„œ ë“±ë¡í•´ì£¼ì„¸ìš”.');
            }
        }

        // ===== ì•± ì´ˆê¸°í™” =====
        
        function initializeApp() {
            // ì‚¬ìš©ì ì„¤ì • ë¡œë“œ
            const userName = localStorage.getItem('aicu_user_name');
            const userPhone = localStorage.getItem('aicu_user_phone');
            
            if (userName && userPhone) {
                isUserRegistered = true;
                statistics = initStatistics();
                statistics.meta.userName = userName;
                statistics.meta.userPhone = userPhone;
                loadStatistics();
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateUserDisplay();
            updateAllDisplays();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
</body>
</html>